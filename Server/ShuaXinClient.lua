--脚本号
x892002_g_scriptId = 892002
x892002_g_ZhenfaSkill_strskillDataLuvel = {}
x892002_g_ZhenfaSkill_strskillDataLuvel[1] = {80,80,90,100,100,110,120,120,130,200,200,210,220,220,230,240,240,250,260,320,320,330,340,340,350,360,360,370,380,450,450,460,470,470,480,490,490,500,510,580,580,590,600,600,610,620,620,630,640,700,700,710,720,720,730,740,740,750,760,830,830,840,850,850,860,870,870,880,890,960,960,970,980,980,990,1000,1000,1010,1020,1080,1080,1090,1100,1100,1110,1120,1120,1130,1140,1210,1210,1220,1230,1230,1240,1250,1250,1260,1270,1340}
x892002_g_ZhenfaSkill_strskillDataLuvel[2] = {120,130,140,150,160,170,180,190,200,300,310,320,330,340,350,360,370,380,390,490,500,510,520,530,540,550,560,570,580,680,690,700,710,720,730,740,750,760,770,870,880,890,900,910,920,930,940,950,960,1060,1070,1080,1090,1100,1110,1120,1130,1140,1150,1250,1260,1270,1280,1290,1300,1310,1320,1330,1340,1440,1450,1460,1470,1480,1490,1500,1510,1520,1530,1630,1640,1650,1660,1670,1680,1690,1700,1710,1720,1820,1830,1840,1850,1860,1870,1880,1890,1900,1910,2010}
x892002_g_ZhenfaSkill_strskillDataLuvel[3] = {120,130,140,150,160,170,180,190,200,300,310,320,330,340,350,360,370,380,390,490,500,510,520,530,540,550,560,570,580,680,690,700,710,720,730,740,750,760,770,870,880,890,900,910,920,930,940,950,960,1060,1070,1080,1090,1100,1110,1120,1130,1140,1150,1250,1260,1270,1280,1290,1300,1310,1320,1330,1340,1440,1450,1460,1470,1480,1490,1500,1510,1520,1530,1630,1640,1650,1660,1670,1680,1690,1700,1710,1720,1820,1830,1840,1850,1860,1870,1880,1890,1900,1910,2010}
x892002_g_ZhenfaSkill_strskillDataLuvel[4] = {180,190,210,220,240,250,270,280,300,450,460,480,490,510,520,540,550,570,580,730,750,760,780,790,810,820,840,850,870,1020,1030,1050,1060,1080,1090,1110,1120,1140,1150,1300,1320,1330,1350,1360,1380,1390,1410,1420,1440,1590,1600,1620,1630,1650,1660,1680,1690,1710,1720,1870,1890,1900,1920,1930,1950,1960,1980,1990,2010,2160,2170,2190,2200,2220,2230,2250,2260,2280,2290,2440,2460,2470,2490,2500,2520,2530,2550,2560,2580,2730,2740,2760,2770,2790,2800,2820,2830,2850,2860,3010}
x892002_g_My_MD = {MD_ZENG_FA1,MD_ZENG_FA2,MD_ZENG_FA3,MD_ZENG_FA4}
x892002_g_Qing_Yi = MD_ZENG_JING_YI
x892002_g_Qing_Yi_DATA = MD_ZENG_DATA_JING_YI
x892002_g_XuiWei = MD_ZENG_XIUWEI

x892002_g_KFSVisual = {
	[1] = {2995,2996,2997,2998,2999},--风，土，水，火
	[2] = {2990,2991,2992,2993,2994},
}

x892002_Infant_Heroffect = {}  --英雄基本属性表 等级 攻 体 命 会 身 闪 x892002_Infant_Heroffect [ Infant_level ][1]
x892002_Infant_Heroffect [ 91 ] = { 10 , 10 , 200 , 2 , 10 , 200 }
x892002_Infant_Heroffect [ 92 ] = { 10 , 10 , 200 , 2 , 10 , 200 }
x892002_Infant_Heroffect [ 93 ] = { 10 , 10 , 200 , 2 , 10 , 200 }
x892002_Infant_Heroffect [ 94 ] = { 10 , 10 , 200 , 2 , 10 , 200 }
x892002_Infant_Heroffect [ 95 ] = { 20 , 10 , 200 , 4 , 10 , 200 }
x892002_Infant_Heroffect [ 96 ] = { 20 , 20 , 200 , 4 , 10 , 200 }
x892002_Infant_Heroffect [ 97 ] = { 20 , 20 , 200 , 4 , 10 , 200 }
x892002_Infant_Heroffect [ 98 ] = { 20 , 20 , 200 , 4 , 10 , 200 }
x892002_Infant_Heroffect [ 99 ] = { 20 , 20 , 200 , 4 , 10 , 200 }
x892002_Infant_Heroffect [ 100 ] = { 20 , 20 , 400 , 4 , 10 , 200 }
x892002_Infant_Heroffect [ 101 ] = { 20 , 20 , 400 , 4 , 20 , 400 }
x892002_Infant_Heroffect [ 102 ] = { 20 , 20 , 400 , 6 , 20 , 400 }
x892002_Infant_Heroffect [ 103 ] = { 30 , 20 , 400 , 6 , 20 , 400 }
x892002_Infant_Heroffect [ 104 ] = { 30 , 30 , 400 , 6 , 20 , 400 }
x892002_Infant_Heroffect [ 105 ] = { 30 , 30 , 400 , 6 , 20 , 400 }
x892002_Infant_Heroffect [ 106 ] = { 30 , 30 , 400 , 6 , 20 , 400 }
x892002_Infant_Heroffect [ 107 ] = { 30 , 30 , 400 , 6 , 20 , 400 }
x892002_Infant_Heroffect [ 108 ] = { 30 , 30 , 400 , 6 , 30 , 400 }
x892002_Infant_Heroffect [ 109 ] = { 30 , 30 , 600 , 6 , 30 , 400 }
x892002_Infant_Heroffect [ 110 ] = { 30 , 30 , 600 , 6 , 30 , 400 }
x892002_Infant_Heroffect [ 111 ] = { 30 , 40 , 600 , 6 , 30 , 400 }
x892002_Infant_Heroffect [ 112 ] = { 30 , 40 , 600 , 6 , 30 , 400 }
x892002_Infant_Heroffect [ 113 ] = { 40 , 40 , 600 , 8 , 30 , 600 }
x892002_Infant_Heroffect [ 114 ] = { 40 , 40 , 600 , 8 , 30 , 600 }
x892002_Infant_Heroffect [ 115 ] = { 40 , 40 , 800 , 8 , 30 , 600 }
x892002_Infant_Heroffect [ 116 ] = { 40 , 40 , 800 , 8 , 40 , 600 }
x892002_Infant_Heroffect [ 117 ] = { 40 , 50 , 800 , 10 , 40 , 800 }
x892002_Infant_Heroffect [ 118 ] = { 40 , 50 , 800 , 10 , 40 , 800 }
x892002_Infant_Heroffect [ 119 ] = { 60 , 50 , 800 , 10 , 50 , 800 }
x892002_Heroffect_ratio = 1 --(英雄基本属性表 的比率，2 代表200%)


x892002_Infant_Bookffect = {} --书的基本属性表  颜色 攻 体 命 会 身 闪
x892002_Infant_Bookffect [ 1 ] = { 30 , 50 , 200 , 2 , 10 , 200 }
x892002_Infant_Bookffect [ 2 ] = { 50 , 80 , 600 , 4 , 30 , 400 }
x892002_Infant_Bookffect [ 3 ] = { 80 , 120 , 800 , 8 , 50 , 600 }
x892002_Infant_Bookffect [ 4 ] = { 130 , 150 , 1400 , 12 , 80 , 800 }
x892002_Bookffect_ratio = 1 --(书的属性表 的比率，2 代表200%，作者（得意 QQ：846619101）只用在橙色书上，以和其它低级颜色的属性拉开差距)


x892002_Infant_BookStarffect = {} --书的星星属性表  星级 攻 体 命 会 身 闪
x892002_Infant_BookStarffect [ 1 ] = { 10 , 10 , 200 , 2 , 10 , 200 }
x892002_Infant_BookStarffect [ 2 ] = { 20 , 20 , 400 , 4 , 20 , 400 }
x892002_Infant_BookStarffect [ 3 ] = { 30 , 30 , 600 , 6 , 30 , 600 }
x892002_Infant_BookStarffect [ 4 ] = { 50 , 50 , 800 , 10 , 50 , 800 }
x892002_Infant_BookStarffect [ 5 ] = { 80 , 80 , 1200 , 18 , 80 , 1200 }
x892002_Infant_BookStarffect [ 6 ] = { 110 , 110 , 1800 , 28 , 110 , 1800 }
x892002_Infant_BookStarffect [ 7 ] = { 150 , 150 , 2400 , 40 , 150 , 2400 }
x892002_Infant_BookStarffect [ 8 ] = { 190 , 190 , 3200 , 54 , 190 , 3200 }
x892002_Infant_BookStarffect [ 9 ] = { 240 , 240 , 4200 , 70 , 240 , 4200 }
x892002_BookStar_ratio = 1 --(书的星星属性表 的比率，2 代表200%，)


x892002_ZH_ratio = 2 --(综合效果的比率，1 代表200%，)
x892002_Infant_SKEffect = { 10 , 15 , 20 , 24 , 30 , 35 , 40 , 45 , 70 } -- 基本属性


x892002_g_qianghuaLevelT = {
[0] ={0,-1,75},[1] ={0,-1,60},[2] ={0,-1,50},[3] ={0,-1,45},[4] ={0,-1,15},
[5] ={0,-1,20},[6] ={0,-1,10},[7] ={0,-1,1},[8] ={0,-1,0.5},[9] ={42,-1,1},
[10] ={50,1,100},[11] ={58,1,100},[12] ={66,1,100},[13] ={74,1,100},[14] ={82,1,100},
[15] ={90,1,100},[16] ={98,1,100},[17] ={106,1,100},[18] ={114,1,100},[19] ={122,1,100},
[20] ={130,1,100},[21] ={140,2,66.66},[22] ={150,2,50},[23] ={160,3,40},[24] ={170,4,33.33},
[25] ={180,4,28.57},[26] ={190,4,25},[27] ={200,5,22.22},[28] ={210,5,20},[29] ={220,6,18.18},
[30] ={230,7,16.66},[31] ={242,8,12.5},[32] ={254,10,11.11},[33] ={266,12,9.09},[34] ={278,15,7.14},
[35] ={290,18,5.88},[36] ={302,20,5},[37] ={314,24,4.34},[38] ={326,27,3.84},[39] ={338,30,3.44},
[40] ={350,33,3.12},[41] ={365,45,2.27},[42] ={380,48,2.12},[43] ={395,50,2},[44] ={410,54,1.88},
[45] ={425,57,1.78},[46] ={440,60,1.69},[47] ={455,63,1.61},[48] ={470,66,1.53},[49] ={485,69,1.47},
[50] ={500,72,1.4},[51] ={518,75,1.35},[52] ={536,78,1.29},[53] ={554,80,1.25},[54] ={572,84,1.2},
[55] ={590,87,1.16},[56] ={608,90,1.12},[57] ={626,93,1.08},[58] ={644,96,1.05},[59] ={662,99,1.02},
[60] ={680,102,0.99},[61] ={700,115,0.87},[62] ={720,121,0.83},[63] ={740,127,0.79},[64] ={760,143,0.7},
[65] ={780,159,0.63},[66] ={800,176,0.57},[67] ={820,193,0.52},[68] ={840,209,0.48},[69] ={860,219,0.44},
[70] ={880,229,0.42},[71] ={902,239,0.4},[72] ={924,243,0.39},[73] ={946,249,0.38},[74] ={968,252,0.37},
[75] ={990,265,0.35},[76] ={1012,270,0.32},[77] ={1034,278,0.3},[78] ={1056,285,0.29},[79] ={1078,290,0.27},
[80] ={1100,298,0.24},[81] ={1125,308,0.22},[82] ={1150,318,0.2},[83] ={1175,338,0.18},[84] ={1200,358,0.15},
[85] ={1225,378,0.13},[86] ={1250,398,0.11},[87] ={1275,428,0.08},[88] ={1300,468,0.06},[89] ={1325,498,0.04},
[90] ={1350,548,0.02},[91] ={1380,610,0.008},[92] ={1410,680,0.007},[93] ={1440,760,0.006},[94] ={1470,850,0.005},
[95] ={1500,950,0.004},[96] ={1530,980,0.003},[97] ={1560,1030,0.002},[98] ={1590,1070,0.001},[99] ={1620,1140,0.001},[100] ={0,0,0},
}

BuffJi = {  -----------BUFF集合，开始编号 百分比提升伤害(在穿刺文件里){14700,14799}
	{17000,18049,15,"冰攻"},{18050,19099,15,"火攻"},{19100,20149,15,"玄攻"},{20150,21199,15,"毒攻"},
	{21200,22199,4,"冰抗"},{22200,23199,4,"火抗"},{23200,24199,4,"玄抗"},{24200,25199,4,"毒抗"},
	{25200,25899,4,"冰减"},{25900,26599,4,"火减"},{26600,27299,4,"玄减"},{27300,27999,4,"毒减"},
	
	{13000,13699,10,"力量"},{13700,14399,10,"灵气"},{14400,15599,10,"体力"},{15600,16299,10,"定力"},{16300,16999,10,"身法"},
	{31400,31429,3,"百分比血上限"},{30100,30199,2,"会防"},
	{30200,30999,1000,"血上限"},{28000,28399,200,"外攻"},{28400,28799,200,"内攻"},{28800,29199,100,"外防"},{29200,29599,100,"内防"},
	{29600,29999,100,"命中"},{31000,31399,80,"闪避"},{30000,30099,3,"会心"} }
	
x892002_g_ssattar = {0,14,6,9,11,12,13,17,18,7}--可强化产生穿刺伤害效果的装备
x892002_g_ssfy = {2,1,15,3,5,4}--可强化产生穿刺减免效果的装备
x892002_g_sh = 500--总穿刺伤害
x892002_g_jm = 501--总穿刺减免
function x892002_SSValue(sceneId, selfId)  --穿刺
	local atfm = 0
	local ret, arg0 = 0,0
	local lisimiss = 0
	local qianhuacha = 0
	local yifu,longwen,lingpai = x892002_DanDuCC(sceneId,selfId)	
	for i = 1,getn(x892002_g_ssattar) do
		lisimiss = GetBagItemParam( sceneId, selfId, 100+x892002_g_ssattar[i], 3, 1)
		ret, arg0 = LuaFnEquipEnhanceCheck( sceneId, selfId, 100+x892002_g_ssattar[i], 100+x892002_g_ssattar[i] )
		if arg0 ~= nil and arg0 == 0 then
			arg0 = 99
		end
		if arg0 == nil then
			arg0 = 0
		end
		qianhuacha = lisimiss - arg0
		if x892002_g_qianghuaLevelT[lisimiss] == nil or x892002_g_qianghuaLevelT[lisimiss][1] == nil then
			lisimiss = 0
		else
			lisimiss = x892002_g_qianghuaLevelT[lisimiss][1]
		end
		if lisimiss > 0 and qianhuacha < 5 then
			atfm = atfm + lisimiss
		end
	end
	
	local udqk = 0
	lisimiss = 0
	for i = 1,getn(x892002_g_ssfy) do
		lisimiss = GetBagItemParam( sceneId, selfId, 100+x892002_g_ssfy[i], 3, 1)
		ret, arg0 = LuaFnEquipEnhanceCheck( sceneId, selfId, 100+x892002_g_ssfy[i], 100+x892002_g_ssfy[i] )
		if arg0 ~= nil and arg0 == 0 then
			arg0 = 99
		end
		if arg0 == nil then
			arg0 = 0
		end
		qianhuacha = lisimiss - arg0
		if x892002_g_qianghuaLevelT[lisimiss] == nil or x892002_g_qianghuaLevelT[lisimiss][1] == nil then
			lisimiss = 0
		else
			lisimiss = x892002_g_qianghuaLevelT[lisimiss][1]
		end
		if lisimiss > 0 and qianhuacha < 5 then
			udqk = udqk + lisimiss
		end
	end

    atfm = longwen + lingpai + atfm
	udqk = yifu+udqk
	
	
	return atfm,udqk
end

function x892002_DelSSitem(sceneId, selfId)  --穿刺
	local bjleveltosuxing = {60,120,180,240,300,360,420,480,540,600,660,720,780,840,900,960,1020,1080,1140,1200,1260,1320,1380,1440,1500,1560,1620,1680,1740,1800,1860,1920,1980,2040,2100,2160,2220,2280,2340,2400,2460,2520,2580,2640,2700,2760,2820,2880,2940,3000,3060,3120,3180,3240,3300,3360,3420,3480,3540,3600,3660,3720,3780,3840,3900,3960,4020,4080,4140,4200,4260,4320,4380,4440,4500,4560,4620,4680,4740,4800,4860,4920,4980,5040,5100,5160,5220,5280,5340,5400,5460,5520,5580,5640,5700,5760,5820,5880,5940,6000}
	local atfm,udqk = x892002_SSValue(sceneId, selfId)
	
	
	local shuxingbb=mod(GetMissionData( sceneId, selfId, MD_BIAOJIAN_SUXING4),1000)
	local mytabyy = floor(GetMissionData( sceneId, selfId, MD_BIAOJIAN_SUXING4)/1000)
	if shuxingbb >0 and shuxingbb <101 then
		if mytabyy ==1 then
			atfm = atfm + bjleveltosuxing[shuxingbb]
		elseif mytabyy ==2 then
			udqk =udqk +bjleveltosuxing[shuxingbb]
		end
	end
	
	if LuaFnHaveImpactOfSpecificDataIndex(sceneId, selfId,9787 ) == 1 then
		local LevelUpNow = GetMissionData(sceneId, selfId, MD_ZENG_FA2)
		local level = mod(LevelUpNow,1000)
		if level ~= nil and x892002_g_ZhenfaSkill_strskillDataLuvel[1][level] ~= nil then
			atfm = atfm + x892002_g_ZhenfaSkill_strskillDataLuvel[1][level]
		end
	end
	
	if LuaFnHaveImpactOfSpecificDataIndex(sceneId, selfId,9788 ) == 1 then
		local LevelUpNow = GetMissionData(sceneId, selfId, MD_ZENG_FA3)
		local level = mod(LevelUpNow,1000)
		if level ~= nil and x892002_g_ZhenfaSkill_strskillDataLuvel[3][level] ~= nil then
			udqk = udqk + x892002_g_ZhenfaSkill_strskillDataLuvel[3][level]
		end
	end
	
	SetMissionData( sceneId, selfId, 500,atfm )
	SetMissionData( sceneId, selfId, 501,udqk/2 )
	local suansish=GetMissionData( sceneId, selfId, 500 )
	local suansijm=GetMissionData( sceneId, selfId, 501 )
	if suansish == 0 and suansijm == 0 then
		SetMissionData( sceneId, selfId, x892002_g_sh,0 )
		SetMissionData( sceneId, selfId, x892002_g_jm,0 )
		LuaFnCancelSpecificImpact(sceneId,selfId,10475)
	end
	if suansish >0 or suansijm > 0 then
		LuaFnSendSpecificImpactToUnit(sceneId, selfId, selfId, selfId, 10475, 0)
	end
	
end

x892002_g_DWtable = {10,20,50,100,210,360,640,1080,1600,2700}
x892002_g_DWtable2 = {10,20,50,80,180,270,560,810,1200,2100}


function x892002_Get_DWXS(sceneId, selfId) --雕纹/双极
	local itemId=LuaFnGetItemTableIndexByIndex( sceneId, selfId, 117 )
	local ti ,lt,ll,sf,bg,hg,xg,dg,bj,hj,xj,dj,bk,hk,xk,dk,aq  ,ww,mx,yj,bn = 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0  ,0,0,0,0
	local tis ,lts,lls,sfs,bgs,hgs,xgs,dgs,bjs,hjs,xjs,djs,bks,hks,xks,dks  ,ww2,mx2,yj2,bn2 = 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0  ,0,0,0,0
	for sd=100,118 do
		--修改属性攻击的提示
		if sd ~= 102 and sd ~=8  then
			s1,s2,s3,s4	=	CallScriptFunction( 809272, "DWShikeJC", sceneId,selfId, sd);
			if s1 >0 then
				local  a =strsub(s3,1,2)
				if a == "ti" then
					ti  = ti + x892002_g_DWtable2[s1]
				elseif a == "lt" then
					lt =lt + x892002_g_DWtable2[s1]
				elseif a == "ll" then
					ll =ll + x892002_g_DWtable2[s1]
				elseif a == "sf" then
					sf =sf + x892002_g_DWtable2[s1]
				elseif a == "bg" then
					bg =bg + x892002_g_DWtable[s1]
				elseif a == "hg" then
					hg =hg + x892002_g_DWtable[s1]
				elseif a == "xg" then
					xg =xg + x892002_g_DWtable[s1]
				elseif a == "dg" then
					dg =dg + x892002_g_DWtable[s1]
				elseif a == "bj" then
					bj =bj +s1
				elseif a == "hj" then
					hj =hj +s1
				elseif a == "xj" then
					xj =xj +s1
				elseif a == "dj" then
					dj =dj +s1
				elseif a == "bk" then
					bk =bk +s1
				elseif a == "hk" then
					hk =hk +s1
				elseif a == "xk" then
					xk =xk +s1
				elseif a == "dk" then
					dk =dk +s1
				elseif a == "ww" then
					ww =ww +s1
				elseif a == "mx" then
					mx =mx +s1
				elseif a == "yj" then
					yj =yj +s1
				elseif a == "bn" then
					bn =bn +s1
				end
			end
			if s2 >0 then
				local  c =strsub(s4,1,2)
				local  a =strsub(s4,1,2)
				if a == "ti" then
					tis  = tis + x892002_g_DWtable2[s2]
				elseif a == "lt" then
					lts =lts + x892002_g_DWtable2[s2]
				elseif a == "ll" then
					lls =lls + x892002_g_DWtable2[s2]
				elseif a == "sf" then
					sfs =sfs + x892002_g_DWtable2[s2]
				elseif a == "bg" then
					bgs =bgs + x892002_g_DWtable[s2]
				elseif a == "hg" then
					hgs =hgs + x892002_g_DWtable[s2]
				elseif a == "xg" then
					xgs =xgs + x892002_g_DWtable[s2]
				elseif a == "dg" then
					dgs =dgs + x892002_g_DWtable[s2]
				elseif a == "bj" then
					bjs =bjs +s2
				elseif a == "hj" then
					hjs =hjs +s2
				elseif a == "xj" then
					xjs =xjs +s2
				elseif a == "dj" then
					djs =djs +s2
				elseif a == "bk" then
					bks =bks +s2
				elseif a == "hk" then
					hks =hks +s2
				elseif a == "xk" then
					xks =xks +s2
				elseif a == "dk" then
					dks =dks +s2
				elseif a == "ww" then
					ww2 =ww2 +s2
				elseif a == "mx" then
					mx2 =mx2 +s2
				elseif a == "yj" then
					yj2 =yj2 +s2
				elseif a == "bn" then
					bn2 =bn2 +s2
				end
				
			end
		else
			if (itemId >=10155011 and itemId <=10155020)  then
				aq = itemId - 10155010
			end
			if itemId >10155020 then
				aq = 10
			end
		end
	end
 
	ww = ww+ww2
	mx = mx+mx2
	yj = yj+yj2
	bn = bn+bn2
 
	if ww >0 and  LuaFnHaveImpactOfSpecificDataIndex(sceneId, selfId,9789) ==0 then
		LuaFnSendSpecificImpactToUnit(sceneId, selfId, selfId, selfId, 9789, 0)
		SetMissionData(sceneId, selfId, XZ_LANSEDIAOWEN,ww )
	else
		SetMissionData(sceneId, selfId, XZ_LANSEDIAOWEN, 0)
		local XianLianDW = { {mx,9790,9799,100,"冥想"},{yj,9800,9809,10000,"御劲"},{bn,9810,9819,1000000,"暴怒"}}
		for i,xldw in  XianLianDW  do
			if xldw[1] > 0 then
				xldwBUFF = xldw[2]+xldw[1]-1
				if  LuaFnHaveImpactOfSpecificDataIndex(sceneId, selfId,xldwBUFF) ~= 1 then
					LuaFnSendSpecificImpactToUnit(sceneId, selfId, selfId, selfId, xldwBUFF, 0)
					SetMissionData(sceneId, selfId, XZ_LANSEDIAOWEN, xldw[1]*xldw[4] )
				end
			else
				for i = xldw[2],xldw[3] do
					LuaFnCancelSpecificImpact(sceneId,selfId,i)
				end
			end
		end
	end
	local DWBuff = {(aq)*2 ,0,0,0,0,0,0,0,(bj+bjs)*2,(hj+hjs)*2,(xj+xjs)*2,(dj+djs)*2,(bk+bks)*2,(hk+hks)*2,(xk+xks)*2,(dk+dks)*2 ,(bg+bgs)*1,(hg+hgs)*1,(xg+xgs)*1,(dg+dgs)*1,(ti+tis)*1,(lt+lts)*1,(ll+lls)*1,(sf+sfs)*1}
	return DWBuff
end

function x892002_GetXiuLianBuff(sceneId, selfId)  ----修练BUFF  君奉天重新整理
    --第一本
	local liliang=GetMissionData( sceneId, selfId, XIULIAN_LILIANG )
	local lingqi=GetMissionData( sceneId, selfId, XIULIAN_LINGQI )
	local tili=GetMissionData( sceneId, selfId, XIULIAN_TILI )
	local dingli=GetMissionData( sceneId, selfId, XIULIAN_DINGLI )
	local shenfa=GetMissionData( sceneId, selfId, XIULIAN_SHENFA )
	--第二本
	local waigong_xl=GetMissionData( sceneId, selfId, XIULIAN_FANJIANGDAOHAI )
	local neigong_xl=GetMissionData( sceneId, selfId, XIULIAN_DISHUICHUANSHI )
	local waifang_xl=GetMissionData( sceneId, selfId, XIULIAN_TONGQIANGTIEBI )
	local neifang_xl=GetMissionData( sceneId, selfId, XIULIAN_QIDINGSHANHE )
	local mingzhong_xl=floor(GetMissionData( sceneId, selfId, XIULIAN_BAIBUYISHI )/2)
	local shanbi_xl=floor(GetMissionData( sceneId, selfId, XIULIAN_GAOFEIYUANJI )/2)
	local XiulianBuff = {liliang,lingqi,tili,dingli,shenfa,waigong_xl,neigong_xl,waifang_xl,neifang_xl,mingzhong_xl,shanbi_xl}
    return XiulianBuff
end

function x892002_GetSDBuff(sceneId, selfId)  --神鼎BUFF  君奉天重新整理
    ----------审定
	local shengd =  GetMissionData(sceneId, selfId, SD_TILI) ---体力鼎
	if shengd >0 and shengd <61 then
		shengd = shengd*3
	else
		shengd =0
	end
	
	local sxs_a,sxs_b,sxs_c,sxs_d =0,0,0,0
	local stry1 = GetMissionData(sceneId, selfId, SD_BINGSHUX)
	local stry2 = GetMissionData(sceneId, selfId, SD_HUOSHUX)
	local stry3 = GetMissionData(sceneId, selfId, SD_XUANSHUX)
	local stry4 = GetMissionData(sceneId, selfId, SD_DUSHUX)
	if stry1 >0 then
		sxs_a =GetMissionData(sceneId, selfId, SD_SHUXINGDENGJ)
	elseif stry2 >0 then
		sxs_b =GetMissionData(sceneId, selfId, SD_SHUXINGDENGJ)
	elseif stry3 >0 then
		sxs_c =GetMissionData(sceneId, selfId, SD_SHUXINGDENGJ)
	elseif stry4 >0 then
		sxs_d =GetMissionData(sceneId, selfId, SD_SHUXINGDENGJ)
	end
	
	local sxk_a,sxk_b,sxk_c,sxk_d =0,0,0,0
	local stry5 = 0---GetMissionData(sceneId, selfId, SD_BINGKANGX)
	local stry6 = 0--GetMissionData(sceneId, selfId, SD_HUOKANGX)
	local stry7 = 0--GetMissionData(sceneId, selfId, SD_XUANKANGX)
	local stry8 = 0--GetMissionData(sceneId, selfId, SD_DUKANGX)
	if stry5 >0 then
		sxk_a =GetMissionData(sceneId, selfId, SD_KANGXINGDENGJ)
	elseif stry6 >0 then
		sxk_b =GetMissionData(sceneId, selfId, SD_KANGXINGDENGJ)
	elseif stry7 >0 then
		sxk_c =GetMissionData(sceneId, selfId, SD_KANGXINGDENGJ)
	elseif stry8 >0 then
		sxk_d =GetMissionData(sceneId, selfId, SD_KANGXINGDENGJ)
	end
	local sxj_a,sxj_b,sxj_c,sxj_d =0,0,0,0
	local stry9 = 0-- GetMissionData(sceneId, selfId, SD_BINGJKANG)
	local stry10 = 0--GetMissionData(sceneId, selfId, SD_HUOJKANG)
	local stry11 = 0--GetMissionData(sceneId, selfId, SD_XUANJKANG)
	local stry12 = 0--GetMissionData(sceneId, selfId, SD_DUJKANG)
	if stry9 >0 then
		sxj_a =GetMissionData(sceneId, selfId, SD_JIANKANGDENGJ)
	elseif stry10 >0 then
		sxj_b =GetMissionData(sceneId, selfId, SD_JIANKANGDENGJ)
	elseif stry11 >0 then
		sxj_c =GetMissionData(sceneId, selfId, SD_JIANKANGDENGJ)
	elseif stry12 >0 then
		sxj_d =GetMissionData(sceneId, selfId, SD_JIANKANGDENGJ)
	end
	local SDBuff = {shengd,sxs_a,sxs_b,sxs_c,sxs_d,sxk_a,sxk_b,sxk_c,sxk_d,sxj_a,sxj_b,sxj_c,sxj_d}
    return SDBuff
end

function x892002_GetBaoJianBuff(sceneId, selfId)  --宝鉴BUFF 君奉天重新整理
	-----------------------------------------------------------------------下面是宝剑属性算法
	local WQadd = mod(floor(GetMissionData(sceneId,selfId,XIEZI_SL)/1000),100) + floor(GetMissionData(sceneId,selfId,XIEZI_SL)/100000)---王权装备数量
	local TDadd = floor(GetMissionData(sceneId,selfId,XIEZI_SL)/100000)----天道装备数量
	local JiaCi1,JiaCi2 = 0,0
	if WQadd == 4 or WQadd == 5 then
		JiaCi1 = 5
	elseif WQadd == 6 or WQadd == 7 then
		JiaCi1 = 10
	elseif WQadd >= 8 then
		JiaCi1 = 20
	end
	
	if TDadd == 4 or TDadd == 5 then
		JiaCi2 = 5
	elseif TDadd == 6 or TDadd == 7 then
		JiaCi2 = 10
	elseif TDadd >= 8 then
		JiaCi2 = 20
	end
	
	local xueshangx=mod(GetMissionData( sceneId, selfId, MD_BIAOJIAN_SUXING5),1000)
	local mingzhong=mod(GetMissionData( sceneId, selfId, MD_BIAOJIAN_SUXING3),1000)
	local s_a,s_b,s_c,s_d=0,0,0,0
	local shuxingb=mod(GetMissionData( sceneId, selfId, MD_BIAOJIAN_SUXING1),1000)
	local mytaby = floor(GetMissionData( sceneId, selfId, MD_BIAOJIAN_SUXING1)/1000)
	
	shuxingb = shuxingb + floor(shuxingb*(JiaCi1+JiaCi2)/100)
	
	if shuxingb >0 then
		if mytaby ==1 then
			s_a = shuxingb
		elseif mytaby ==2 then
			s_b = shuxingb
		elseif mytaby ==3 then
			s_c = shuxingb
		elseif mytaby ==4 then
			s_d = shuxingb
		end
	end
	
	local ss_a,ss_b,ss_c,ss_d,ss_e,ss_f,ss_g,ss_k=0,0,0,0,0,0,0,0
	local shuxingbb=mod(GetMissionData( sceneId, selfId, MD_BIAOJIAN_SUXING2),1000)
	local mytabyy = floor(GetMissionData( sceneId, selfId, MD_BIAOJIAN_SUXING2)/1000)
	
	shuxingbb = shuxingbb + floor(shuxingbb*(JiaCi1+JiaCi2)/100)
	
	if shuxingbb >0 then
		if mytabyy ==5 then
			ss_a =shuxingbb
		elseif mytabyy ==6 then
			ss_b =shuxingbb
		elseif mytabyy ==7 then
			ss_c =shuxingbb
		elseif mytabyy ==8 then
			ss_d =shuxingbb
		elseif mytabyy ==1 then
			ss_e =shuxingbb
		elseif mytabyy ==2 then
			ss_f =shuxingbb
		elseif mytabyy ==3 then
			ss_g =shuxingbb
		elseif mytabyy ==4 then
			ss_k =shuxingbb
		end
	end
	local BaoJianBuff = {s_a,s_b,s_c,s_d, ss_a,ss_b,ss_c,ss_d,ss_e,ss_f,ss_g,ss_k, xueshangx , mingzhong}
	return BaoJianBuff
end

function x892002_GetXiaYinBuff(sceneId, selfId)  --侠印BUFF 君奉天重新整理
    -------------下面是豪侠印（体力和身法每次20点，命中每次100点，闪避每次80点）
	local haoxia=GetMissionData( sceneId, selfId, XIAYIN_DJ )
	local lingshu=GetMissionData( sceneId, selfId, XIAYIN_TYPE )
	local xiayin_ts = 0    --体力、身法、血上限
	local xiayin_ms = 0    --命中、闪避
	local xy_d = 0   --青龙毒攻
	local xy_x = 0   --白虎玄攻
	local xy_h = 0   --朱雀火攻
	local xy_b = 0   --玄武冰攻
	local xy_djk = 0   --青龙毒减抗
	local xy_xjk = 0   --白虎玄减抗
	local xy_hjk = 0   --朱雀火减抗
	local xy_bjk = 0   --玄武冰减抗
	
	if haoxia >=1 and haoxia <= 8 then
		xiayin_ts = haoxia*2+1
		xiayin_ms = haoxia+1
		if lingshu == 1 then
			xy_d = haoxia*2+1
			xy_djk = haoxia*2
		elseif lingshu == 2 then
			xy_x = haoxia*2+1
			xy_xjk = haoxia*2
		elseif lingshu == 3 then
			xy_h = haoxia*2+1
			xy_hjk = haoxia*2
		elseif lingshu == 4 then
			xy_b = haoxia*2+1
			xy_bjk = haoxia*2
		end
	end
	local xiayingbuff = {xiayin_ts,xiayin_ms,xy_b,xy_h,xy_x,xy_d,xy_bjk,xy_hjk,xy_xjk,xy_djk}
	return xiayingbuff
end

function x892002_GetWuYiBuff(sceneId, selfId)  --武意BUFF 君奉天重新整理
    	----------下面是武意-------
	local WuYiSX_XSX = mod(GetMissionData(sceneId,selfId,WUYI_1),10000)   --血上限
	local WuYiSX_BING = floor(GetMissionData(sceneId,selfId,WUYI_2)/10000)  --冰攻
	local WuYiSX_HUO = mod(GetMissionData(sceneId,selfId,WUYI_2),10000)   --火攻
	local WuYiSX_XUAN = floor(GetMissionData(sceneId,selfId,WUYI_3)/10000)  --玄功
	local WuYiSX_DU = mod(GetMissionData(sceneId,selfId,WUYI_3),10000)  --毒攻
	local WuYiSX_MZ = floor(GetMissionData(sceneId,selfId,WUYI_4)/10000)  --命中
	local WuYiSX_SB = mod(GetMissionData(sceneId,selfId,WUYI_4),10000)  --闪避
	local WuYiSX_CC = floor(GetMissionData(sceneId,selfId,WUYI_5)/10000)  --穿刺
	local WuYiSX_CF = mod(GetMissionData(sceneId,selfId,WUYI_5),10000)  --穿刺防
	
	
	local WuYibuff = {WuYiSX_XSX,WuYiSX_BING,WuYiSX_HUO,WuYiSX_XUAN,WuYiSX_DU,WuYiSX_MZ,WuYiSX_SB,WuYiSX_CC,WuYiSX_CF}
	return WuYibuff
end
	
function x892002_JunFengTianBuff(sceneId, selfId)  --函数入口
	---龙纹BUFF：血上限 ，，冰火玄毒攻，冰火玄毒减下限
	x892002_KfsVisual(sceneId,selfId)		
	local lw_buff = x892002_Get_LongWen(sceneId, selfId,118)
	 local XiaoXiang_nFbtb,str=XiaoXiang_WZPGetAtt1(sceneId, selfId)
	 local XiaoXiang_nFbtb2,str2=XiaoXiang_WZPGetAtt2(sceneId, selfId)		 
	---精通BUFF：冰，火，玄，毒,冰坑，火坑，玄坑，毒坑,减冰，减火，减玄，减毒，减冰下限，减火下限，减玄下限，减毒下限
	local jt_buff = x892002_Get_JingTong(sceneId, selfId)
	---令牌BUFF：力量 灵气 体力 定力 身法 冰攻，火攻，玄攻，毒攻 外攻 内攻 物防 内防  闪  命中  血
	local lp_buff = x892002_Get_LingPai(sceneId, selfId,109)
	---王权BUFF：1-5五属性，6789属性，10-13属性抗，14-17外攻内防外防内防，18HP,19MP,20命中，21闪避，22会心，23会防，24所有属性
	local wq_buff = x892002_Get_WangQuan(sceneId,selfId)
	local WhBUFF = x892002_WHget_sx(sceneId, selfId)-----武魂BUFF 君奉天重新整理 
	local NewBuff = {}
	NewBuff[1] = jt_buff[6]+lw_buff[2]+lp_buff[6]+wq_buff[6]+WhBUFF[1]  --得到冰属性 宝剑/神鼎/雕纹/龙纹/令牌/真元/武魂 15
	NewBuff[2] = jt_buff[7]+lw_buff[3]+lp_buff[7]+wq_buff[7]+WhBUFF[2]  --得到火属性 宝剑/神鼎/雕纹/龙纹/令牌/真元/武魂  15
	NewBuff[3] = jt_buff[8]+lw_buff[4]+lp_buff[8]+wq_buff[8]+WhBUFF[3]  --得到玄属性 宝剑/神鼎/雕纹/龙纹/令牌/真元/武魂   15
	NewBuff[4] = jt_buff[9]+lw_buff[5]+lp_buff[9]+wq_buff[9]+WhBUFF[4]  --得到毒属性 宝剑/神鼎/雕纹/龙纹/令牌/真元/武魂   15
	------------------------------------------------------
	NewBuff[5] = lp_buff[10]+wq_buff[10]+WhBUFF[5]     --得到冰抗性 宝剑/雕纹/令牌/武魂 4
	NewBuff[6] = lp_buff[11]+wq_buff[11]+WhBUFF[6]   --得到火抗性 宝剑/雕纹/令牌/武魂 4
	NewBuff[7] = lp_buff[12]+wq_buff[12]+WhBUFF[7]  --得到玄抗性 宝剑/雕纹/令牌/武魂 4
	NewBuff[8] = lp_buff[13]+wq_buff[13]+WhBUFF[8]   --得到毒抗性 宝剑/雕纹/令牌/武魂 4
	------------------------------------------------------
	NewBuff[9] = lp_buff[14]+WhBUFF[9]            --得到冰减抗性  宝剑/雕纹/武魂 4
	NewBuff[10] = lp_buff[15]+WhBUFF[10]           --得到火减抗性  宝剑/雕纹/武魂 4
	NewBuff[11] = lp_buff[16]+WhBUFF[11]           --得到玄减抗性  宝剑/雕纹/武魂 4
	NewBuff[12] = lp_buff[17]+WhBUFF[12]           --得到毒减抗性  宝剑/雕纹/武魂 4
	------------------------------------------------------
	NewBuff[13] = jt_buff[1]+lp_buff[1]+wq_buff[1]     --得到 修炼力量/雕纹/领牌/真元 10
	NewBuff[14] = jt_buff[2]+lp_buff[2]+wq_buff[2]     --得到 修炼灵气/雕纹/领牌/真元 10
	NewBuff[15] = jt_buff[3]+lp_buff[3]+wq_buff[3]  --得到 修炼体力/神鼎体力/雕纹/领牌/真元 10
	NewBuff[16] = jt_buff[4]+lp_buff[4]+wq_buff[4]     --得到 修炼定力/雕纹/领牌/真元 10
	NewBuff[17] = jt_buff[5]+lp_buff[5]+wq_buff[5]      --得到 修炼身法/雕纹/领牌/真元 10
	
	NewBuff[18]= lw_buff[1]      ----得到百分比血上限 龙纹,兵圣 (每级加3%)
	NewBuff[19]= lp_buff[25]+wq_buff[23]                  --会心防御 真元 2
	-----------------------------------------------------
	NewBuff[20]= jt_buff[16]+lp_buff[26]+wq_buff[18]  ----得到血上限   宝鉴/令牌/真元 1000
	NewBuff[21]= jt_buff[10]+lp_buff[18]+wq_buff[14]        --外功 令牌+真元 200
	NewBuff[22]= jt_buff[11]+lp_buff[19]+wq_buff[15]        --内功 令牌+真元 200
	NewBuff[23]= jt_buff[12]+lp_buff[20]+wq_buff[16]      --外防 令牌+真元 100
	NewBuff[24]= jt_buff[13]+lp_buff[21]+wq_buff[17]      --内防 令牌+真元 100
	NewBuff[25]= jt_buff[15]+lp_buff[23]+wq_buff[20]      --命中 宝鉴/令牌/真元 100
	NewBuff[26]= jt_buff[14]+lp_buff[22]+wq_buff[21]       --闪避 令牌+真元 80
	NewBuff[27]= lp_buff[24]+wq_buff[22]                  --会心攻击 真元 3
	
	local scstr = ""
	local scstr1 = ""
	for i ,data in NewBuff do
		NewBuff[i] = floor(data/BuffJi[i][3])
	end
	local JXXtable = {lw_buff[6]+WhBUFF[13]+XiaoXiang_nFbtb[20]+XiaoXiang_nFbtb2[20] ,lw_buff[7]+WhBUFF[14]+XiaoXiang_nFbtb[21]+XiaoXiang_nFbtb2[21] ,lw_buff[8]+WhBUFF[15]+XiaoXiang_nFbtb[22]+XiaoXiang_nFbtb2[22] ,lw_buff[9]+WhBUFF[16]+XiaoXiang_nFbtb[23]+XiaoXiang_nFbtb2[23] }
	local AllJXX = 0
	for i=1 ,4 do 
		if GetMissionData( sceneId, selfId, i+501) ~= JXXtable[i] then 
		   SetMissionData( sceneId, selfId, i+501,JXXtable[i] )      
		end
		if JXXtable[i] > AllJXX then 
			AllJXX = JXXtable[i] ----只取最大值加减抗下限
		end
	end

	if AllJXX >0 then 
		LuaFnSendSpecificImpactToUnit(sceneId, selfId, selfId, selfId, 12901+AllJXX, 0)
	else
		for i=12901 ,12960 do
			if LuaFnHaveImpactOfSpecificDataIndex(sceneId, selfId, i ) == 1 then
				LuaFnCancelSpecificImpact(sceneId,selfId,i)
			end
		end
	end
    return NewBuff
end

--考虑放在别的脚本内，shuaxingclient进行调用
--返回的值分别为（0~499)的buff的索引(闭区间),以及（0~275000）步长为500的索引(闭区间)
x892002_g_buffNew = {
	["冰攻"] = {17000, 17499, 17500, 18049},
	["火攻"] = {18050, 18549, 18550, 19099},
	["玄攻"] = {19100, 19599, 19600, 20149},
	["毒攻"] = {20150, 20649, 20650, 21199},
	["力量"] = {13000, 13499, 13500, 13699},
	["灵气"] = {13700, 14199, 14200, 14399},
	["体力"] = {14400, 14899, 14900, 15599},
	["定力"] = {15600, 16099, 16100, 16299},
	["身法"] = {16300, 16799, 16800, 16999}
}

x892002_g_numToChar = {[1]="冰攻",[2]="火攻",[3]="玄攻",[4]="毒攻",[13]="力量",[14]="灵气",
[15]="体力",[16]="定力",[17]="身法"}


--算法介绍
--1. 对需要传入的值进行取500的模，获得（0~499）的值
--2. 对需要传入的值进行除500的运算，获得（0~275000）的值
function x892002_SetAbility(sceneId,selfId,opcode,value)
	local head1,tail1,head2,tail2 = x892002_g_buffNew[opcode][1],x892002_g_buffNew[opcode][2],x892002_g_buffNew[opcode][3],x892002_g_buffNew[opcode][4]
	--x892002_ShowNotice(sceneId,selfId,"内容head1"..head1.."tail1"..tail1.."head2"..head2.."tail2"..tail2)

	local lefting = value - 500 * floor(value/500)
	local lefting2 = floor(value/500)

	if lefting + head1 > tail1 then
		lefting = tail1
	end

	if lefting2 + head2 > tail2 then
		lefting2 = tail2
	end

	LuaFnSendSpecificImpactToUnit(sceneId, selfId, selfId, selfId, lefting + head1, 0)
	LuaFnSendSpecificImpactToUnit(sceneId, selfId, selfId, selfId, lefting2 + head2, 0)
end
--算法介绍
--1. 逆算法
function x892002_GetAbility(sceneId,selfId,opcode)
	local head1,tail1,head2,tail2 = x892002_g_buffNew[opcode][1],x892002_g_buffNew[opcode][2],x892002_g_buffNew[opcode][3],x892002_g_buffNew[opcode][4]
	local value1,value2 = 0,0
	for i = head1,tail1 do
		if LuaFnHaveImpactOfSpecificDataIndex(sceneId, selfId, i) == 1 then
			value1 = i
			break
		end
	end
	for i = head2,tail2 do
		if LuaFnHaveImpactOfSpecificDataIndex(sceneId, selfId, i) == 1 then
			value2 = i
			break
		end
	end
	return (value1 - head1 + (value2 - head2) * 500)
end

function x892002_ShowNotice( sceneId, selfId, strNotice)
	BeginEvent( sceneId )
		AddText( sceneId, strNotice )
	EndEvent( sceneId )
	DispatchMissionTips( sceneId, selfId )    
end
	
function x892002_AHa_ReMyBuff(sceneId, selfId)  --函数入口
	local JftBUFF = x892002_JunFengTianBuff(sceneId, selfId)  --函数入口
	---local WQSLD = mod(GetMissionData(sceneId,selfId,XIEZI_SL),1000)--------王权保存数据，要废弃
	local FutiBUFF = x892002_FutiBUFF( sceneId, selfId )
	local GetZHENy = x892002_GetZhenYuan( sceneId, selfId )
	local InfantBUFF = x892002_InfantBUFF(sceneId, selfId)
	local InfantBUFF2 = x892002_InfantBUFF2(sceneId, selfId)
	--17~24分别为属性攻击，体力，灵气，力量，身法（废除步长为15的雕文（四大属性攻击，属性上））
	local DWBuff = x892002_Get_DWXS(sceneId, selfId)	 --雕纹BUFF 君奉天重新整理
	local BaoJianBuff = x892002_GetBaoJianBuff(sceneId, selfId)  --宝鉴BUFF 君奉天重新整理
	local XiulianBuff= x892002_GetXiuLianBuff(sceneId, selfId) --修练BUFF 君奉天重新整理
	local SDBuff = x892002_GetSDBuff(sceneId, selfId)  --神鼎BUFF 君奉天重新整理
	local XiaYinBuff = x892002_GetXiaYinBuff(sceneId, selfId)  --侠印BUFF 君奉天重新整理
	local WuYibuff = x892002_GetWuYiBuff(sceneId, selfId)  --武意BUFF 君奉天重新整理 
	local XiaoXiang_nFbtb,str=XiaoXiang_WZPGetAtt1(sceneId, selfId)
	local XiaoXiang_nFbtb2,str2=XiaoXiang_WZPGetAtt2(sceneId, selfId)	
	x892002_ShengLing( sceneId, selfId )	
	x892002_QiangHua(sceneId,selfId)
	x892002_DiaoYong(sceneId,selfId)
	local NewBuff = {}
	NewBuff[1] =JftBUFF[1]+BaoJianBuff[1]+(SDBuff[2]*2)+DWBuff[5]+XiaYinBuff[3]+GetZHENy[16]+InfantBUFF[16]+ WuYibuff[2]+FutiBUFF[1]+floor((XiaoXiang_nFbtb[2]+XiaoXiang_nFbtb2[2])/15)   --得到冰属性/宝剑/审定/雕纹
	NewBuff[2] =JftBUFF[2]+BaoJianBuff[2]+(SDBuff[3]*2)+DWBuff[6]+XiaYinBuff[4]+GetZHENy[17]+InfantBUFF[17]+ WuYibuff[3]+FutiBUFF[2]+floor((XiaoXiang_nFbtb[3]+XiaoXiang_nFbtb2[3])/15)   --得到火属性/宝剑/审定/雕纹
	NewBuff[3] =JftBUFF[3]+BaoJianBuff[3]+(SDBuff[4]*2)+DWBuff[7]+XiaYinBuff[5]+GetZHENy[18]+InfantBUFF[18]+ WuYibuff[4]+FutiBUFF[3]+floor((XiaoXiang_nFbtb[4]+XiaoXiang_nFbtb2[4])/15)    --得到玄属性/宝剑/审定/雕纹
	NewBuff[4] =JftBUFF[4]+BaoJianBuff[4]+(SDBuff[5]*2)+DWBuff[8]+XiaYinBuff[6]+GetZHENy[19]+InfantBUFF[19]+ WuYibuff[5]+FutiBUFF[4]+floor((XiaoXiang_nFbtb[5]+XiaoXiang_nFbtb2[5])/15)    --得到毒属性/宝剑/审定/雕纹
	NewBuff[5] =JftBUFF[5]+(SDBuff[6]*2)+BaoJianBuff[5]+DWBuff[13]+InfantBUFF2[1]+floor((XiaoXiang_nFbtb[6]+XiaoXiang_nFbtb2[6])/4)    --得到冰抗性/宝剑/雕纹
	NewBuff[6] =JftBUFF[6]+(SDBuff[7]*2)+BaoJianBuff[6]+DWBuff[14]+InfantBUFF2[2]+floor((XiaoXiang_nFbtb[7]+XiaoXiang_nFbtb2[7])/4)  --得到火抗性/宝剑/雕纹
	NewBuff[7] =JftBUFF[7]+(SDBuff[8]*2)+BaoJianBuff[7]+DWBuff[15]+InfantBUFF2[3]+floor((XiaoXiang_nFbtb[8]+XiaoXiang_nFbtb2[8])/4)  --得到玄抗性/宝剑/雕纹
	NewBuff[8] =JftBUFF[8]+(SDBuff[9]*2)+BaoJianBuff[8]+DWBuff[16]+InfantBUFF2[4]+floor((XiaoXiang_nFbtb[9]+XiaoXiang_nFbtb2[9])/4)  --得到毒抗性/宝剑/雕纹
	
	NewBuff[9] =JftBUFF[9]+(SDBuff[10]*2)+BaoJianBuff[9]+DWBuff[9]+XiaYinBuff[7]+InfantBUFF2[5]+floor((XiaoXiang_nFbtb[10]+XiaoXiang_nFbtb2[10])/4)  --得到冰减抗性/宝剑/雕纹/龙纹
	NewBuff[10] =JftBUFF[10]+(SDBuff[11]*2)+BaoJianBuff[10]+DWBuff[10]+XiaYinBuff[8]+InfantBUFF2[6]+floor((XiaoXiang_nFbtb[11]+XiaoXiang_nFbtb2[11])/4)   --得到火减抗性/宝剑/雕纹/龙纹
	NewBuff[11] =JftBUFF[11]+(SDBuff[12]*2)+BaoJianBuff[11]+DWBuff[11]+XiaYinBuff[9]+InfantBUFF2[7]+floor((XiaoXiang_nFbtb[12]+XiaoXiang_nFbtb2[12])/4)  --得到玄减抗性/宝剑/雕纹
	NewBuff[12] =JftBUFF[12]+(SDBuff[13]*2)+BaoJianBuff[12]+DWBuff[12]+XiaYinBuff[10]+InfantBUFF2[8]+floor((XiaoXiang_nFbtb[13]+XiaoXiang_nFbtb2[13])/4)   --得到毒减抗性/宝剑/雕纹
	---------------------------------------------------------------
	NewBuff[13] =JftBUFF[13]+ XiulianBuff[1]+DWBuff[3]+GetZHENy[1]+InfantBUFF[1]  --得到修炼力量/雕纹
	NewBuff[14] =JftBUFF[14]+ XiulianBuff[2]+DWBuff[2]+GetZHENy[2]+InfantBUFF[2] --得到修炼灵气/雕纹
	NewBuff[15] =JftBUFF[15]+ XiulianBuff[3]+SDBuff[1]+XiaYinBuff[1]+DWBuff[1]+GetZHENy[3]+InfantBUFF[3]+floor((XiaoXiang_nFbtb[16]+XiaoXiang_nFbtb2[16])/10)  --得到修炼体力/审订体力/雕纹/侠印
	NewBuff[16] =JftBUFF[16]+ XiulianBuff[4]+GetZHENy[4]+InfantBUFF[4] --得到修炼定力
	NewBuff[17] =JftBUFF[17]+ XiulianBuff[5]+XiaYinBuff[1]+DWBuff[4]+GetZHENy[5]+InfantBUFF[5]+floor((XiaoXiang_nFbtb[17]+XiaoXiang_nFbtb2[17])/10)  --得到修炼身法/雕纹/侠印
	-------------------------------------------------------
	NewBuff[18] =JftBUFF[18]+ 0  --百分百血上限
	NewBuff[19] =JftBUFF[19]+ GetZHENy[15]+InfantBUFF[15]
	NewBuff[20] =JftBUFF[20]+ BaoJianBuff[13]+XiaYinBuff[1]+GetZHENy[6]+InfantBUFF[6]+ WuYibuff[1]+FutiBUFF[9]+floor((XiaoXiang_nFbtb[1]+XiaoXiang_nFbtb2[1])/1000)  ----得到血上限 宝剑/令牌/武意
	NewBuff[21] =JftBUFF[21]+ XiulianBuff[6]+GetZHENy[9]+InfantBUFF[9] --外功
	NewBuff[22] =JftBUFF[22]+ XiulianBuff[7]+GetZHENy[8]+InfantBUFF[8] --内功
	NewBuff[23] =JftBUFF[23]+ XiulianBuff[8]+GetZHENy[11]+InfantBUFF[11] --外防
	NewBuff[24] =JftBUFF[24]+ XiulianBuff[9]+GetZHENy[10]+InfantBUFF[10] --内防
	NewBuff[25] =JftBUFF[25]+ XiulianBuff[10]+ BaoJianBuff[14]+XiaYinBuff[2]+GetZHENy[12]+InfantBUFF[12]+ WuYibuff[6]+FutiBUFF[10]+floor((XiaoXiang_nFbtb[14]+XiaoXiang_nFbtb2[14])/100)  --得到命中/宝剑/侠印
	NewBuff[26] =JftBUFF[26]+ XiulianBuff[11]+XiaYinBuff[2]+GetZHENy[13]+InfantBUFF[13]+ WuYibuff[7]+FutiBUFF[11]+floor((XiaoXiang_nFbtb[15]+XiaoXiang_nFbtb2[15])/80) --闪避
	NewBuff[27] =JftBUFF[27]+ GetZHENy[14]+InfantBUFF[14]+floor((XiaoXiang_nFbtb[18]+XiaoXiang_nFbtb2[18])/10/3) --会心
	
	--x892002_ShowNotice(sceneId,selfId,"被调用了")
	for i=1 ,getn(NewBuff) do
		if NewBuff[i] and BuffJi[i] and x892002_g_numToChar[i] == nil  then
			--local big_step = floor(NewBuff[i]/BuffJi[i][3]) ---得到大步
			--local big_step = floor(NewBuff[i]/BuffJi[i][3]) ---得到大步
			if NewBuff[i] >0   then --------加大步BUFF
				local big_addbuff = BuffJi[i][1]+NewBuff[i]
				if  big_addbuff > BuffJi[i][2] then
					big_addbuff = BuffJi[i][2]  ----避免最大值超标
				end
				if LuaFnHaveImpactOfSpecificDataIndex(sceneId, selfId, big_addbuff ) ~= 1 then
					LuaFnSendSpecificImpactToUnit(sceneId, selfId, selfId, selfId, big_addbuff, 0)
				end
			else
				for i=BuffJi[i][1] ,BuffJi[i][2] do
					if LuaFnHaveImpactOfSpecificDataIndex(sceneId, selfId, i ) == 1 then
						LuaFnCancelSpecificImpact(sceneId,selfId,i)
					end
				end
			end
		end
	end
	--计算新版真元
	local zytable = {}
	zytable[1] = 0
	zytable[2] = 0
	zytable[3] = 0
	zytable[4] = 0
	zytable[13] = 0
	zytable[14] = 0
	zytable[15] = 0
	zytable[16] = 0
	zytable[17] = 0

	for i=1,12 do
		local rawpos = x892002_g_ZYtable[i]
		local rawValue = GetMissionData(sceneId,selfId,rawpos)
		if rawValue > 0 and x892002_g_numToChar[floor(rawValue/100000000)] ~= nil then
			local type = floor(rawValue/100000000)
			local value = rawValue - type * 100000000
			zytable[type] = zytable[type] + value
		end
	end

	--获取魂器
	local attr = {}
	for i=1,4 do
		attr[i] = 0
	end
	local charToChar = {[1]="bg",[2]="hg",[3]="xg",[4]="dg"}
	local pos = GetItemBagPos( sceneId, selfId, 39910023, 0 )
	if pos ~=nil and pos > 0 then
		local _,skilstring = LuaFnGetItemCreator(sceneId, selfId,pos)

		if skilstring == nil or skilstring == "" then
			skilstring = "&A0bg0hg0xg0dg0"
		end
		for i=1,4 do
			_,_,attr[i] = strfind(skilstring,charToChar[i].."(%d+)")
			attr[i] = tonumber(attr[i])
		end
	end

	--这里重写属性添加的功能（属性攻击，基本人物5大属性）
	--目前来说属性步长10，属性攻击15
	for i=1,4 do
		x892002_SetAbility(sceneId,selfId,x892002_g_numToChar[i],NewBuff[i] * 15 + DWBuff[i+16] + zytable[i] + attr[i])
	end
	local dw = {DWBuff[23],DWBuff[22],DWBuff[21],0,DWBuff[24]}
	for i=13,17 do
		x892002_SetAbility(sceneId,selfId,x892002_g_numToChar[i],NewBuff[i] * 10 + dw[i-12] + zytable[i])
	end
	
	x892002_DelSSitem(sceneId, selfId)
	x892002_GetWUqibuff(sceneId, selfId)
	x892002_FUTI( sceneId, selfId )
	CallScriptFunction( 891175, "AddXuiWeiSuXing", sceneId, selfId )
	CallScriptFunction( 390101, "ReGongLi", sceneId, selfId )
	
end

------武器 重楼buff
function x892002_GetWUqibuff(sceneId, selfId)


	local g_x892002_CC1 = {}----重楼链
	local g_x892002_CC2 = {}----重楼戒
	local g_x892002_CC3 = {}----重楼玉
	local g_x892002_CC4 = {}----重楼带
	local g_x892002_CC5 = {}----重楼肩
	local g_x892002_CC6 = {}----重楼甲
	local g_x892002_CC7 = {}----武魂	
	local g_x892002_CC8 = {}----重楼盔	
	local g_x892002_CC9 = {}----暗器		
	local g_x892002_CC = {   ----神器
	[10300000]=9000 ,[10300001]=9000,[10300002]=9000,[10300003]=9000,[10300004]=9000,[10300005]=9000,[10300006]=9004
	,[10300007]=9004,[10300100]=9132,[10300101]=9133,[10300102]=9134,[10300103]=9132,[10300104]=9133,[10300105]=9134
	,[10300106]=9132,[10300107]=9133,[10300108]=9134,[10300109]=9132,[10300110]=9133,[10300111]=9134,[10300400]=9004
	,[10300401]=8064,[10300402]=9004,[10300403]=8064,[10300404]=9132,[10300405]=9133,[10300406]=9134,[10300407]=9132
	,[10300408]=9133,[10300409]=9134,[10300410]=9132,[10300411]=9133,[10300412]=9134,[10300413]=9300,[10300414]=9301
	,[10300415]=9302,[10300416]=9300,[10300417]=9301,[10300418]=9302,[10300419]=9300,[10300420]=9301,[10300421]=9302
	,[10300422]=9000,[10301000]=9005,[10301001]=9005,[10301100]=9141,[10301101]=9142,[10301102]=9143,[10301103]=9141
	,[10301104]=9142,[10301105]=9143,[10301106]=9141,[10301107]=9142,[10301108]=9143,[10301109]=9141,[10301110]=9142
	,[10301111]=9143,[10301198]=9006,[10301199]=9006,[10301200]=9153,[10301201]=9154,[10301202]=9155,[10301203]=9153
	,[10301204]=9154,[10301205]=9155,[10301206]=9153,[10301207]=9154,[10301208]=9155,[10301209]=9153,[10301210]=9154
	,[10301211]=9155,[10301400]=9005,[10301401]=9006,[10301402]=8065,[10301403]=8066,[10301404]=9005,[10301405]=9006
	,[10301406]=8065,[10301407]=8066,[10301408]=9141,[10301409]=9142,[10301410]=9143,[10301411]=9141,[10301412]=9142
    ,[10301413]=9143,[10301414]=9141,[10301415]=9142,[10301430]=9304,[10301431]=9305,[10301432]=9303,[10301433]=9304
	,[10301416]=9143,[10301417]=9153,[10301418]=9154,[10301419]=9155,[10301420]=9153,[10301421]=9154,[10301422]=9155
	,[10301423]=9153,[10301424]=9154,[10301425]=9155,[10301426]=9303,[10301427]=9304,[10301428]=9305,[10301429]=9303
	,[10301434]=9305,[10301435]=9306,[10301436]=9307,[10301437]=9308,[10301438]=9306,[10301439]=9307,[10301440]=9308
	,[10301441]=9306,[10301442]=9307,[10301443]=9308,[10302000]=9010,[10302001]=9010,[10302002]=9010,[10302003]=9010
	,[10302004]=9010,[10302005]=9010,[10302006]=9014,[10302007]=9014,[10302008]=9015,[10302009]=9015,[10302010]=9016
	,[10302011]=9016,[10302100]=9135,[10302101]=9136,[10302102]=9137,[10302103]=9135,[10302104]=9136,[10302105]=9137
	,[10302106]=9135,[10302107]=9136,[10302108]=9137,[10302109]=9135,[10302110]=9136,[10302111]=9137,[10302200]=9192
	,[10302201]=9193,[10302202]=9194,[10302203]=9192,[10302204]=9193,[10302205]=9194,[10302206]=9192,[10302207]=9193
	,[10302208]=9194,[10302209]=9192,[10302210]=9193,[10302211]=9194,[10302400]=9014,[10302401]=9015,[10302402]=9016
	,[10302403]=8067
	,[10302404]=8068
	,[10302405]=8115
	,[10302406]=9014
	,[10302407]=9015
	,[10302408]=9016
	,[10302409]=8067
	,[10302410]=8068
	,[10302411]=8115
	,[10302412]=9135
	,[10302413]=9136
	,[10302414]=9137
	,[10302415]=9135
	,[10302416]=9136
	,[10302417]=9137
	,[10302418]=9135
	,[10302419]=9136
	,[10302420]=9137
	,[10302421]=9192
	,[10302422]=9193
	,[10302423]=9194
	,[10302424]=9192
	,[10302425]=9193
	,[10302426]=9194
	,[10302427]=9192
	,[10302428]=9193
	,[10302429]=9194
	,[10302430]=9309
	,[10302431]=9310
	,[10302432]=9311
	,[10302433]=9309
	,[10302434]=9310
	,[10302435]=9311
	,[10302436]=9309
	,[10302437]=9310
	,[10302438]=9311
	,[10302439]=9312
	,[10302440]=9313
	,[10302441]=9314
	,[10302442]=9312
	,[10302443]=9313
	,[10302444]=9314
	,[10302445]=9312
	,[10302446]=9313
	,[10302447]=9314
	,[10302448]=9010
	,[10303000]=9017
	,[10303001]=9017
	,[10303100]=9138
	,[10303101]=9139
	,[10303102]=9140
	,[10303103]=9138
	,[10303104]=9139
	,[10303105]=9140
	,[10303106]=9138
	,[10303107]=9139
	,[10303108]=9140
	,[10303109]=9138
	,[10303110]=9139
	,[10303111]=9140
	,[10303200]=9147
	,[10303201]=9148
	,[10303202]=9149
	,[10303203]=9147
	,[10303204]=9148
	,[10303205]=9149
	,[10303206]=9147
	,[10303207]=9148
	,[10303208]=9149
	,[10303209]=9147
	,[10303210]=9148
	,[10303211]=9149
	,[10303400]=9017
	,[10303401]=9017
	,[10303402]=9017
	,[10303403]=8069
	,[10303404]=9138
	,[10303405]=9139
	,[10303406]=9140
	,[10303407]=9138
	,[10303408]=9139
	,[10303409]=9140
	,[10303410]=9138
	,[10303411]=9139
	,[10303412]=9140
	,[10303413]=9147
	,[10303414]=9148
	,[10303415]=9149
	,[10303416]=9147
	,[10303417]=9148
	,[10303418]=9149
	,[10303419]=9147
	,[10303420]=9148
	,[10303421]=9149
	,[10303422]=9315
	,[10303423]=9316
	,[10303424]=9317
	,[10303425]=9315
	,[10303426]=9316
	,[10303427]=9317
	,[10303428]=9315
	,[10303429]=9316
	,[10303430]=9317
	,[10303431]=9318
	,[10303432]=9319
	,[10303433]=9320
	,[10303434]=9318
	,[10303435]=9319
	,[10303436]=9320
	,[10303437]=9318
	,[10303438]=9319
	,[10303439]=9320
	,[10304000]=9030
	,[10304001]=9030
	,[10304002]=9030
	,[10304003]=9030
	,[10304004]=9030
	,[10304005]=9030
	,[10304006]=9034
	,[10304007]=9034
	,[10304008]=9034
	,[10304009]=9034
	,[10304100]=9156
	,[10304101]=9157
	,[10304102]=9158
	,[10304103]=9156
	,[10304104]=9157
	,[10304105]=9158
	,[10304106]=9156
	,[10304107]=9157
	,[10304108]=9158
	,[10304109]=9156
	,[10304110]=9157
	,[10304111]=9158
	,[10304400]=9034
	,[10304401]=9034
	,[10304402]=9034
	,[10304403]=9034
	,[10304404]=9034
	,[10304405]=9034
	,[10304406]=9034
	,[10304407]=8070
	,[10304408]=9156
	,[10304409]=9157
	,[10304410]=9158
	,[10304411]=9156
	,[10304412]=9157
	,[10304413]=9158
	,[10304414]=9156
	,[10304415]=9157
	,[10304416]=9158
	,[10304417]=9321
	,[10304418]=9322
	,[10304419]=9323
	,[10304420]=9321
	,[10304421]=9322
	,[10304422]=9323
	,[10304423]=9321
	,[10304424]=9322
	,[10304425]=9323
	,[10304426]=9030
	,[10305000]=9020
	,[10305001]=9020
	,[10305002]=9020
	,[10305003]=9020
	,[10305004]=9020
	,[10305005]=9020
	,[10305006]=9024
	,[10305007]=9024
	,[10305008]=9024
	,[10305009]=9024
	,[10305100]=9144
	,[10305101]=9145
	,[10305102]=9146
	,[10305103]=9144
	,[10305104]=9145
	,[10305105]=9146
	,[10305106]=9144
	,[10305107]=9145
	,[10305108]=9146
	,[10305109]=9144
	,[10305110]=9145
	,[10305111]=9146
	,[10305200]=9150
	,[10305201]=9151
	,[10305202]=9152
	,[10305203]=9150
	,[10305204]=9151
	,[10305205]=9152
	,[10305206]=9150
	,[10305207]=9151
	,[10305208]=9152
	,[10305209]=9150
	,[10305210]=9151
	,[10305211]=9152
	,[10305400]=9024
	,[10305401]=9025
	,[10305402]=9024
	,[10305403]=9025
	,[10305404]=9024
	,[10305405]=9025
	,[10305406]=8071
	,[10305407]=8072
	,[10305408]=9144
	,[10305409]=9145
	,[10305410]=9146
	,[10305411]=9144
	,[10305412]=9145
	,[10305413]=9146
	,[10305414]=9144
	,[10305415]=9145
	,[10305416]=9146
	,[10305417]=9150
	,[10305418]=9151
	,[10305419]=9152
	,[10305420]=9150
	,[10305421]=9151
	,[10305422]=9152
	,[10305423]=9150
	,[10305424]=9151
	,[10305425]=9152
	,[10305426]=9324
	,[10305427]=9325
	,[10305428]=9326
	,[10305429]=9324
	,[10305430]=9325
	,[10305431]=9326
	,[10305432]=9324
	,[10305433]=9325
	,[10305434]=9326
	,[10305435]=9327
	,[10305436]=9328
	,[10305437]=9329
	,[10305438]=9327
	,[10305439]=9328
	,[10305440]=9329
	,[10305441]=9327
	,[10305442]=9328
	,[10305443]=9329
	,[10305444]=9020
	,[10306000]=9035
	,[10306001]=9035
	,[10306002]=9035
	,[10306003]=9035
	,[10306004]=9035
	,[10306005]=9035
	,[10306006]=9036
	,[10306007]=9036
	,[10306008]=9036
	,[10306009]=9036
	,[10306010]=9026
	,[10306011]=9026
	,[10306012]=9037
	,[10306013]=9038
	,[10306014]=9039
	,[10306015]=9037
	,[10306016]=9038
	,[10306017]=9039
	,[10306018]=9037
	,[10306019]=9038
	,[10306020]=9039
	,[10306021]=9037
	,[10306022]=9038
	,[10306023]=9039
	,[10306024]=9037
	,[10306025]=9038
	,[10306026]=9039
	,[10306027]=9037
	,[10306028]=9038
	,[10306029]=9039
	,[10306030]=9037
	,[10306031]=9038
	,[10306032]=9039
	,[10306033]=9330
	,[10306034]=9331
	,[10306035]=9332
	,[10306036]=9330
	,[10306037]=9331
	,[10306038]=9332
	,[10306039]=9330
	,[10306040]=9331
	,[10306041]=9332
	,[10306042]=9035
	,[10307000]=9049
	,[10307001]=9049
	,[10307002]=9049
	,[10307003]=9049
	,[10307004]=9049
	,[10307005]=9049
	,[10307006]=9050
	,[10307007]=9050
	,[10307008]=9050
	,[10307009]=9050
	,[10307010]=9050
	,[10307011]=9050
	,[10307012]=9051
	,[10307013]=9052
	,[10307014]=9053
	,[10307015]=9051
	,[10307016]=9052
	,[10307017]=9053
	,[10307018]=9051
	,[10307019]=9052
	,[10307020]=9053
	,[10307021]=9051
	,[10307022]=9052
	,[10307023]=9053
	,[10307024]=9051
	,[10307025]=9052
	,[10307026]=9053
	,[10307027]=9051
	,[10307028]=9052
	,[10307029]=9053
	,[10307030]=9051
	,[10307031]=9052
	,[10307032]=9053
	,[10307033]=9333
	,[10307034]=9334
	,[10307035]=9335
	,[10307036]=9333
	,[10307037]=9334
	,[10307038]=9335
	,[10307039]=9333
	,[10307040]=9334
	,[10307041]=9335
	,[10307042]=9049
	,[10308000]=9027	
	,[10308001]=9027	
	,[10308002]=9027	
	,[10308003]=9027	
	,[10308004]=9027	
	,[10308005]=9027	
	,[10308006]=9028	
	,[10308007]=9028	
	,[10308008]=9028	
	,[10308009]=9028		
	,[10308010]=9029
	,[10308011]=9029	
	,[10308012]=9100
	,[10308013]=9101
	,[10308014]=9102
	,[10308015]=9100
	,[10308016]=9101
	,[10308017]=9102
	,[10308018]=9100
	,[10308019]=9101
	,[10308020]=9102
	,[10308021]=9100
	,[10308022]=9101
	,[10308023]=9102	
	,[10308024]=9100
	,[10308025]=9101
	,[10308026]=9102
	,[10308027]=9100
	,[10308028]=9101
	,[10308029]=9102
	,[10308030]=9100
	,[10308031]=9101
	,[10308032]=9102		
	,[10308033]=9106	
	,[10308034]=9107	
	,[10308035]=9108
	,[10308036]=9106	
	,[10308037]=9107	
	,[10308038]=9108
	,[10308039]=9106	
	,[10308040]=9107	
	,[10308041]=9108	
	,[10308042]=9027	
	
	
	,[10305021]=9060--普通花类武器
	,[10305022]=9060
	,[10305023]=9060
	,[10305024]=9060
	,[10305025]=9060
	,[10305026]=9060
	,[10305027]=9060
	,[10305028]=9060
	,[10305029]=9060
	,[10305030]=9060
	,[10305031]=9060
	,[10305032]=9060
	,[10305033]=9060
	,[10305034]=9060
	,[10305035]=9060
	
	,[10305281]=9061--四代花类武器
	,[10305282]=9061
	,[10305283]=9061
	,[10305284]=9061
	,[10305285]=9061
	,[10305286]=9061
	,[10305287]=9061
	,[10305288]=9061
	,[10305289]=9061
	,[10305290]=9061
	,[10305291]=9061
	,[10305292]=9061
	,[10305293]=9061
	,[10305294]=9061
	,[10305295]=9061
	
	,[10102201]=9062--幻饰武器
	,[10102202]=9062
	,[10102203]=9062
	,[10102204]=9062
	,[10102205]=9062
	,[10102206]=9062
	,[10102207]=9062
	,[10102208]=9062
	,[10102209]=9062
	,[10102210]=9062
	,[10102211]=9062
	,[10102212]=9062
	,[10102213]=9062
	,[10102214]=9062
	,[10102215]=9062
	,[10102216]=9062
	,[10102217]=9062
	,[10102218]=9062
	,[10102219]=9062
	,[10102220]=9062
	,[10102221]=9062
	,[10102222]=9062
	,[10102223]=9062
	,[10102224]=9062
	,[10102225]=9062
	,[10102226]=9062
	,[10102227]=9062
	,[10102228]=9062
	,[10102229]=9062
	,[10102230]=9062	
	,[10102231]=9062
	,[10102232]=9062
	,[10102233]=9062
	,[10102234]=9062
	,[10102235]=9062
	,[10102236]=9062
	,[10102237]=9062
	,[10102238]=9062
	,[10102239]=9062
	,[10102240]=9062
	,[10102241]=9062
	,[10102242]=9062
	,[10102243]=9062
	,[10102244]=9062
	,[10102245]=9062
	,[10102246]=9062
	,[10102247]=9062	
	,[10102248]=9062
	,[10102249]=9062
	,[10102250]=9062
	,[10102251]=9062	
	,[10102252]=9062
	,[10102253]=9062
	,[10102254]=9062	
	,[10102255]=9062	
	,[10102256]=9062	
	,[10102257]=9062	
	,[10102258]=9062	
	,[10102259]=9062	
	,[10102260]=9062	
	,[10102261]=9062	
	,[10102262]=9062	
	,[10102263]=9062	
	,[10102264]=9062	
	,[10102265]=9062	
	,[10102266]=9062	
	,[10102267]=9062	
	,[10102268]=9062	
	,[10102269]=9062	
	,[10102270]=9062	
	,[10102271]=9062	
	,[10102272]=9062	
	,[10102273]=9062	
	,[10102274]=9062	
	,[10102275]=9062		
	,[10102276]=9062	
	,[10102277]=9062	
	,[10102278]=9062		
	
	
	,[10300423]=9200 --太古神器
	,[10300424]=9201
	,[10300425]=9202
	,[10300426]=9200
	,[10300427]=9201
	,[10300428]=9202
	,[10300429]=9200
	,[10300430]=9201
	,[10300431]=9202
	,[10301444]=9203
	,[10301445]=9204
	,[10301446]=9205
	,[10301447]=9203
	,[10301448]=9204
	,[10301449]=9205
	,[10301450]=9203
	,[10301451]=9204
	,[10301452]=9205
	,[10301453]=9206
	,[10301454]=9207
	,[10301455]=9208
	,[10301456]=9206
	,[10301457]=9207
	,[10301458]=9208
	,[10301459]=9206
	,[10301460]=9207
	,[10301461]=9208
	,[10302449]=9209
	,[10302450]=9210
	,[10302451]=9211
	,[10302452]=9209
	,[10302453]=9210
	,[10302454]=9211
	,[10302455]=9209
	,[10302456]=9210
	,[10302457]=9211
	,[10302458]=9227
	,[10302459]=9228
	,[10302460]=9229
	,[10302461]=9227
	,[10302462]=9228
	,[10302463]=9229
	,[10302464]=9227
	,[10302465]=9228
	,[10302466]=9229
	,[10303440]=9212
	,[10303441]=9213
	,[10303442]=9214
	,[10303443]=9212
	,[10303444]=9213
	,[10303445]=9214
	,[10303446]=9212
	,[10303447]=9213
	,[10303448]=9214
	,[10303449]=9215
	,[10303450]=9216
	,[10303451]=9217
	,[10303452]=9215
	,[10303453]=9216
	,[10303454]=9217
	,[10303455]=9215
	,[10303456]=9216
	,[10303457]=9217
	,[10304427]=9218
	,[10304428]=9219
	,[10304429]=9220
	,[10304430]=9218
	,[10304431]=9219
	,[10304432]=9220
	,[10304433]=9218
	,[10304434]=9219
	,[10304435]=9220
	,[10305445]=9221
	,[10305446]=9222
	,[10305447]=9223
	,[10305448]=9221
	,[10305449]=9222
	,[10305450]=9223
	,[10305451]=9221
	,[10305452]=9222
	,[10305453]=9223
	,[10305454]=9224
	,[10305455]=9225
	,[10305456]=9226
	,[10305457]=9224
	,[10305458]=9225
	,[10305459]=9226
	,[10305460]=9224
	,[10305461]=9225
	,[10305462]=9226
	,[10306043]=9230
	,[10306044]=9231
	,[10306045]=9232
	,[10306046]=9230
	,[10306047]=9231
	,[10306048]=9232
	,[10306049]=9230
	,[10306050]=9231
	,[10306051]=9232
	,[10307043]=9233
	,[10307044]=9234
	,[10307045]=9235
	,[10307046]=9233
	,[10307047]=9234
	,[10307048]=9235
	,[10307049]=9233
	,[10307050]=9234
	,[10307051]=9235	
	,[10308043]=9112
	,[10308044]=9113
	,[10308045]=9114
	,[10308046]=9112
	,[10308047]=9113
	,[10308048]=9114
	,[10308049]=9112
	,[10308050]=9113
	,[10308051]=9114	
	}
	g_x892002_CC1[10159100]=7513--重楼链
	g_x892002_CC1[10159110]=7515--真重楼链
	g_x892002_CC2[10159101]=7509--重楼戒
	g_x892002_CC2[10159111]=7511--真重楼戒
	g_x892002_CC3[10159102]=7501--重楼玉
	g_x892002_CC3[10159112]=7503--真重楼玉
	g_x892002_CC5[10159103]=7517--重楼肩
	g_x892002_CC5[10159113]=7518--真重楼肩
	g_x892002_CC6[10159104]=7519--重楼甲
	g_x892002_CC6[10159114]=7520--真重楼甲
    --武魂灵力	
	g_x892002_CC7[10156100]=10386--武魂灵力	
	g_x892002_CC7[10156101]=10387--武魂灵力	
	g_x892002_CC7[10156102]=10388--武魂灵力	
	g_x892002_CC7[10156103]=10389--武魂灵力	
	g_x892002_CC7[10156104]=10390--武魂灵力	
	g_x892002_CC7[10156105]=10391--武魂灵力	
	g_x892002_CC7[10156106]=10392--武魂灵力	
	g_x892002_CC7[10156107]=10393--武魂灵力	
	g_x892002_CC7[10156108]=10394--武魂灵力		
    --武魂力量
	g_x892002_CC7[10156200]=10395--武魂力量	
	g_x892002_CC7[10156201]=10396--武魂力量	
	g_x892002_CC7[10156202]=10397--武魂力量	
	g_x892002_CC7[10156203]=10398--武魂力量
	g_x892002_CC7[10156204]=10399--武魂力量	
	g_x892002_CC7[10156205]=10400--武魂力量	
	g_x892002_CC7[10156206]=10401--武魂力量	
	g_x892002_CC7[10156207]=10402--武魂力量	
	g_x892002_CC7[10156208]=10403--武魂力量	
    --重楼盔
	g_x892002_CC8[10414104]=7980--重楼盔	
	g_x892002_CC8[10414105]=7980--重楼盔
	g_x892002_CC8[10414106]=7980--重楼盔
	g_x892002_CC8[10414107]=7980--重楼盔
	g_x892002_CC8[10414108]=7980--重楼盔
	g_x892002_CC8[10414109]=7980--重楼盔
	g_x892002_CC8[10414110]=7980--重楼盔
	g_x892002_CC8[10414111]=7980--重楼盔
	g_x892002_CC8[10414112]=7980--重楼盔
	g_x892002_CC8[10414113]=7980--重楼盔
	g_x892002_CC8[10414114]=7980--重楼盔
	g_x892002_CC8[10414115]=7980--重楼盔
	g_x892002_CC8[10414116]=7980--重楼盔
	g_x892002_CC8[10414117]=7980--重楼盔
	g_x892002_CC8[10414118]=7980--重楼盔
	g_x892002_CC8[10414119]=7980--重楼盔
	g_x892002_CC8[10414120]=7980--重楼盔	
	g_x892002_CC8[10414121]=7980--重楼盔
	g_x892002_CC8[10414122]=7980--重楼盔
	g_x892002_CC8[10414123]=7980--重楼盔
	g_x892002_CC8[10414124]=7980--重楼盔
	g_x892002_CC8[10414125]=7980--重楼盔
	g_x892002_CC8[10414126]=7980--重楼盔
	g_x892002_CC8[10414127]=7980--重楼盔
	g_x892002_CC8[10414128]=7980--重楼盔
	g_x892002_CC8[10414129]=7980--重楼盔
	g_x892002_CC8[10414130]=7980--重楼盔	
	g_x892002_CC8[10414131]=7980--重楼盔
	g_x892002_CC8[10414132]=7980--重楼盔
	g_x892002_CC8[10414133]=7980--重楼盔
	g_x892002_CC8[10414134]=7980--重楼盔
	g_x892002_CC8[10414135]=7980--重楼盔
	g_x892002_CC8[10414136]=7980--重楼盔
	g_x892002_CC8[10414137]=7980--重楼盔
	g_x892002_CC8[10414138]=7980--重楼盔
	g_x892002_CC8[10414139]=7980--重楼盔
	g_x892002_CC8[10414140]=7980--重楼盔
	g_x892002_CC8[10414141]=7980--重楼盔
	g_x892002_CC8[10414142]=7980--重楼盔
	g_x892002_CC8[10414143]=7980--重楼盔
	g_x892002_CC8[10414144]=7980--重楼盔
	g_x892002_CC8[10414145]=7980--重楼盔
	g_x892002_CC8[10414146]=7980--重楼盔
	g_x892002_CC8[10414147]=7980--重楼盔
	g_x892002_CC8[10414148]=7980--重楼盔
	g_x892002_CC8[10414149]=7980--重楼盔
	g_x892002_CC8[10414150]=7980--重楼盔
	g_x892002_CC8[10414151]=7980--重楼盔
	g_x892002_CC8[10414152]=7980--重楼盔
	g_x892002_CC8[10414153]=7980--重楼盔
	g_x892002_CC8[10414154]=7980--重楼盔
	g_x892002_CC8[10414155]=7980--重楼盔
	g_x892002_CC8[10414156]=7980--重楼盔
	g_x892002_CC8[10414157]=7980--重楼盔
	g_x892002_CC8[10414158]=7980--重楼盔
	g_x892002_CC8[10414159]=7980--重楼盔
	g_x892002_CC8[10414160]=7980--重楼盔	
	g_x892002_CC8[10414161]=7980--重楼盔
	g_x892002_CC8[10414162]=7980--重楼盔
	g_x892002_CC8[10414163]=7980--重楼盔
	g_x892002_CC8[10414164]=7980--重楼盔
	g_x892002_CC8[10414165]=7980--重楼盔	
    --暗器	冰
	g_x892002_CC9[10155021]=7539--暗器		
	g_x892002_CC9[10155100]=7540--暗器	
	g_x892002_CC9[10155101]=7541--暗器	
	g_x892002_CC9[10155102]=7542--暗器	
	g_x892002_CC9[10155103]=7543--暗器	
	g_x892002_CC9[10155104]=7544--暗器	
	g_x892002_CC9[10155105]=7545--暗器	
	g_x892002_CC9[10155106]=7546--暗器	
	g_x892002_CC9[10155107]=7547--暗器	
	g_x892002_CC9[10155108]=7548--暗器	
	g_x892002_CC9[10155109]=7549--暗器	
	--暗器	火
	g_x892002_CC9[10155110]=7550--暗器	
	g_x892002_CC9[10155111]=7551--暗器
	g_x892002_CC9[10155112]=7552--暗器
	g_x892002_CC9[10155113]=7553--暗器
	g_x892002_CC9[10155114]=7554--暗器
	g_x892002_CC9[10155115]=7555--暗器
	g_x892002_CC9[10155116]=7556--暗器
	g_x892002_CC9[10155117]=7557--暗器
	g_x892002_CC9[10155118]=7558--暗器	
	g_x892002_CC9[10155119]=7559--暗器	
	--暗器	玄
	g_x892002_CC9[10155120]=7560--暗器	
	g_x892002_CC9[10155121]=7561--暗器
	g_x892002_CC9[10155122]=7562--暗器
	g_x892002_CC9[10155123]=7563--暗器
	g_x892002_CC9[10155124]=7564--暗器
	g_x892002_CC9[10155125]=7565--暗器
	g_x892002_CC9[10155126]=7566--暗器
	g_x892002_CC9[10155127]=7567--暗器
	g_x892002_CC9[10155128]=7568--暗器
	g_x892002_CC9[10155129]=7569--暗器	
	--暗器	毒	
	g_x892002_CC9[10155130]=7570--暗器	
	g_x892002_CC9[10155131]=7571--暗器	
	g_x892002_CC9[10155132]=7572--暗器	
	g_x892002_CC9[10155133]=7573--暗器	
	g_x892002_CC9[10155134]=7574--暗器	
	g_x892002_CC9[10155135]=7575--暗器	
	g_x892002_CC9[10155136]=7576--暗器	
	g_x892002_CC9[10155137]=7577--暗器	
	g_x892002_CC9[10155138]=7578--暗器	
	g_x892002_CC9[10155139]=7579--暗器		
	-----------------------武器
	local itemId=LuaFnGetItemTableIndexByIndex( sceneId, selfId,100)
	if g_x892002_CC[itemId] ~=nil then
		LuaFnSendSpecificImpactToUnit(sceneId, selfId, selfId, selfId,g_x892002_CC[itemId], 0)
	else
		for i=9000,9210 do
			LuaFnCancelSpecificImpact(sceneId,selfId,i)
		end
	end
	-----------------------武魂	
	local itemId=LuaFnGetItemTableIndexByIndex( sceneId, selfId,110)
	if g_x892002_CC7[itemId] ~=nil then
		LuaFnSendSpecificImpactToUnit(sceneId, selfId, selfId, selfId,g_x892002_CC7[itemId], 0)
	else
		for i=10386,10403 do
			LuaFnCancelSpecificImpact(sceneId,selfId,i)
		end
	end	
	-----------------------重楼盔		
	local itemId=LuaFnGetItemTableIndexByIndex( sceneId, selfId,101)
	if g_x892002_CC8[itemId] ~=nil then
		LuaFnSendSpecificImpactToUnit(sceneId, selfId, selfId, selfId,g_x892002_CC8[itemId], 0)
	else
		for i=7979,7980 do
			LuaFnCancelSpecificImpact(sceneId,selfId,i)
		end
	end	
	-----------------------暗器		
	local itemId=LuaFnGetItemTableIndexByIndex( sceneId, selfId,117)
	if g_x892002_CC9[itemId] ~=nil then
		LuaFnSendSpecificImpactToUnit(sceneId, selfId, selfId, selfId,g_x892002_CC9[itemId], 0)
	else
		for i=7539,7579 do
			LuaFnCancelSpecificImpact(sceneId,selfId,i)
		end
	end		
	-----------------------重楼链
	local itemId=LuaFnGetItemTableIndexByIndex( sceneId, selfId,107)
	if g_x892002_CC1[itemId] ~=nil then
		LuaFnSendSpecificImpactToUnit(sceneId, selfId, selfId, selfId,g_x892002_CC1[itemId], 0)
	else
		for i=7513,7515 do
			LuaFnCancelSpecificImpact(sceneId,selfId,i)
		end
	end
	-----------------------重楼戒
	local itemId=LuaFnGetItemTableIndexByIndex( sceneId, selfId,106)
	local itemId1=LuaFnGetItemTableIndexByIndex( sceneId, selfId,111)
	
	if g_x892002_CC2[itemId] ~=nil   then
		LuaFnSendSpecificImpactToUnit(sceneId, selfId, selfId, selfId,g_x892002_CC2[itemId], 0)
	elseif g_x892002_CC2[itemId1] ~=nil   then
		LuaFnSendSpecificImpactToUnit(sceneId, selfId, selfId, selfId,g_x892002_CC2[itemId1], 0)
	else
		for i=7509,7511 do
			LuaFnCancelSpecificImpact(sceneId,selfId,i)
		end
	end
	
	
	-----------------------重楼玉
	local itemId=LuaFnGetItemTableIndexByIndex( sceneId, selfId,112)
	local itemId1=LuaFnGetItemTableIndexByIndex( sceneId, selfId,113)
	
	if g_x892002_CC3[itemId] ~=nil then
		LuaFnSendSpecificImpactToUnit(sceneId, selfId, selfId, selfId,g_x892002_CC3[itemId], 0)
	elseif g_x892002_CC3[itemId1] ~=nil then
		LuaFnSendSpecificImpactToUnit(sceneId, selfId, selfId, selfId,g_x892002_CC3[itemId1], 0)
	else
		for i=7501,7503 do
			LuaFnCancelSpecificImpact(sceneId,selfId,i)
		end
	end
	-----------------------重楼带
	local itemId=LuaFnGetItemTableIndexByIndex( sceneId, selfId,105)
	if g_x892002_CC4[itemId] ~=nil then
		LuaFnSendSpecificImpactToUnit(sceneId, selfId, selfId, selfId,g_x892002_CC4[itemId], 0)
	else
		for i=7505,7507 do
			LuaFnCancelSpecificImpact(sceneId,selfId,i)
		end
	end
	-----------------------重楼肩
	local itemId=LuaFnGetItemTableIndexByIndex( sceneId, selfId,115)
	if g_x892002_CC5[itemId] ~=nil then
		LuaFnSendSpecificImpactToUnit(sceneId, selfId, selfId, selfId,g_x892002_CC5[itemId], 0)
	else
		for i=7517,7518 do
			LuaFnCancelSpecificImpact(sceneId,selfId,i)
		end
	end
	-----------------------重楼甲
	local itemId=LuaFnGetItemTableIndexByIndex( sceneId, selfId,116)
	if g_x892002_CC6[itemId] ~=nil then
		LuaFnSendSpecificImpactToUnit(sceneId, selfId, selfId, selfId,g_x892002_CC6[itemId], 0)
	else
		for i=7519,7520 do
			LuaFnCancelSpecificImpact(sceneId,selfId,i)
		end
	end
	
end


-- function x892002_AHa_ShiZhuangDianZhui(sceneId, selfId)  --点缀
	-- LuaFnSendSpecificImpactToUnit(sceneId, selfId, selfId, selfId,8500,0)
	-- local itemId=LuaFnGetItemTableIndexByIndex( sceneId, selfId, 116 )
	-- if itemId<=0 then
		-- x892002_AHa_ShiZhuangDianZhui_CancelAllBuff(sceneId, selfId)
		-- return
	-- end
	
	-- local equipMaxGemCount = GetBagGemCount( sceneId, selfId, 116 )
	-- x892002_AHa_ShiZhuangDianZhui_CancelAllBuff(sceneId, selfId)
	-- if equipMaxGemCount >3 then
		-- equipMaxGemCount =3
	-- end
	-- for i = 0, equipMaxGemCount - 1 do
		-- local gemEmbededIdx = GetGemEmbededType( sceneId, selfId, 116, i )
		-- x892002_AHa_ShiZhuangDianZhui_Buff(sceneId, selfId,gemEmbededIdx)
	-- end
-- end

-- function x892002_AHa_ShiZhuangDianZhui_Buff(sceneId, selfId, gemEmbededIdx) --点缀
	-- if gemEmbededIdx==0 then
		-- return
	-- end
	-- if gemEmbededIdx<50431001 and gemEmbededIdx>50433011 then
		-- return
	-- end
	-- local t_Id_1 = mod(gemEmbededIdx,50430000)
	
	-- local t_Id_2=floor(t_Id_1/1000)-1
	-- local t_Id_1=mod(t_Id_1,1000)
	-- local t_Buff_1=0
	-- local t_Buff_2=0
	-- if t_Id_2<0 then
		-- return
	-- end
	
	-- if t_Id_2==0  then
		-- t_Buff_1=959
		-- t_Buff_2=960
	-- elseif t_Id_2==1 then
		-- t_Buff_1=958
	-- elseif t_Id_2==2 then
		-- t_Buff_1=961
		-- t_Buff_2=962
	-- end
	
	-- if t_Id_2==0 and t_Id_1 ==11 then
		-- t_Buff_1=1125
		-- t_Buff_2=0
	-- elseif t_Id_2==1 and t_Id_1 ==11 then
		-- t_Buff_1=1124
	-- elseif t_Id_2==2 and t_Id_1 ==11 then
		-- t_Buff_1=0
		-- t_Buff_2=1128
	-- end
	
	-- --##控制不是所有点缀都是5个效果的
	-- if t_Id_1>=6 and t_Id_1<=8 and t_Id_2==0 then
		-- t_Buff_2=0
	-- elseif t_Id_1==8 and t_Id_2==2 then
		-- t_Buff_2=0
	-- end
	-- --##开始上效果
	-- if t_Buff_1~=0 then
		-- if t_Id_1 < 11 then
			-- t_Buff_1=t_Buff_1+(t_Id_1-1)*5
		-- end
		-- x892002_AHa_AddBuff(sceneId, selfId,t_Buff_1)
	-- end
	-- if t_Buff_2~=0 then
		-- if t_Id_1 < 11 then
			-- t_Buff_2=t_Buff_2+(t_Id_1-1)*5--116
		-- end
		-- x892002_AHa_AddBuff(sceneId, selfId,t_Buff_2)
		-- --x892002_Tips( sceneId, selfId, t_Buff_2 )
	-- end
-- end

-- function x892002_AHa_ShiZhuangDianZhui_CancelAllBuff(sceneId, selfId)  --点缀
	-- local dianZhui_Buff={958,959,960,961,962,963,964,965,966,967,968,969,970,971,972,973,974,975,976,977,978,979,980,981,982,983,984,985,986,987,988,989,990,991,992,993,994,995,996,997,998,999,1000,1001,1002,1003,1004,1005,1006,1007,1124,1125,1126,1127,1128}
	-- local xmenum = getn(dianZhui_Buff)
	-- for i=1,xmenum do
		-- if LuaFnHaveImpactOfSpecificDataIndex(sceneId, selfId, dianZhui_Buff[i]) == 1 then
			-- --测试真实点缀，暂时拼比这个，蝎子注
			-- LuaFnCancelSpecificImpact(sceneId,selfId,dianZhui_Buff[i])
		-- end
	-- end
-- end

-- function x892002_AHa_AddBuff(sceneId, selfId, buffId)	 --点缀
	-- if LuaFnHaveImpactOfSpecificDataIndex(sceneId, selfId, buffId) ~= 1 then
		-- LuaFnSendSpecificImpactToUnit( sceneId, selfId, selfId, selfId, buffId, 0 )
	-- end
-- end

function x892002_Get_WH_SXe(sceneId, selfId,pos) --武魂1
	local shuxingtab = {}
	local _,skilstring = LuaFnGetItemCreator(sceneId, selfId,pos)
	if skilstring == nil then
		return 0,0,0,0,0,0,0
	end
	
	if skilstring ==nil then skilstring =""  end
	
	local starpos1,endpos1,kz,sx,jn = nil,nil,0,nil,nil
	starpos1,endpos1,kz,sx,jn,sx1 = strfind(skilstring,"&WH%w(%w)("..strrep("%w",16)..")("..strrep("%w",6)..")(%w)")
	if starpos1 ==nil or endpos1 == nil then
		return 0,0,0,0,0,0,0
	end
	local r,d =0,0
	
	if sx ~= nil and strlen(sx)==16 then
		for i=1,16,2 do
			if strsub(sx,i,i+1) ~= "00" then
				tinsert(shuxingtab,strsub(sx,i,i+1))
				r =r+1
			end
		end
	end
	if jn~= nil and strlen(jn)==6 then
		for i=1,6,2 do
			if strsub(sx,i,i+1) ~= "00" then
				d =d+1
			end
		end
	end
	return 1,kz,r,d,sx,jn ,shuxingtab
end

function x892002_WHget_sx(sceneId, selfId) --武魂2/调用
	local qqh1,qqh2,qqh3,qqh4=0,0,0,0
	local str = {
	"q","w","e","r",  ----属性攻1
	"t","y","u","i",  ---属性抗5
	"o","p","a","s",  ---减抗9
	"d","f","g","h"}  ---减下限 13
	local suxing = { 0,0,0,0,  0,0,0,0,  0,0,0,0,  0,0,0,0}
	local itemId=LuaFnGetItemTableIndexByIndex( sceneId, selfId, 110 )
	if itemId>1 then
		local er,kz,r,d,sx,jn ,shuxingtab =x892002_Get_WH_SXe(sceneId, selfId,110)
		if er ==1 then
			if getn(shuxingtab)>0 then
				for i =1,getn(shuxingtab) do
					for j=1,getn(str) do
						if strfind(shuxingtab[i],str[j]) then
							local dengji = strsub(shuxingtab[i],2,2)  
							if j >12 then 
							  suxing[j]= tonumber(dengji)*4
							elseif j >4  then 
							  suxing[j]= tonumber(dengji)*10
							else
							  suxing[j]= tonumber(dengji)*30
							end
						end
					end
				end
			end
		end
	end
	
	return suxing
end

function x892002_GetMailEditData(sceneId, selfId)  --真元
	x892002_g_zhenyuandata = {MD_ZHENYUANMISS1,MD_ZHENYUANMISS2,MD_ZHENYUANMISS3,MD_ZHENYUANMISS4,MD_ZHENYUANMISS5,MD_ZHENYUANMISS6}
	local Editdatastring = ""
	local datasws = 0
	local strswd =""
	for i = 1,getn(x892002_g_zhenyuandata) do
		datasws = GetMissionData( sceneId, selfId, x892002_g_zhenyuandata[i])
		strswd =  format("%08d",datasws)
		if strswd == nil then
			strswd = strrep("0",8)
		end
		Editdatastring = Editdatastring..strswd
	end
	if Editdatastring == nil then
		Editdatastring = strrep("0",48)
	end
	local ZhenYuanBUFFF = {{0,0,0,"0","00","0"},{0,0,0,"0","00","0"},{0,0,0,"0","00","0"},{0,0,0,"0","00","0"},{0,0,0,"0","00","0"},{0,0,0,"0","00","0"},{0,0,0,"0","00","0"},{0,0,0,"0","00","0"},{0,0,0,"0","00","0"},{0,0,0,"0","00","0"},{0,0,0,"0","00","0"},{0,0,0,"0","00","0"}}
	local substringlisi = "0000"
	for i = 1,12 do
		substringlisi = strsub(Editdatastring,(i-1)*4+1,i*4)
		if substringlisi == nil then
			substringlisi = "0000"
		end
		local pisilisi = strsub(substringlisi,1,1)
		local leijinlisi = strsub(substringlisi,2,3)
		local Lvlisi = strsub(substringlisi,4,4)
		if pisilisi == nil then
			pisilisi = "0"
		end
		if leijinlisi == nil then
			leijinlisi = "00"
		end
		if Lvlisi == nil then
			Lvlisi = "0"
		end
		ZhenYuanBUFFF[i]={tonumber(pisilisi),tonumber(leijinlisi),tonumber(Lvlisi),pisilisi,leijinlisi,Lvlisi}
	end
	return ZhenYuanBUFFF
end

x892002_g_ZYtable = {
	25,26,27,289,290,291,96,97,98,292,293,435
} 

x892002_g_numToChar2 = {[1]="冰攻",[2]="火攻",[3]="玄攻",[4]="毒攻",[5]="力量",[16]="灵气",
[17]="体力",[18]="定力",[19]="身法"
}


function x892002_GetZhenYuan(sceneId, selfId) --真元
	x892002_g_zhenyuanpoint = {7,6,11,14,12,13,16,5,3,4,1,15}
	x892002_g_adddsuxingvalue = {}
	x892002_g_adddsuxingvalue[1] = {10,{2,4,6,8,10,12,14,16,18,"真元・勇力","力量"},{5,9,13,17,21,25,29,33,37,"真元・勇力","力量"},{9,16,23,30,37,44,51,58,65,"真元・勇力","力量"},{20,38,56,74,92,110,128,146,164,"真元・勇力","力量"},{24,46,67,89,111,132,154,176,197,"真元・勇力","力量"}}
	x892002_g_adddsuxingvalue[2] = {10,{2,4,6,8,10,12,14,16,18,"真元・灵慧","灵气"},{5,9,13,17,21,25,29,33,37,"真元・灵慧","灵气"},{9,16,23,30,37,44,51,58,65,"真元・灵慧","灵气"},{20,38,56,74,92,110,128,146,164,"真元・灵慧","灵气"},{24,46,67,89,111,132,154,176,197,"真元・灵慧","灵气"}}
	x892002_g_adddsuxingvalue[3] = {10,{2,4,6,8,10,12,14,16,18,"真元・厚体","体力"},{5,9,13,17,21,25,29,33,37,"真元・厚体","体力"},{9,16,23,30,37,44,51,58,65,"真元・厚体","体力"},{20,38,56,74,92,110,128,146,164,"真元・厚体","体力"},{24,46,67,89,111,132,154,176,197,"真元・厚体","体力"}}
	x892002_g_adddsuxingvalue[4] = {10,{2,4,6,8,10,12,14,16,18,"真元・气定","定力"},{5,9,13,17,21,25,29,33,37,"真元・气定","定力"},{9,16,23,30,37,44,51,58,65,"真元・气定","定力"},{20,38,56,74,92,110,128,146,164,"真元・气定","定力"},{24,46,67,89,111,132,154,176,197,"真元・气定","定力"}}
	x892002_g_adddsuxingvalue[5] = {10,{2,4,6,8,10,12,14,16,18,"真元・迅捷","身法"},{5,9,13,17,21,25,29,33,37,"真元・迅捷","身法"},{9,16,23,30,37,44,51,58,65,"真元・迅捷","身法"},{20,38,56,74,92,110,128,146,164,"真元・迅捷","身法"},{24,46,67,89,111,132,154,176,197,"真元・迅捷","身法"}}
	x892002_g_adddsuxingvalue[6] = {1000,{1000,2000,3000,4000,5000,6000,7000,8000,9000,"真元・血涌丹田","血上限"},{2000,4000,6000,8000,10000,12000,14000,16000,18000,"真元・血涌丹田","血上限"},{3000,6000,9000,12000,15000,18000,21000,24000,27000,"真元・血涌丹田","血上限"},{4000,8000,12000,16000,20000,24000,28000,32000,36000,"真元・血涌丹田","血上限"},{5000,10000,15000,20000,25000,30000,35000,40000,45000,"真元・血涌丹田","血上限"}}
	x892002_g_adddsuxingvalue[7] = {1000,{1000,2000,3000,4000,5000,6000,7000,8000,9000,"真元・气贯神庭","气上限"},{2000,4000,6000,8000,10000,12000,14000,16000,18000,"真元・气贯神庭","气上限"},{3000,6000,9000,12000,15000,18000,21000,24000,27000,"真元・气贯神庭","气上限"},{4000,8000,12000,16000,20000,24000,28000,32000,36000,"真元・气贯神庭","气上限"},{5000,10000,15000,20000,25000,30000,35000,40000,45000,"真元・气贯神庭","气上限"}}
	x892002_g_adddsuxingvalue[8] = {200,{200,400,600,800,1000,1200,1400,1600,1800,"真元・内劲绵绵","内功攻击"},{400,800,1200,1600,2000,2400,2800,3200,3600,"真元・内劲绵绵","内功攻击"},{600,1200,1800,2400,3000,3600,4200,4800,5400,"真元・内劲绵绵","内功攻击"},{800,1600,2400,3200,4000,4800,5600,6400,7200,"真元・内劲绵绵","内功攻击"},{1000,2000,3000,4000,5000,6000,7000,8000,9000,"真元・内劲绵绵","内功攻击"}}
	x892002_g_adddsuxingvalue[9] = {200,{200,400,600,800,1000,1200,1400,1600,1800,"真元・外功罡猛","外功攻击"},{400,800,1200,1600,2000,2400,2800,3200,3600,"真元・外功罡猛","外功攻击"},{600,1200,1800,2400,3000,3600,4200,4800,5400,"真元・外功罡猛","外功攻击"},{800,1600,2400,3200,4000,4800,5600,6400,7200,"真元・外功罡猛","外功攻击"},{1000,2000,3000,4000,5000,6000,7000,8000,9000,"真元・外功罡猛","外功攻击"}}
	x892002_g_adddsuxingvalue[10] = {100,{100,200,300,400,500,600,700,800,900,"真元・千转柔筋","内功防御"},{200,400,600,800,1000,1200,1400,1600,1800,"真元・千转柔筋","内功防御"},{300,600,900,1200,1500,1800,2100,2400,2700,"真元・千转柔筋","内功防御"},{400,800,1200,1600,2000,2400,2800,3200,3600,"真元・千转柔筋","内功防御"},{500,1000,1500,2000,2500,3000,3500,4000,4500,"真元・千转柔筋","内功防御"}}
	x892002_g_adddsuxingvalue[11] = {100,{100,200,300,400,500,600,700,800,900,"真元・百炼铁骨","外功防御"},{200,400,600,800,1000,1200,1400,1600,1800,"真元・百炼铁骨","外功防御"},{300,600,900,1200,1500,1800,2100,2400,2700,"真元・百炼铁骨","外功防御"},{400,800,1200,1600,2000,2400,2800,3200,3600,"真元・百炼铁骨","外功防御"},{500,1000,1500,2000,2500,3000,3500,4000,4500,"真元・百炼铁骨","外功防御"}}
	x892002_g_adddsuxingvalue[12] = {100,{100,200,300,400,500,600,700,800,900,"真元・百步穿杨","命中"},{200,400,600,800,1000,1200,1400,1600,1800,"真元・百步穿杨","命中"},{300,600,900,1200,1500,1800,2100,2400,2700,"真元・百步穿杨","命中"},{400,800,1200,1600,2000,2400,2800,3200,3600,"真元・百步穿杨","命中"},{500,1000,1500,2000,2500,3000,3500,4000,4500,"真元・百步穿杨","命中"}}
	x892002_g_adddsuxingvalue[13] = {80,{80,160,240,320,400,480,560,640,720,"真元・滑不沾衣","闪避"},{160,320,480,640,800,960,1120,1280,1440,"真元・滑不沾衣","闪避"},{240,480,720,960,1200,1440,1680,1920,2160,"真元・滑不沾衣","闪避"},{320,640,960,1280,1600,1920,2240,2560,2880,"真元・滑不沾衣","闪避"},{400,800,1200,1600,2000,2400,2800,3200,3600,"真元・滑不沾衣","闪避"}}
	x892002_g_adddsuxingvalue[14] = {3,{3,6,9,12,15,18,21,24,27,"真元・暴猛如焰","会心攻击"},{6,12,18,24,30,36,42,48,54,"真元・暴猛如焰","会心攻击"},{9,18,27,36,45,54,63,72,81,"真元・暴猛如焰","会心攻击"},{12,24,36,48,60,72,84,96,108,"真元・暴猛如焰","会心攻击"},{15,30,45,60,75,90,105,120,135,"真元・暴猛如焰","会心攻击"}}
	x892002_g_adddsuxingvalue[15] = {2,{2,4,6,8,10,12,14,16,18,"真元・坚韧如岳","会心防御"},{4,8,12,16,20,24,28,32,36,"真元・坚韧如岳","会心防御"},{6,12,18,24,30,36,42,48,54,"真元・坚韧如岳","会心防御"},{8,16,24,32,40,48,56,64,72,"真元・坚韧如岳","会心防御"},{10,20,30,40,50,60,70,80,90,"真元・坚韧如岳","会心防御"}}
	x892002_g_adddsuxingvalue[16] = {15,{2,4,6,8,10,12,14,16,18,"真元・沉冰","冰攻击"},{5,9,13,17,21,25,29,33,37,"真元・沉冰","冰攻击"},{9,16,23,30,37,44,51,58,65,"真元・沉冰","冰攻击"},{20,38,56,74,92,110,128,146,164,"真元・沉冰","冰攻击"},{24,46,67,89,111,132,154,176,197,"真元・沉冰","冰攻击"}}
	x892002_g_adddsuxingvalue[17] = {15,{2,4,6,8,10,12,14,16,18,"真元・炽火","火攻击"},{5,9,13,17,21,25,29,33,37,"真元・炽火","火攻击"},{9,16,23,30,37,44,51,58,65,"真元・炽火","火攻击"},{20,38,56,74,92,110,128,146,164,"真元・炽火","火攻击"},{24,46,67,89,111,132,154,176,197,"真元・炽火","火攻击"}}
	x892002_g_adddsuxingvalue[18] = {15,{2,4,6,8,10,12,14,16,18,"真元・印玄","玄攻击"},{5,9,13,17,21,25,29,33,37,"真元・印玄","玄攻击"},{9,16,23,30,37,44,51,58,65,"真元・印玄","玄攻击"},{20,38,56,74,92,110,128,146,164,"真元・印玄","玄攻击"},{24,46,67,89,111,132,154,176,197,"真元・印玄","玄攻击"}}
	x892002_g_adddsuxingvalue[19] = {15,{2,4,6,8,10,12,14,16,18,"真元・蛊毒","毒攻击"},{5,9,13,17,21,25,29,33,37,"真元・蛊毒","毒攻击"},{9,16,23,30,37,44,51,58,65,"真元・蛊毒","毒攻击"},{20,38,56,74,92,110,128,146,164,"真元・蛊毒","毒攻击"},{24,46,67,89,111,132,154,176,197,"真元・蛊毒","毒攻击"}}
	
	local upDWsuxing,upDWleve,upnum
	local myssidiaowensusu = {}
	for i =1,18 do
		myssidiaowensusu[i] = 0
	end
	local datalist = x892002_GetMailEditData(sceneId, selfId)
	local pointsoiok = {}
	pointsoiok[1] = 0 --力量
	pointsoiok[2] = 0 --灵气
	pointsoiok[3] = 0 --体力
	pointsoiok[4] = 0 --定力
	pointsoiok[5] = 0 --身法
	pointsoiok[6] = 0 --血上限
	pointsoiok[7] = 0 --气上限
	pointsoiok[8] = 0 --内功攻击
	pointsoiok[9] = 0 --外功攻击
	pointsoiok[10] = 0 --内功防御
	pointsoiok[11] = 0 --外功防御
	pointsoiok[12] = 0 --命中
	pointsoiok[13] = 0 --内避
	pointsoiok[14] = 0 --会心攻击
	pointsoiok[15] = 0 --会心防御
	pointsoiok[16] = 0 --冰攻击
	pointsoiok[17] = 0 --火攻击
	pointsoiok[18] = 0 --玄攻击
	pointsoiok[19] = 0 --毒攻击
	for i = 1,12 do
		local nItemId = GetItemTableIndexByIndex(sceneId, selfId, 100+x892002_g_zhenyuanpoint[i])
		if nItemId > 1 and datalist[i][2] > 0 and pointsoiok[datalist[i][2]] ~= nil then
			if datalist[i][3]  > 0 and x892002_g_numToChar2[datalist[i][2]] == nil then
				pointsoiok[datalist[i][2]] = pointsoiok[datalist[i][2]] + floor(x892002_g_adddsuxingvalue[datalist[i][2]][datalist[i][1]+1][datalist[i][3]]/x892002_g_adddsuxingvalue[datalist[i][2]][1])
				if pointsoiok[datalist[i][2]] == nil then
					pointsoiok[datalist[i][2]] = 0
				end
			end
		end
	end
	 
	return pointsoiok
end

function x892002_SetZhenYuan(sceneId, selfId,pr1,pr2,pr3,pr4,pr5,pos)
	--x892002_ShowNotice(sceneId,selfId,"pr1 = "..pr1.." pr2 = "..pr2.." pr3 = "..pr3.." pr4 = "..pr4.." pr5 = "..pr5.." pos = "..pos)
	--SetMissionData( sceneId, selfId, x892002_g_ZYtable[pos],0 )
	local equip_info = {}

	equip_info[1] = floor(pr1/100000)
	equip_info[2] = mod(pr1,100000)
	equip_info[3] = floor(pr2/100000)
	equip_info[4] = mod(pr2,100000)
	equip_info[5] = floor(pr3/100000)
	equip_info[6] = mod(pr3,100000)
	equip_info[7] = floor(pr4/100000)
	equip_info[8] = mod(pr4,100000)
	equip_info[9] = floor(pr5/100000)
	equip_info[10] = mod(pr5,100000)

	x892002_g_numToChar3 = {[1]="力量",[2]="灵气",[3]="体力",[4]="定力",[5]="身法",[16]="冰攻",
		[17]="火攻",[18]="玄攻",[19]="毒攻",[100] = "全属性"
	}
	x892002_g_numTonum = {[1]=1,[2]=2,[3]=3,[4]=4,[5]=5,[16]=6,[17]=7,[18]=8,[19]=9}
	x892002_g_charToNum = {["冰攻"] = 1,["火攻"] = 2,["玄攻"]=3,["毒攻"]=4,["力量"]=13,["灵气"]=14,
		["体力"]=15,["定力"]=16,["身法"]=17}
	x892002_g_adddsuxingvalue = {}
	x892002_g_adddsuxingvalue[1] = {{2,4,6,8,10,12,14,16,18,"真元・勇力","力量"},{5,9,13,17,21,25,29,33,37,"真元・勇力","力量"},{9,16,23,30,37,44,51,58,65,"真元・勇力","力量"},{20,38,56,74,92,110,128,146,164,"真元・勇力","力量"},{24,46,67,89,111,132,154,176,197,"真元・勇力","力量"}}
	x892002_g_adddsuxingvalue[2] = {{2,4,6,8,10,12,14,16,18,"真元・灵慧","灵气"},{5,9,13,17,21,25,29,33,37,"真元・灵慧","灵气"},{9,16,23,30,37,44,51,58,65,"真元・灵慧","灵气"},{20,38,56,74,92,110,128,146,164,"真元・灵慧","灵气"},{24,46,67,89,111,132,154,176,197,"真元・灵慧","灵气"}}
	x892002_g_adddsuxingvalue[3] = {{2,4,6,8,10,12,14,16,18,"真元・厚体","体力"},{5,9,13,17,21,25,29,33,37,"真元・厚体","体力"},{9,16,23,30,37,44,51,58,65,"真元・厚体","体力"},{20,38,56,74,92,110,128,146,164,"真元・厚体","体力"},{24,46,67,89,111,132,154,176,197,"真元・厚体","体力"}}
	x892002_g_adddsuxingvalue[4] = {{2,4,6,8,10,12,14,16,18,"真元・气定","定力"},{5,9,13,17,21,25,29,33,37,"真元・气定","定力"},{9,16,23,30,37,44,51,58,65,"真元・气定","定力"},{20,38,56,74,92,110,128,146,164,"真元・气定","定力"},{24,46,67,89,111,132,154,176,197,"真元・气定","定力"}}
	x892002_g_adddsuxingvalue[5] = {{2,4,6,8,10,12,14,16,18,"真元・迅捷","身法"},{5,9,13,17,21,25,29,33,37,"真元・迅捷","身法"},{9,16,23,30,37,44,51,58,65,"真元・迅捷","身法"},{20,38,56,74,92,110,128,146,164,"真元・迅捷","身法"},{24,46,67,89,111,132,154,176,197,"真元・迅捷","身法"}}
	x892002_g_adddsuxingvalue[6] = {{1000,2000,3000,4000,5000,6000,7000,8000,9000,"真元・血涌丹田","血上限"},{2000,4000,6000,8000,10000,12000,14000,16000,18000,"真元・血涌丹田","血上限"},{3000,6000,9000,12000,15000,18000,21000,24000,27000,"真元・血涌丹田","血上限"},{4000,8000,12000,16000,20000,24000,28000,32000,36000,"真元・血涌丹田","血上限"},{5000,10000,15000,20000,25000,30000,35000,40000,45000,"真元・血涌丹田","血上限"}}
	x892002_g_adddsuxingvalue[7] = {{1000,2000,3000,4000,5000,6000,7000,8000,9000,"真元・气贯神庭","气上限"},{2000,4000,6000,8000,10000,12000,14000,16000,18000,"真元・气贯神庭","气上限"},{3000,6000,9000,12000,15000,18000,21000,24000,27000,"真元・气贯神庭","气上限"},{4000,8000,12000,16000,20000,24000,28000,32000,36000,"真元・气贯神庭","气上限"},{5000,10000,15000,20000,25000,30000,35000,40000,45000,"真元・气贯神庭","气上限"}}
	x892002_g_adddsuxingvalue[8] = {{200,400,600,800,1000,1200,1400,1600,1800,"真元・内劲绵绵","内功攻击"},{400,800,1200,1600,2000,2400,2800,3200,3600,"真元・内劲绵绵","内功攻击"},{600,1200,1800,2400,3000,3600,4200,4800,5400,"真元・内劲绵绵","内功攻击"},{800,1600,2400,3200,4000,4800,5600,6400,7200,"真元・内劲绵绵","内功攻击"},{1000,2000,3000,4000,5000,6000,7000,8000,9000,"真元・内劲绵绵","内功攻击"}}
	x892002_g_adddsuxingvalue[9] = {{200,400,600,800,1000,1200,1400,1600,1800,"真元・外功罡猛","外功攻击"},{400,800,1200,1600,2000,2400,2800,3200,3600,"真元・外功罡猛","外功攻击"},{600,1200,1800,2400,3000,3600,4200,4800,5400,"真元・外功罡猛","外功攻击"},{800,1600,2400,3200,4000,4800,5600,6400,7200,"真元・外功罡猛","外功攻击"},{1000,2000,3000,4000,5000,6000,7000,8000,9000,"真元・外功罡猛","外功攻击"}}
	x892002_g_adddsuxingvalue[10] = {{100,200,300,400,500,600,700,800,900,"真元・千转柔筋","内功防御"},{200,400,600,800,1000,1200,1400,1600,1800,"真元・千转柔筋","内功防御"},{300,600,900,1200,1500,1800,2100,2400,2700,"真元・千转柔筋","内功防御"},{400,800,1200,1600,2000,2400,2800,3200,3600,"真元・千转柔筋","内功防御"},{500,1000,1500,2000,2500,3000,3500,4000,4500,"真元・千转柔筋","内功防御"}}
	x892002_g_adddsuxingvalue[11] = {{100,200,300,400,500,600,700,800,900,"真元・百炼铁骨","外功防御"},{200,400,600,800,1000,1200,1400,1600,1800,"真元・百炼铁骨","外功防御"},{300,600,900,1200,1500,1800,2100,2400,2700,"真元・百炼铁骨","外功防御"},{400,800,1200,1600,2000,2400,2800,3200,3600,"真元・百炼铁骨","外功防御"},{500,1000,1500,2000,2500,3000,3500,4000,4500,"真元・百炼铁骨","外功防御"}}
	x892002_g_adddsuxingvalue[12] = {{100,200,300,400,500,600,700,800,900,"真元・百步穿杨","命中"},{200,400,600,800,1000,1200,1400,1600,1800,"真元・百步穿杨","命中"},{300,600,900,1200,1500,1800,2100,2400,2700,"真元・百步穿杨","命中"},{400,800,1200,1600,2000,2400,2800,3200,3600,"真元・百步穿杨","命中"},{500,1000,1500,2000,2500,3000,3500,4000,4500,"真元・百步穿杨","命中"}}
	x892002_g_adddsuxingvalue[13] = {{80,160,240,320,400,480,560,640,720,"真元・滑不沾衣","闪避"},{160,320,480,640,800,960,1120,1280,1440,"真元・滑不沾衣","闪避"},{240,480,720,960,1200,1440,1680,1920,2160,"真元・滑不沾衣","闪避"},{320,640,960,1280,1600,1920,2240,2560,2880,"真元・滑不沾衣","闪避"},{400,800,1200,1600,2000,2400,2800,3200,3600,"真元・滑不沾衣","闪避"}}
	x892002_g_adddsuxingvalue[14] = {{3,6,9,12,15,18,21,24,27,"真元・暴猛如焰","会心攻击"},{6,12,18,24,30,36,42,48,54,"真元・暴猛如焰","会心攻击"},{9,18,27,36,45,54,63,72,81,"真元・暴猛如焰","会心攻击"},{12,24,36,48,60,72,84,96,108,"真元・暴猛如焰","会心攻击"},{15,30,45,60,75,90,105,120,135,"真元・暴猛如焰","会心攻击"}}
	x892002_g_adddsuxingvalue[15] = {{2,4,6,8,10,12,14,16,18,"真元・坚韧如岳","会心防御"},{4,8,12,16,20,24,28,32,36,"真元・坚韧如岳","会心防御"},{6,12,18,24,30,36,42,48,54,"真元・坚韧如岳","会心防御"},{8,16,24,32,40,48,56,64,72,"真元・坚韧如岳","会心防御"},{10,20,30,40,50,60,70,80,90,"真元・坚韧如岳","会心防御"}}
	x892002_g_adddsuxingvalue[16] = {{2,4,6,8,10,12,14,16,18,"真元・沉冰","冰攻击"},{5,9,13,17,21,25,29,33,37,"真元・沉冰","冰攻击"},{9,16,23,30,37,44,51,58,65,"真元・沉冰","冰攻击"},{20,38,56,74,92,110,128,146,164,"真元・沉冰","冰攻击"},{24,46,67,89,111,132,154,176,197,"真元・沉冰","冰攻击"}}
	x892002_g_adddsuxingvalue[17] = {{2,4,6,8,10,12,14,16,18,"真元・炽火","火攻击"},{5,9,13,17,21,25,29,33,37,"真元・炽火","火攻击"},{9,16,23,30,37,44,51,58,65,"真元・炽火","火攻击"},{20,38,56,74,92,110,128,146,164,"真元・炽火","火攻击"},{24,46,67,89,111,132,154,176,197,"真元・炽火","火攻击"}}
	x892002_g_adddsuxingvalue[18] = {{2,4,6,8,10,12,14,16,18,"真元・印玄","玄攻击"},{5,9,13,17,21,25,29,33,37,"真元・印玄","玄攻击"},{9,16,23,30,37,44,51,58,65,"真元・印玄","玄攻击"},{20,38,56,74,92,110,128,146,164,"真元・印玄","玄攻击"},{24,46,67,89,111,132,154,176,197,"真元・印玄","玄攻击"}}
	x892002_g_adddsuxingvalue[19] = {{2,4,6,8,10,12,14,16,18,"真元・蛊毒","毒攻击"},{5,9,13,17,21,25,29,33,37,"真元・蛊毒","毒攻击"},{9,16,23,30,37,44,51,58,65,"真元・蛊毒","毒攻击"},{20,38,56,74,92,110,128,146,164,"真元・蛊毒","毒攻击"},{24,46,67,89,111,132,154,176,197,"真元・蛊毒","毒攻击"}}

	-- local str = ""
	if equip_info[10] > 0 then
		for i=1,5 do
			equip_info[i] = equip_info[i] + equip_info[10]
		end
	end
	-- x892002_ShowNotice(sceneId,selfId,"物品"..pos.."为属性为"..str)

	local datalist = x892002_GetMailEditData(sceneId, selfId)
	local value_curr = GetMissionData(sceneId,selfId,x892002_g_ZYtable[pos])
	if value_curr < 0 then
		value_curr = 0
	end
	--先清空先前的属性
	local valueOf = mod(value_curr,100000000)
	local typeOf = floor(value_curr/100000000)
	local humanAttr = 0
	x892002_ShowNotice(sceneId,selfId,"value = "..value_curr)
	if x892002_g_numToChar[typeOf] ~= nil then
		humanAttr = x892002_GetAbility(sceneId,selfId,x892002_g_numToChar[typeOf])
		humanAttr = humanAttr - valueOf
		x892002_SetAbility(sceneId,selfId,x892002_g_numToChar[typeOf],humanAttr)
		SetMissionData( sceneId, selfId, x892002_g_ZYtable[pos],0 )
	end

	if datalist[pos][1] > 0 and datalist[pos][2] > 0 and datalist[pos][3] > 0 then
		if x892002_g_numToChar3[datalist[pos][2]] ~= nil then
			local zhenyuan = datalist[pos][2]
			local value = x892002_g_adddsuxingvalue[zhenyuan][datalist[pos][1]][datalist[pos][3]]
			value = floor(value * equip_info[x892002_g_numTonum[datalist[pos][2]]]/100 + 0.5)
			--先清空先前的属性

			--加上当前属性
			humanAttr = humanAttr + value
			--设置属性(后八位为属性值，前两位为属性类型)
			value = value + x892002_g_charToNum[x892002_g_numToChar3[zhenyuan]] * 100000000
			SetMissionData( sceneId, selfId, x892002_g_ZYtable[pos],value )
			--设置人物属性
			x892002_SetAbility(sceneId,selfId,x892002_g_numToChar[typeOf],humanAttr)
		end
	end
	--x892002_ShowNotice(sceneId,selfId,"真元品质"..datalist[pos][1].." 类型是"..datalist[pos][2].." 等级为"..datalist[pos][3])

	return
end


function x892002_InfantBUFF(sceneId, selfId)
	local InfantBUFF = {}
	for i = 1,19 do
		InfantBUFF[i] = 0  --参考真元
	end
	
	
	--总属性 = 基础属性+书的属性+星星的属性 + 对应英雄类型时 基础属性加成 35%
	
	local SXCLHR = GetMissionData( sceneId, selfId, MD_INFANTSXCLHR)--孩子性别 - 等级-英雄  共5位
	if SXCLHR == nil then
		SXCLHR =0
	end
	local InfantH = mod(SXCLHR,10)--子女的英雄类型
	local InfanLV = floor(mod(SXCLHR,10000)/10) --子女的等级
	
	local ALLBOOKDT1 =format("%09d", GetMissionData( sceneId, selfId, MD_INFANTBOOK1)) --13的数据
	if ALLBOOKDT1 == nil then
		ALLBOOKDT1="000000000"
	end
	local ALLBOOKDT2 =format("%09d",GetMissionData( sceneId, selfId, MD_INFANTBOOK2)) --46 的数据
	if ALLBOOKDT2 == nil then
		ALLBOOKDT2="000000000"
	end
	
	local ALLBOOKDT = ALLBOOKDT1..ALLBOOKDT2  --所有书的数据 STRING
	local ALLDATATY = format("%06d",GetMissionData( sceneId, selfId, MD_INFANTBOOKTP) )--全部的装备书的英雄类型
	
	
	local JCSX = 0 --基础属性
	local BKSX = 0---书的属性
	local STSX = 0--星星的属性
	local ALLSX = {}
	
	local GJSX = -1
	if InfantH == 1 then
		GJSX = 16
	elseif InfantH == 2 then
		GJSX = 17
	elseif InfantH == 3 then
		GJSX = 18
	elseif InfantH == 4 then
		GJSX = 19
	end
	local BOOKCL =0
	local DATATY =0
	
	local IFTBUFFTb = {GJSX,3,12,14,5,13}
	local ALLBUFF = 0
	for i = 1,6 do
		JCSX = 0
		if x892002_Infant_Heroffect[InfanLV] ~= nil and x892002_Infant_Heroffect[InfanLV][i] ~= nil then
			JCSX = floor(x892002_Infant_Heroffect[InfanLV][i] * x892002_Heroffect_ratio) --基础属性
		end
		BOOKCL =0
		DATATY =0
		BOOKCL = tonumber(strsub(ALLBOOKDT,i+(2*(i-1))+1,i+(2*(i-1))+1 ))--书的颜色
		DATATY = tonumber(strsub(ALLDATATY,i,i))--已经装备的书的英雄类型
		BKSX = 0
		if x892002_Infant_Bookffect[BOOKCL] ~= nil and x892002_Infant_Bookffect[BOOKCL][i] ~= nil then
			BKSX = x892002_Infant_Bookffect[BOOKCL][i]--书的属性
			if BOOKCL == 4 then
				BKSX = floor(x892002_Infant_Bookffect[BOOKCL][i] * x892002_Bookffect_ratio) --书的属性
			end
		end
		STSX =0
		local BOOKST = tonumber(strsub(ALLBOOKDT,i+(2*(i-1))+2,i+(2*(i-1))+2 ))--书的星星
		if BOOKCL > 0 and DATATY > 0 then
			if x892002_Infant_BookStarffect[BOOKST] ~= nil and x892002_Infant_BookStarffect[BOOKST][i] ~= nil then
				STSX =floor( x892002_Infant_BookStarffect[BOOKST][i] * x892002_Bookffect_ratio) --星星的属性
			end
		end
		if InfantH == DATATY then
			JCSX = floor(JCSX * 1.35) --英雄类型对应时，基础属性就加35%
		end
		ALLBUFF = 0
		ALLBUFF = JCSX + BKSX + STSX
		if ALLBUFF > 0 then
			if InfantBUFF[IFTBUFFTb[i]] ~= nil then
				InfantBUFF[IFTBUFFTb[i]] = ALLBUFF
			else
				InfantBUFF[IFTBUFFTb[i]] = 0
			end
		end
	end
	
	InfantBUFF[1] = floor(InfantBUFF[1]/10)
	InfantBUFF[2] = floor(InfantBUFF[2]/10)
	InfantBUFF[3] = floor(InfantBUFF[3]/10)
	InfantBUFF[4] = floor(InfantBUFF[4]/10)
	InfantBUFF[5] = floor(InfantBUFF[5]/10)
	InfantBUFF[6] = floor(InfantBUFF[6]/1000)
	InfantBUFF[7] = 0
	InfantBUFF[8] = floor(InfantBUFF[8]/200)
	InfantBUFF[9] = floor(InfantBUFF[9]/200)
	InfantBUFF[10] = floor(InfantBUFF[10]/100)
	InfantBUFF[11] = floor(InfantBUFF[11]/100)
	InfantBUFF[12] = floor(InfantBUFF[12]/100)
	InfantBUFF[13] = floor(InfantBUFF[13]/80)
	InfantBUFF[14] = floor(InfantBUFF[14]/3)
	InfantBUFF[15] = floor(InfantBUFF[15]/2)
	InfantBUFF[16] = floor(InfantBUFF[16]/15)
	InfantBUFF[17] = floor(InfantBUFF[17]/15)
	InfantBUFF[18] = floor(InfantBUFF[18]/15)
	InfantBUFF[19] = floor(InfantBUFF[19]/15)
	
	return InfantBUFF
end


function x892002_InfantBUFF2(sceneId, selfId)
	local InfantBUFF2 = {}
	for i = 1,8 do
		InfantBUFF2[i] = 0 --四抗、四减抗
	end
	local SKILLDT = GetMissionData( sceneId, selfId, MD_INFANTSKILLDT)
	if SKILLDT ~= nil and SKILLDT >= 1 and (floor(SKILLDT/10000000)) >= 1 then
		--return
		--end
		
		-- x391060_ZH_ratio = 2 --(综合效果的比率，1 代表200%，)
		-- x391060_Infant_SKEffect = { 10 , 12 , 15 , 19 , 24 , 30 , 37 , 45 , 55 } -- 基本属性
		--x892002_Tips( sceneId, selfId, "计算子女技能了")
		--MD_INFANTSKILLDT  8 位数 ，技能类型1-8，1-4 冰-毒抗，后一位是技能等级1-9，5-8 冰-毒 减抗。
		
		local ZH_ratio = 1
		local ZH_ratio1 = 0
		
		local ZH_Value1 = 0
		local ZH_Value2 = 0
		local ZH_Value3 = 0
		local ZH_Value4 = 0
		local ZH_Value5 = 0
		local ZH_data = GetMissionData( sceneId, selfId, MD_INFANTZHDATE1)
		if ZH_data ~= nil and ZH_data > 0 then
			ZH_data = format("%06d",ZH_data)
			ZH_Value1=tonumber(strsub(ZH_data,1,2))
			ZH_Value2=tonumber(strsub(ZH_data,3,4))
			ZH_Value3=tonumber(strsub(ZH_data,5,6))
		end
		local ZH_data2 = GetMissionData( sceneId, selfId, MD_INFANTZHDATE2)
		if ZH_data2 ~= nil and ZH_data2 > 0 then
			ZH_data2 = format("%04d",ZH_data2)
			ZH_Value4=tonumber(strsub(ZH_data2,1,2))
			ZH_Value5=tonumber(strsub(ZH_data2,3,4))
		end
		ZH_ratio1 =floor((ZH_Value1+ZH_Value2+ZH_Value3+ZH_Value4+ZH_Value5)/445)
		if ZH_ratio1 > 1 then
			ZH_ratio1=1
		end
		ZH_ratio = ZH_ratio + ZH_ratio1
		--100+math.floor( 100 * mainAttribute/ZH_MAX)) * ZH_ratio
		
		
		local SKILL1_ID = floor(SKILLDT/10000000)
		local SKILL1_LV = floor(mod(SKILLDT,10000000)/1000000)
		InfantBUFF2[SKILL1_ID] = InfantBUFF2[SKILL1_ID] + floor(floor(x892002_Infant_SKEffect[SKILL1_LV] * x892002_ZH_ratio * ZH_ratio)/1)
		
		local SKILL2_ID = floor(mod(SKILLDT,1000000)/100000)
		local SKILL2_LV = floor(mod(SKILLDT,100000)/10000)
		InfantBUFF2[SKILL2_ID] = InfantBUFF2[SKILL2_ID] + floor(floor(x892002_Infant_SKEffect[SKILL2_LV] * x892002_ZH_ratio * ZH_ratio)/1)
		
		local SKILL3_ID = floor(mod(SKILLDT,10000)/1000)
		local SKILL3_LV = floor(mod(SKILLDT,1000)/100)
		InfantBUFF2[SKILL3_ID] = InfantBUFF2[SKILL3_ID] + floor(floor(x892002_Infant_SKEffect[SKILL3_LV] * x892002_ZH_ratio * ZH_ratio)/1)
		
		local SKILL4_ID = floor(mod(SKILLDT,100)/10)
		local SKILL4_LV = mod(SKILLDT,10)
		InfantBUFF2[SKILL4_ID] = InfantBUFF2[SKILL4_ID] + floor(floor(x892002_Infant_SKEffect[SKILL4_LV] * x892002_ZH_ratio * ZH_ratio)/1)
	end
	
	InfantBUFF2[1] = floor(InfantBUFF2[1]/4)
	InfantBUFF2[2] = floor(InfantBUFF2[2]/4)
	InfantBUFF2[3] = floor(InfantBUFF2[3]/4)
	InfantBUFF2[4] = floor(InfantBUFF2[4]/4)
	InfantBUFF2[5] = floor(InfantBUFF2[5]/4)
	InfantBUFF2[6] = floor(InfantBUFF2[6]/4)
	InfantBUFF2[7] = floor(InfantBUFF2[7]/4)
	InfantBUFF2[8] = floor(InfantBUFF2[8]/4)
	
	return InfantBUFF2
end


function x892002_KfsVisual(sceneId,selfId)
   local itemId=LuaFnGetItemTableIndexByIndex( sceneId, selfId, 110 )
   local Kfs_AttrType = 0
   if itemId >= 10156100 and itemId <= 10156108 then--御瑶盘
      Kfs_AttrType = 1 
   end
   if itemId >= 10156200 and itemId <= 10156208 then--cFF0000琉璃焰
      Kfs_AttrType = 2
   end
   if  Kfs_AttrType == 0 then
      LuaFnXYZSetEquipVisual(sceneId,selfId,103,2000)
   LuaFnXYZUpdateHumanEquipDataToTarget(sceneId,selfId,selfId) 	  
	  SetMissionData(sceneId,selfId,MD_KFSVisual,0)
      return
   end
   local _,skilstring = LuaFnGetItemCreator(sceneId, selfId,110)
   if skilstring == nil then
      return
   end
   local _,_,KfsLevel =strfind(skilstring,"&WH"..strrep("%w",24).."(%w)")--103
   if KfsLevel == nil then
      return
   end
   local nKfsVisualID = 0
   if KfsLevel == "0" then
   nKfsVisualID = x892002_g_KFSVisual[Kfs_AttrType][1]
   else
   nKfsVisualID = x892002_g_KFSVisual[Kfs_AttrType][tonumber(KfsLevel)+1]--有武魂穿戴无信息，给武魂外观 
   end
   LuaFnXYZSetEquipVisual(sceneId,selfId,103,nKfsVisualID)
   LuaFnXYZUpdateHumanEquipDataToTarget(sceneId,selfId,selfId)    
  
end

-- function x892002_HumanObject(sceneId,selfId)
  -- LuaFnRefreshHumanObject(sceneId,selfId)
-- end


function x892002_FUTI( sceneId, selfId )
	if GetMissionData(sceneId, selfId, HETI_PETID ) > 0 then
		for i = 1400,1437 do
			LuaFnCancelSpecificImpact(sceneId,selfId,i)
		end
		local hetibuff = GetMissionData(sceneId, selfId, HETI_BUFF)
		
		if hetibuff == 0 then
			hetibuff = 1400
		end
		
		if hetibuff >=1400 and hetibuff <= 1437 then
			LuaFnSendSpecificImpactToUnit(sceneId,selfId,selfId,selfId,hetibuff,0)
		end
	else
		for i = 1400,1437 do
			LuaFnCancelSpecificImpact(sceneId,selfId,i)
		end
	end
end


function x892002_FutiBUFF( sceneId, selfId )
	local FutiBUFF = {}
	for i = 1,11 do
		FutiBUFF[i] = 0  --参考真元
	end
	local AA1,AA2,AA3,AA4,AA5,AA6,AA7,AA8,AA9,AA10,AA11 = x892002_PetBuff( sceneId, selfId )
	FutiBUFF[1] = floor(AA1/15)
	FutiBUFF[2] = floor(AA2/15)
	FutiBUFF[3] = floor(AA3/15)
	FutiBUFF[4] = floor(AA4/15)
	FutiBUFF[5] = floor(AA5/4)
	FutiBUFF[6] = floor(AA6/4)
	FutiBUFF[7] = floor(AA7/4)
	FutiBUFF[8] = floor(AA8/4)
	FutiBUFF[9] = floor(AA9/1000)
	FutiBUFF[10] = floor(AA10/100)
	FutiBUFF[11] = floor(AA11/80)
	return FutiBUFF
end




function x892002_PetBuff( sceneId, selfId )
	local mypetguid = GetMissionData(sceneId, selfId, HETI_PETID )
	if mypetguid==0 or mypetguid == nil then
	   return 0,0,0,0,0,0,0,0,0,0,0
	end
 
	pet_shuxin = {}
	pet_shuxin[1] = {15,30,40,60,75,90,115,120} ----宠物的属性攻击
	pet_shuxin[2] = {15,30,40,60,75,90,115,120} ----宠物的属性攻击
	pet_shuxin[3] = {15,30,40,60,75,90,115,120} ----宠物的属性攻击
	pet_shuxin[4] = {15,30,40,60,75,90,115,120} ----宠物的属性攻击
	
	pet_shuxin[5] = {4,8,12,16,20,24,28,32} ----宠物的冰属性抗
	pet_shuxin[6] = {4,8,12,16,20,24,28,32} ----宠物的火属性抗
	pet_shuxin[7] = {4,8,12,16,20,24,28,32} ----宠物的玄属性抗
	pet_shuxin[8] = {4,8,12,16,20,24,28,32} ----宠物的毒属性抗
	
	pet_shuxin[9] = {250,500,750,1000,1250,1500,1750,2000} ----宠物的沸血
	pet_shuxin[10] = {100,200,300,400,500,600,700,800} ----宠物的命中
	pet_shuxin[11] = {80,160,240,320,400,480,560,640} ----宠物的闪避


	ret_petBuff = {0,0,0,0, 0,0,0,0,  0, 0, 0} ---分别表示 四属性攻，四属性抗，血，命中，闪避
	
	
	local petLid = mypetguid
	local isok,petHid = x892002_FightingPet( sceneId, selfId,petLid )
	if isok < 0 then 
		return 0,0,0,0, 0,0,0,0,  0, 0, 0
	end	
	local pet_cs = {1,1,1,1,1,1}
	pet_cs[1] = LuaFnGetPetGrowRateByGUID( sceneId, selfId, petHid, petLid )---得到成长基数
	pet_cs[2] = GetPetPerceptionLevel( sceneId, selfId, petHid, petLid )----得到资质等级
	pet_cs[3] = GetPetSavvy( sceneId, selfId, petHid, petLid ) ---悟性
	pet_cs[4] = LuaFnGetPetTypeByGUID( sceneId, selfId, petHid, petLid ) ----得到变异类型
	pet_cs[5] = floor(LuaFnGetPetLevelByGUID( sceneId, selfId, petHid, petLid ) /15)---珍兽等级参数
	---pet_cs[6] = floor(GetPetTakeLevel(LuaFnGetPetDataIDByGUID(sceneId, selfId, petHid, petLid))/10)---珍兽可携带等级参数
	if pet_cs[1] == nil then
		pet_cs[1] = 1
	end
	if pet_cs[2] == nil then
		pet_cs[2] = 1
	end

	local base_cs = pet_cs[1]+pet_cs[2]+floor(pet_cs[3]/2)+floor(pet_cs[4]/2)+pet_cs[5] ----成长率等级基数+悟性基数+资质成长基数+变异等级+珍兽等级
 
	for i=0 ,6 do ---目前只考虑五个技能栏
		local SkillID = GetPetSkillLevelupTbl(sceneId, selfId, petHid, petLid, i)
		if SkillID and SkillID~= -1 then
			if PET_CURRSKILL[SkillID]~= nil then
				local index = PET_CURRSKILL[SkillID]
				ret_petBuff[index[1]] = pet_shuxin[index[1]][index[2]]*base_cs -------附体属性= 等级基础属性X基础数
			end
		end
	end
     return ret_petBuff[1],ret_petBuff[2],ret_petBuff[3],ret_petBuff[4],ret_petBuff[5],ret_petBuff[6],ret_petBuff[7],ret_petBuff[8],ret_petBuff[9],ret_petBuff[10],ret_petBuff[11]
end



function x892002_FightingPet( sceneId, selfId,nowGuid )
	local	PetNum	= LuaFnGetPetCount( sceneId, selfId )
	local	PetID_H, PetID_L
	local	objId
	if PetNum <= 0 then
		return -1,PetID_H
	end
	
	for i=0, PetNum-1, 1 do
		--根据珍兽index得到珍兽guid
		PetID_H, PetID_L = LuaFnGetPetGUID( sceneId, selfId, i )
		if nowGuid==PetID_L then
			return 1,PetID_H
		end
		-- x889138_Tips(sceneId,selfId, PetID_H.."  "..PetID_L)
	end
	return -1,PetID_H
end

--**********************************
--王权属性返回 君奉天原创王权
--**********************************
function x892002_Get_WangQuan(sceneId,selfId)
	local wqshuxin_cs ={
	["i"]= {100,1},["j"]= {100,2},["k"]= {100,3},["l"]= {100,4},["m"]= {55,5}, ---君奉天原创王权
	["a"]= {171,6},["b"]= {171,7},["c"]= {171,8},["d"]= {171,9},---君奉天原创王权
	["e"]= {20,10},["f"]= {20,11},["g"]= {20,12},["h"]= {20,13}, --君奉天原创王权
	["n"]= {2000,14},["o"]= {2000,15},["p"]= {2000,16},["q"]= {2000,17}, --君奉天原创王权
	["r"]= {11268,18},["s"]= {6000,19},["t"]= {1400,20},["u"]= {369,21},["v"]= {15,22},["w"]= {15,23},["x"]= {20,24},["y"]= {10,25},["z"]= {10,26}}  ---HP,MP,命 中，闪避，会心，会防，所有属性，未用，未用
	
	local sl_cs={{1,2,4,6,8,10,13,16,19},{28,31,34,37,40,43,46,50,54}} ---君奉天原创王权
	local eqid = {101,116,103,104,105,106,107,111,112,113,114,115} ---君奉天原创王权
	local ret_wqshuxin = {0,0,0,0,0  ,0,0,0,0  ,0,0,0,0  ,0,0,0,0  ,0,0,  0,0,0,0,0,  0,0} ---君奉天原创王权
	for _,data in eqid  do
		local itemId=LuaFnGetItemTableIndexByIndex( sceneId, selfId, data )
		if itemId >0 then
			local _,strName = LuaFnGetItemCreator(sceneId, selfId, data)
			--x892002_Tips( sceneId, selfId, strName )
			if strName ~=nil then
				local posx ,posy ,wqstr,wqdj,wqtepy = strfind(strName,"&wq(%w)(%w)(.-)0")
				if posx~=nil and posy~=nil then
					local sl_bl = 0
					if wqstr=="0" and wqdj=="0" then
						sl_bl = 0
					elseif wqstr=="1" and wqdj=="0" then
						sl_bl = 25
					elseif wqstr=="2" and wqdj=="0" then
						sl_bl = 60
					elseif tonumber(wqstr)<2 and tonumber(wqdj)<=9 then
						sl_bl = sl_cs[tonumber(wqstr)+1][tonumber(wqdj)]
					end
					for i=1,strlen(wqtepy) do
						local cs = strsub(wqtepy,i,i)
						if wqshuxin_cs[cs]~=nil then
							local newcs = wqshuxin_cs[cs]
							ret_wqshuxin[newcs[2]] = ret_wqshuxin[newcs[2]]+ceil(newcs[1]*sl_bl/100)
						end
					end
				end
			end
		end
	end
	return ret_wqshuxin
end

---************
---龙纹  君奉天原创
---************
function x892002_Get_LongWen(sceneId, selfId, lwIndex) ---lwps000 00 000 000
	local lwshuxin = {0,0,0,0,0,0,0,0,0} ---君奉天原创龙纹
	local xue_index = {2,3,4,5,7,9,11,14,17,20} --君奉天原创龙纹
	local shu_index = {40,60,80,120,160,220,280,340,420,500} ------君奉天原创龙纹
	local shuxx_index = {2,3,5,7,10,13,17,21,25,30} ---------君奉天原创龙纹
	local itemId=LuaFnGetItemTableIndexByIndex( sceneId, selfId, lwIndex )
	if itemId <1 then
		--x892002_Tips( sceneId, selfId, "没有检测到龙纹装备" )
		return lwshuxin
	end
	local _, myname = LuaFnGetItemCreator(sceneId, selfId, lwIndex);
	local posx,posy,xx,shuXin,shuXinxx =nil,nil,0,0,0
	if (myname ~= nil) then
		posx,posy,xx,shuXin,shuXinxx = strfind( myname,"lwps%w%w%w(%d%d)(%d%d%d)(%d%d%d)")
		if posx ~= nil and posy~=nil then
			xx = tonumber(xx)
			shuXin = tonumber(shuXin)
			shuXinxx = tonumber(shuXinxx)
			
			if xx >0 and xue_index[xx]~=nil then
				lwshuxin[1] = xue_index[xx]
			end
			if shuXin >100 then
				local shu_tepy = floor(shuXin/100)+1
				local shu_lev = mod(shuXin,100)
				if lwshuxin[shu_tepy]~=nil and shu_index[shu_lev]~=nil then
					lwshuxin[shu_tepy] = shu_index[shu_lev]
				end
			end
			if shuXinxx >100 then
				local shuxx_tepy = floor(shuXinxx/100)+5
				local shuxx_lev = mod(shuXinxx,100)
				if lwshuxin[shuxx_tepy]~=nil and shu_index[shuxx_lev]~=nil then
					lwshuxin[shuxx_tepy] = shuxx_index[shuxx_lev]
				end
			end
		end
	end
	
 
	return lwshuxin
end

---************
---精通  君奉天原创 
---************
function x892002_Get_JingTong(sceneId, selfId)  -----精通 &JT TL001 HG001 SB001  新设计的最高可达100级
	local zb_poss = {101,116,103,104,105,106,107,111,112,113,114,115} ---能精通的装备点
	local jt_str = {"ll","lq","tl","dl","sf","bg","hg","xg","dg","wg","ng","wf","nf","sb","mz","xs"}
	-------------力量 灵气 体力 定力 身法 冰攻，火攻，玄攻，毒攻 外攻 内攻 物防 内防  闪  命中  血
	local jt_table = {0,0,0,0,0, 0,0,0,0, 0,0,0,0, 0,0 , 0}
	local jt_cs = {2,2,2,2,2, 3,3,3,3, 20,20,20,20, 5,15 , 100}
	for i, data in zb_poss do
		local itemId=LuaFnGetItemTableIndexByIndex( sceneId, selfId, data )
		if itemId >0 then
			--if  itemId==10412100 or  itemId==10412101 or itemId==10412102 or itemId==10412103 or itemId==10412104 then  ------这是给重楼加的隐藏属性
			--	jt_table[6] = jt_table[6]+120
			--	jt_table[7] = jt_table[7]+120
			--	jt_table[8] = jt_table[8]+120
			--	jt_table[9] = jt_table[9]+120
			--end
			local _,strName = LuaFnGetItemCreator(sceneId, selfId, data)
			if strName ~=nil then
				local posx,posy,JT1str,JT1dj,JT2str,JT2dj,JT3str,JT3dj=strfind(strName,"&JT(%l%l)(%w%w%w)(%l%l)(%w%w%w)(%l%l)(%w%w%w)")
				if posx~=nil  and  posy~=nil then
					for i, k in jt_str do
						if k == JT1str then
							jt_table[i] = jt_table[i]+tonumber(JT1dj)*jt_cs[i]
						end
						if k == JT2str then
							jt_table[i] = jt_table[i]+tonumber(JT2dj)*jt_cs[i]
						end
						if k == JT3str then
							jt_table[i] = jt_table[i]+tonumber(JT3dj)*jt_cs[i]
						end
					end
				end
			end
		end
	end
	return jt_table
end
---************
---令牌  君奉天原创 
---************

function x892002_Get_LingPai(sceneId, selfId,lpIndex)
	
	--------力量1，灵2，体3，定4，身5，
	------- 冰6，火7，玄8，毒9， 冰抗10， 火抗11，玄抗12，毒抗13，减冰14 ，减火15，减玄16 ，减毒17
	------- 外攻18，内攻19，内防20，外防21，命中22，闪避23 ,会心攻击24 ，会心防25 ，血上限26， 所有属性27,最后一个技能保存在28
	local lp_table = {0,0,0,0,0,  0,0,0,0,  0,0,0,0,  0,0,0,0,  0,0,0,0,  0,0,0,0,    0,0,0 }
	local itemId=LuaFnGetItemTableIndexByIndex( sceneId, selfId, lpIndex )
	if itemId <1 then
		for i = 4480,4488 do
			if  LuaFnHaveImpactOfSpecificDataIndex(sceneId, selfId, i ) == 1 then
				LuaFnCancelSpecificImpact( sceneId, selfId, i) -----君奉天原创 
			end
		end
		return lp_table
	end
	local lp_str = {
	["a"]={26,2359,800}, ["b"]={1,30,5},["c"]={2,30,5},["d"]={3,30,5},["e"]={4,30,5},["f"]={5,30,5}, --君奉天原创 
	["g"]={6,22,5},["h"]={7,22,5},["i"]={8,22,5},["j"]={9,22,5},   --君奉天原创 
	["k"]={10,4,2}, ["l"]={11,4,2},["m"]={12,4,2},["n"]={13,4,2},  --君奉天原创 
	["o"]={19,1534,200},["p"]={18,1534,200},["q"]={20,1534,200},["r"]={21,1534,200}, --君奉天原创 
	["s"]={23,179,50},["t"]={22,50,20},  --君奉天原创 
	}
	local star_kuozhan = { ---君奉天原创 
	["a"] ={ 26,10190},  ["b"] ={ 10 ,  80}  ,["c"] ={ 11 ,  80}  ,["d"] ={ 12 ,  80}  ,
	["e"] ={ 13 ,  80},  ["f"] ={ 14 ,  80}  ,["g"] ={ 15 ,  80}  ,["h"] ={ 16 ,  80}  ,
	["i"] ={ 17 ,  80},  ["j"] ={ 24 ,  24}  ,["k"] ={ 25 ,  20}  ,["l"] ={ 27 ,  80} }
	local star_jc = {0.1,0.14,0.2,0.28,0.4,0.55,0.75,1,1.3} ---君奉天原创 
	local star_skilljc = {200,280,400,560,800,1100,1500,2000,2600} ---君奉天原创 
	local star_dj = floor( mod(itemId,100)/10)+1
	star_dj = star_jc[star_dj]
	local _,lpstring = LuaFnGetItemCreator(sceneId, selfId, lpIndex)
	if lpstring ==nil then
		return lp_table
	end
	local posx ,posy = nil,nil
	local bz_str ={ {"0","00"},{"0","00"},{"0","00"},{"0","00"},{"0"} ,{"0"},{"0"},{"0"} }
	local skillbuff = { ["a"] = 4485 ,["b"] = 4486 ,["c"] = 4487 ,["d"] = 4488 ,["u"] = 4480 ,["v"] = 4481 ,["w"] = 4482 ,["x"] = 4483 ,["y"] = 4484 }
	posx,posy,bz_str[1][1],bz_str[1][2] ,bz_str[2][1],bz_str[2][2],bz_str[3][1],bz_str[3][2],bz_str[4][1],bz_str[4][2],bz_str[5],bz_str[6],bz_str[7],bz_str[8] =strfind(lpstring,"LP%w%w(%w)(%w%w)(%w)(%w%w)(%w)(%w%w)(%w)(%w%w)(%w)(%w)(%w)(%w)")
	
	if posx~=nil  and posy~=nil then
		for i=1,getn(bz_str) do
			if i <=4 then
				local lpstrIndex = bz_str[i][1]
				if lp_str[lpstrIndex]~=nil then
					lp_table[lp_str[lpstrIndex][1]] = lp_str[lpstrIndex][2]+(lp_str[lpstrIndex][3]*tonumber(bz_str[i][2]))*star_dj
					lp_table[lp_str[lpstrIndex][1]] = floor(lp_table[lp_str[lpstrIndex][1]])
				end
			elseif i <=7 then
				local kzstr = bz_str[i]
				if star_kuozhan[kzstr]~=nil then
					lp_table[star_kuozhan[kzstr][1]] = lp_table[star_kuozhan[kzstr][1]]+star_kuozhan[kzstr][2]*star_dj
					lp_table[star_kuozhan[kzstr][1]] = floor(lp_table[star_kuozhan[kzstr][1]])
					
				end
			elseif i ==8 then
				if bz_str[i] ~="0" and skillbuff[bz_str[i]]~=nil  then
					if LuaFnHaveImpactOfSpecificDataIndex(sceneId, selfId, skillbuff[bz_str[i]] ) ~= 1 then
						LuaFnSendSpecificImpactToUnit( sceneId, selfId, selfId, selfId, skillbuff[bz_str[i]],0 ) ----加个令牌技能BUFF
					end
				end
			end
		end
	else
		return lp_table
	end
	return lp_table
end

function x892002_DanDuCC(sceneId,selfId)
LuaFnCancelSpecificImpact(sceneId,selfId,10090)
--龙纹118 令牌 109 衣服 116
local yifu = 0
local _,QiangHuC = LuaFnGetItemCreator(sceneId, selfId, 116)
if QiangHuC ~= nil  then
local QiangHuaD = strfind(QiangHuC,"&PYY")
if QiangHuaD ~= nil  then
yifu = x892002_g_qianghuaLevelT[tonumber(strsub( QiangHuC, QiangHuaD+4,QiangHuaD+5 ))][1]
end
end


local longwean = 0
local _,QiangHuC = LuaFnGetItemCreator(sceneId, selfId, 118)
if QiangHuC ~= nil  then
local QiangHuaD = strfind(QiangHuC,"&PYY")
if QiangHuaD ~= nil  then
longwean = x892002_g_qianghuaLevelT[tonumber(strsub( QiangHuC, QiangHuaD+4,QiangHuaD+5 ))][1]
end
end

local Lpddd = 0
local _,QiangHuC = LuaFnGetItemCreator(sceneId, selfId, 109)
if QiangHuC ~= nil  then
local QiangHuaD = strfind(QiangHuC,"&PYY")
if QiangHuaD ~= nil  then
Lpddd = x892002_g_qianghuaLevelT[tonumber(strsub( QiangHuC, QiangHuaD+4,QiangHuaD+5 ))][1]
end
end

local _,QiangHuC = LuaFnGetItemCreator(sceneId, selfId, 102)
if QiangHuC ~= nil  then
local QiangHuaD = strfind(QiangHuC,"&JSMY")
if QiangHuaD ~= nil  then
LuaFnSendSpecificImpactToUnit(sceneId,selfId,selfId,selfId,10090,0)
end
end


return yifu,longwean,Lpddd
end

function x892002_Tips( sceneId, selfId, Msg )
	BeginEvent( sceneId )
	if Msg==nil then 
	AddText( sceneId, "Msg为空值" )	
	else
	AddText( sceneId, Msg )
	end
	EndEvent( sceneId )
	DispatchMissionTips( sceneId, selfId )
end


function x892002_ShengLing( sceneId, selfId )--查看自己的
local wocalei = {1,1,1,1,1,1,1,1,1,1,1,1,1,} --武器
local _, myname1 = LuaFnGetItemCreator(sceneId,  selfId, 100);
local _, myname2 = LuaFnGetItemCreator(sceneId,  selfId, 101);
local _, myname3 = LuaFnGetItemCreator(sceneId,  selfId, 116);
local _, myname4 = LuaFnGetItemCreator(sceneId,  selfId, 114);
local _, myname5 = LuaFnGetItemCreator(sceneId,  selfId, 104);
local _, myname6 = LuaFnGetItemCreator(sceneId,  selfId, 105);
local _, myname7 = LuaFnGetItemCreator(sceneId,  selfId, 106);
local _, myname8 = LuaFnGetItemCreator(sceneId,  selfId, 107);
local _, myname9 = LuaFnGetItemCreator(sceneId,  selfId, 111);
local _, myname10 = LuaFnGetItemCreator(sceneId, selfId, 112);
local _, myname11 = LuaFnGetItemCreator(sceneId, selfId, 113);
local _, myname12 = LuaFnGetItemCreator(sceneId, selfId, 103);
local _, myname13 = LuaFnGetItemCreator(sceneId, selfId, 115);
--顺序为 武器、帽子、衣服、护腕、鞋子、腰带、戒指、项链、戒指2、护符1、护符2、手套、护肩
--顺序为 100、  101、 102、 114、104 、105 、106  、107  、111 、112、113、   103 、115
local myname = {myname1,myname2,myname3,myname4,myname5,myname6,myname7,myname8,myname9,myname10,myname11,myname12,myname13,}     

---	改为接口形式 麻痹的，搞不懂buff为何能影响UI通讯，必须写接口！烦的一批    SD_DUJKANG+SD_XUANJKANG = 13位值

--检测王权分批次检测
for i = 1,7 do
if myname[i] ~= nil then
local sree1 = strfind( myname[i],"wq1")
if sree1 ~= nil then
wocalei[i] = 2
end
end
end
for i = 7,13 do
if myname[i] ~= nil then
local sree1 = strfind( myname[i],"wq1")
if sree1 ~= nil then
wocalei[i] = 2
end
end
end


--结束

--检测天道

for i = 1,7 do
if myname[i] ~= nil then
local sree1 = strfind( myname[i],"wq2")
if sree1 ~= nil then
wocalei[i] = 3
end
end
end
for i = 7,13 do
if myname[i] ~= nil then
local sree1 = strfind( myname[i],"wq2")
if sree1 ~= nil then
wocalei[i] = 3
end
end
end
--结束



local shuzhi = wocalei[1]..wocalei[2]..wocalei[3]..wocalei[4]..wocalei[5]..wocalei[6]..wocalei[7]
local shuzhia = wocalei[8]..wocalei[9]..wocalei[10]..wocalei[11]..wocalei[12]..wocalei[13]

      SetMissionData(sceneId,selfId,SD_DUJKANG,shuzhi)
      SetMissionData(sceneId,selfId,SD_XUANJKANG,shuzhia)
	  BeginUICommand( sceneId )	
	  EndUICommand( sceneId )
	  DispatchUICommand( sceneId, selfId, 2019040936 )

end
function x892002_QiangHua(sceneId,selfId)
local wuju ={1,2,3,4}

-----武具
local aaa = GetBagItemParam( sceneId, selfId, 107, 3, 1)--项链
local bbb = GetBagItemParam( sceneId, selfId, 100, 3, 1)--武器
local ccc = GetBagItemParam( sceneId, selfId, 114, 3, 1)--护腕
local ddd = GetBagItemParam( sceneId, selfId, 106, 3, 1)--戒指1
local eee = GetBagItemParam( sceneId, selfId, 111, 3, 1)--戒指2
local fff = GetBagItemParam( sceneId, selfId, 112, 3, 1)--护符1
local ggg = GetBagItemParam( sceneId, selfId, 113, 3, 1)--护符2
local wujuqianghua = tonumber(aaa + bbb + ccc + ddd + eee + fff + ggg)
if wujuqianghua < 30 then
SetMissionData(sceneId,selfId,SD_BINGKANGX,0)
elseif wujuqianghua >= 30 and wujuqianghua < 40 then
SetMissionData(sceneId,selfId,SD_BINGKANGX,wuju[1])
elseif  wujuqianghua >= 40 and wujuqianghua < 50 then
SetMissionData(sceneId,selfId,SD_BINGKANGX,wuju[2])
elseif  wujuqianghua >= 50 and wujuqianghua < 60 then
SetMissionData(sceneId,selfId,SD_BINGKANGX,wuju[3])
elseif  wujuqianghua >= 60 and wujuqianghua < 1000 then
SetMissionData(sceneId,selfId,SD_BINGKANGX,wuju[4])
end
if GetMissionData(sceneId,selfId,SD_BINGKANGX) > 0 then
for i = 1, GetMissionData(sceneId,selfId,SD_BINGKANGX) do
LuaFnSendSpecificImpactToUnit(sceneId,selfId,selfId,selfId,32706+i)
end
end
-----防具
local wocalei = 0
local _,QiangHuC = LuaFnGetItemCreator(sceneId, selfId, 116)
if QiangHuC ~= nil  then
local QiangHuaD = strfind(QiangHuC,"&PYY")
if QiangHuaD ~= nil  then
wocalei = tonumber(strsub( QiangHuC, QiangHuaD+4,QiangHuaD+5 ))
end
end
--local wocalei = GetBagItemParam( sceneId, selfId, 107, 3, 1)--项链
local bbbb = GetBagItemParam( sceneId, selfId, 101, 3, 1)--武器
local cccc = GetBagItemParam( sceneId, selfId, 115, 3, 1)--护腕
local dddd = GetBagItemParam( sceneId, selfId, 103, 3, 1)--戒指1
local eeee = GetBagItemParam( sceneId, selfId, 105, 3, 1)--戒指2
local ffff = GetBagItemParam( sceneId, selfId, 104, 3, 1)--护符1
local fangjuqianghua = tonumber( wocalei+bbbb + cccc + dddd + eeee + ffff)
if fangjuqianghua < 30 then
SetMissionData(sceneId,selfId,SD_HUOKANGX,0)
end
if fangjuqianghua >= 30 and fangjuqianghua < 40 then
SetMissionData(sceneId,selfId,SD_HUOKANGX,wuju[1])
end
if  fangjuqianghua >= 40 and fangjuqianghua < 50 then
SetMissionData(sceneId,selfId,SD_HUOKANGX,wuju[2])
end
if  fangjuqianghua >= 50 and fangjuqianghua < 60 then
SetMissionData(sceneId,selfId,SD_HUOKANGX,wuju[3])
end
if  fangjuqianghua >= 60 and fangjuqianghua < 1000 then
SetMissionData(sceneId,selfId,SD_HUOKANGX,wuju[4])
end
if GetMissionData(sceneId,selfId,SD_HUOKANGX) > 0 then
for i = 0, GetMissionData(sceneId,selfId,SD_HUOKANGX) do
LuaFnSendSpecificImpactToUnit(sceneId,selfId,selfId,selfId,32709+i)
end
end

end

function x892002_DiaoYong(sceneId,selfId)
   --检测太古神器
        local SGSQ = 0
        local _, myname = LuaFnGetItemCreator(sceneId, selfId,100);
        if myname ~= nil then
	   local sree1 = strfind(myname,"#S")
	   if sree1 ~= nil then
                SGSQ = tonumber(strsub(myname,sree1+2,sree1+9))
           end
        end
        SetMissionData(sceneId,selfId,SuperWeapon9_DIYSkill,mod(SGSQ,10^6))
        if floor(SGSQ/10^6) >= 2 then
           if HaveSkill( sceneId, selfId, 930 ) ~= 1 then
                AddSkill( sceneId, selfId, 930 )
           end
        else
           DelSkill( sceneId, selfId, 930 )
        end

	local jiance1 = LuaFnGetItemTableIndexByIndex( sceneId, selfId, 117)
        if jiance1 == 10155021 or jiance1 >= 10155100 and jiance1 <= 10155139 then
           --if HaveSkill( sceneId, selfId, 277 ) < 1 then
              --AddSkill(sceneId, selfId, 277)
          -- end
           for i = 901,905 do
              if HaveSkill( sceneId, selfId, i ) < 1 then
                 AddSkill(sceneId, selfId, i)
              end
           end
        else
           --if HaveSkill( sceneId, selfId, 277 ) == 1 then
	       -- DelSkill( sceneId, selfId, 277 )
           --end
           for i = 901,905 do
              if HaveSkill( sceneId, selfId, i ) == 1 then
                 DelSkill(sceneId, selfId, i)
              end
           end
        end
end
--VMRU作式了中以我些开作上70






--VMRU作式了中以我些开作上70

