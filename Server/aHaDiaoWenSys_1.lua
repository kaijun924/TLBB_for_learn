x809272_g_scriptId = 809272
--脚本号
x809272_g_DWBaseID=30110001
x809272_g_needMoeny=50000
g_DWsiachu1 = {}
g_DWsiachu1["ti"] = 30110000
g_DWsiachu1["lt"] = 30110020
g_DWsiachu1["ll"] = 30110030
g_DWsiachu1["sf"] = 30110110
g_DWsiachu1["bg"] = 30110040
g_DWsiachu1["hg"] = 30110050
g_DWsiachu1["xg"] = 30110060
g_DWsiachu1["dg"] = 30110070
g_DWsiachu1["bj"] = 30110120
g_DWsiachu1["hj"] = 30110130
g_DWsiachu1["xj"] = 30110140
g_DWsiachu1["dj"] = 30110150
g_DWsiachu1["bk"] = 30110160
g_DWsiachu1["hk"] = 30110170
g_DWsiachu1["xk"] = 30110180
g_DWsiachu1["dk"] = 30110190
g_DWsiachu1["ww"] = 30110200
g_DWsiachu1["mx"] = 30110210
g_DWsiachu1["yj"] = 30110220
g_DWsiachu1["bn"] = 30110230

g_DWhc={}
g_DWhc[30120001] = 30110001
g_DWhc[30120002] = 30110031
g_DWhc[30120003] = 30110021
g_DWhc[30120004] = 30110041
g_DWhc[30120005] = 30110051
g_DWhc[30120006] = 30110061
g_DWhc[30120007] = 30110071
g_DWhc[30120008] = 30110161
g_DWhc[30120009] = 30110171
g_DWhc[30120010] = 30110181
g_DWhc[30120011] = 30110191
g_DWhc[30120016] = 30110111
g_DWhc[30120012] = 30110121
g_DWhc[30120013] = 30110131
g_DWhc[30120014] = 30110141
g_DWhc[30120015] = 30110151
g_DWhc[30120017] = 30110201
g_DWhc[30120018] = 30110211
g_DWhc[30120019] = 30110221
g_DWhc[30120020] = 30110231

g_XieZi_Dw={}
g_XieZi_Dw[30110001]="ti01"  --体力
g_XieZi_Dw[30110002]="ti02"
g_XieZi_Dw[30110003]="ti03"
g_XieZi_Dw[30110004]="ti04"
g_XieZi_Dw[30110005]="ti05"
g_XieZi_Dw[30110006]="ti06"
g_XieZi_Dw[30110007]="ti07"
g_XieZi_Dw[30110008]="ti08"
g_XieZi_Dw[30110009]="ti09"
g_XieZi_Dw[30110010]="ti10"
-----------------------------
g_XieZi_Dw[30110021]="lt01"  --灵气
g_XieZi_Dw[30110022]="lt02"
g_XieZi_Dw[30110023]="lt03"
g_XieZi_Dw[30110024]="lt04"
g_XieZi_Dw[30110025]="lt05"
g_XieZi_Dw[30110026]="lt06"
g_XieZi_Dw[30110027]="lt07"
g_XieZi_Dw[30110028]="lt08"
g_XieZi_Dw[30110029]="lt09"
g_XieZi_Dw[30110030]="lt10"
-----------------------------
g_XieZi_Dw[30110031]="ll01"  --力量
g_XieZi_Dw[30110032]="ll02"
g_XieZi_Dw[30110033]="ll03"
g_XieZi_Dw[30110034]="ll04"
g_XieZi_Dw[30110035]="ll05"
g_XieZi_Dw[30110036]="ll06"
g_XieZi_Dw[30110037]="ll07"
g_XieZi_Dw[30110038]="ll08"
g_XieZi_Dw[30110039]="ll09"
g_XieZi_Dw[30110040]="ll10"
----------------------------------
g_XieZi_Dw[30110111]="sf01"  --身法
g_XieZi_Dw[30110112]="sf02"
g_XieZi_Dw[30110113]="sf03"
g_XieZi_Dw[30110114]="sf04"
g_XieZi_Dw[30110115]="sf05"
g_XieZi_Dw[30110116]="sf06"
g_XieZi_Dw[30110117]="sf07"
g_XieZi_Dw[30110118]="sf08"
g_XieZi_Dw[30110119]="sf09"
g_XieZi_Dw[30110120]="sf10"
-----------------------------------
g_XieZi_Dw[30110041]="bg01"  --冰功
g_XieZi_Dw[30110042]="bg02"  
g_XieZi_Dw[30110043]="bg03"  
g_XieZi_Dw[30110044]="bg04"  
g_XieZi_Dw[30110045]="bg05"  
g_XieZi_Dw[30110046]="bg06"  
g_XieZi_Dw[30110047]="bg07"  
g_XieZi_Dw[30110048]="bg08"  
g_XieZi_Dw[30110049]="bg09"  
g_XieZi_Dw[30110050]="bg10"  
------------------------------
g_XieZi_Dw[30110051]="hg01"  --火功
g_XieZi_Dw[30110052]="hg02"  
g_XieZi_Dw[30110053]="hg03"  
g_XieZi_Dw[30110054]="hg04"  
g_XieZi_Dw[30110055]="hg05"  
g_XieZi_Dw[30110056]="hg06"  
g_XieZi_Dw[30110057]="hg07"  
g_XieZi_Dw[30110058]="hg08"  
g_XieZi_Dw[30110059]="hg09"  
g_XieZi_Dw[30110060]="hg10"  
------------------------------
g_XieZi_Dw[30110061]="xg01"  --玄功
g_XieZi_Dw[30110062]="xg02"  
g_XieZi_Dw[30110063]="xg03"  
g_XieZi_Dw[30110064]="xg04"  
g_XieZi_Dw[30110065]="xg05"  
g_XieZi_Dw[30110066]="xg06"  
g_XieZi_Dw[30110067]="xg07"  
g_XieZi_Dw[30110068]="xg08"  
g_XieZi_Dw[30110069]="xg09"  
g_XieZi_Dw[30110070]="xg10"  
------------------------------
g_XieZi_Dw[30110071]="dg01"  --毒功
g_XieZi_Dw[30110072]="dg02"  
g_XieZi_Dw[30110073]="dg03"  
g_XieZi_Dw[30110074]="dg04"  
g_XieZi_Dw[30110075]="dg05"  
g_XieZi_Dw[30110076]="dg06"  
g_XieZi_Dw[30110077]="dg07"  
g_XieZi_Dw[30110078]="dg08"  
g_XieZi_Dw[30110079]="dg09"  
g_XieZi_Dw[30110080]="dg10"  
------------------------------
g_XieZi_Dw[30110121]="bj01"  --冰减
g_XieZi_Dw[30110122]="bj02"  
g_XieZi_Dw[30110123]="bj03"  
g_XieZi_Dw[30110124]="bj04"  
g_XieZi_Dw[30110125]="bj05"  
g_XieZi_Dw[30110126]="bj06"  
g_XieZi_Dw[30110127]="bj07"  
g_XieZi_Dw[30110128]="bj08"  
g_XieZi_Dw[30110129]="bj09"  
g_XieZi_Dw[30110130]="bj10"  
------------------------------
g_XieZi_Dw[30110131]="hj01"  --火减
g_XieZi_Dw[30110132]="hj02"  
g_XieZi_Dw[30110133]="hj03"  
g_XieZi_Dw[30110134]="hj04"  
g_XieZi_Dw[30110135]="hj05"  
g_XieZi_Dw[30110136]="hj06"  
g_XieZi_Dw[30110137]="hj07"  
g_XieZi_Dw[30110138]="hj08"  
g_XieZi_Dw[30110139]="hj09"  
g_XieZi_Dw[30110140]="hj10"  
------------------------------
g_XieZi_Dw[30110141]="xj01"  --玄减
g_XieZi_Dw[30110142]="xj02"  
g_XieZi_Dw[30110143]="xj03"  
g_XieZi_Dw[30110144]="xj04"  
g_XieZi_Dw[30110145]="xj05"  
g_XieZi_Dw[30110146]="xj06"  
g_XieZi_Dw[30110147]="xj07"  
g_XieZi_Dw[30110148]="xj08"  
g_XieZi_Dw[30110149]="xj09"  
g_XieZi_Dw[30110150]="xj10"  
------------------------------
g_XieZi_Dw[30110151]="dj01"  --毒减
g_XieZi_Dw[30110152]="dj02"  
g_XieZi_Dw[30110153]="dj03"  
g_XieZi_Dw[30110154]="dj04"  
g_XieZi_Dw[30110155]="dj05"  
g_XieZi_Dw[30110156]="dj06"  
g_XieZi_Dw[30110157]="dj07"  
g_XieZi_Dw[30110158]="dj08"  
g_XieZi_Dw[30110159]="dj09"  
g_XieZi_Dw[30110160]="dj10"  
------------------------------
g_XieZi_Dw[30110161]="bk01"  --冰抗
g_XieZi_Dw[30110162]="bk02"  
g_XieZi_Dw[30110163]="bk03"  
g_XieZi_Dw[30110164]="bk04"  
g_XieZi_Dw[30110165]="bk05"  
g_XieZi_Dw[30110166]="bk06"  
g_XieZi_Dw[30110167]="bk07"  
g_XieZi_Dw[30110168]="bk08"  
g_XieZi_Dw[30110169]="bk09"  
g_XieZi_Dw[30110170]="bk10"  
------------------------------
g_XieZi_Dw[30110171]="hk01"  --火抗
g_XieZi_Dw[30110172]="hk02"  
g_XieZi_Dw[30110173]="hk03"  
g_XieZi_Dw[30110174]="hk04"  
g_XieZi_Dw[30110175]="hk05"  
g_XieZi_Dw[30110176]="hk06"  
g_XieZi_Dw[30110177]="hk07"  
g_XieZi_Dw[30110178]="hk08"  
g_XieZi_Dw[30110179]="hk09"  
g_XieZi_Dw[30110180]="hk10"  
------------------------------
g_XieZi_Dw[30110181]="xk01"  --玄抗
g_XieZi_Dw[30110182]="xk02"  
g_XieZi_Dw[30110183]="xk03"  
g_XieZi_Dw[30110184]="xk04"  
g_XieZi_Dw[30110185]="xk05"  
g_XieZi_Dw[30110186]="xk06"  
g_XieZi_Dw[30110187]="xk07"  
g_XieZi_Dw[30110188]="xk08"  
g_XieZi_Dw[30110189]="xk09"  
g_XieZi_Dw[30110190]="xk10"  
------------------------------
g_XieZi_Dw[30110191]="dk01"  --毒抗
g_XieZi_Dw[30110192]="dk02"  
g_XieZi_Dw[30110193]="dk03"  
g_XieZi_Dw[30110194]="dk04"  
g_XieZi_Dw[30110195]="dk05"  
g_XieZi_Dw[30110196]="dk06"  
g_XieZi_Dw[30110197]="dk07"  
g_XieZi_Dw[30110198]="dk08"  
g_XieZi_Dw[30110199]="dk09"  
g_XieZi_Dw[30110200]="dk10"  
------------------------------
g_XieZi_Dw[30110201]="ww01"  --忘无
g_XieZi_Dw[30110202]="ww02"  
g_XieZi_Dw[30110203]="ww03"  
g_XieZi_Dw[30110204]="ww04"  
g_XieZi_Dw[30110205]="ww05"  
g_XieZi_Dw[30110206]="ww06"  
g_XieZi_Dw[30110207]="ww07"  
g_XieZi_Dw[30110208]="ww08"  
g_XieZi_Dw[30110209]="ww09"  
g_XieZi_Dw[30110210]="ww10"  
------------------------------
g_XieZi_Dw[30110211]="mx01"  --冥想
g_XieZi_Dw[30110212]="mx02"  
g_XieZi_Dw[30110213]="mx03"  
g_XieZi_Dw[30110214]="mx04"  
g_XieZi_Dw[30110215]="mx05"  
g_XieZi_Dw[30110216]="mx06"  
g_XieZi_Dw[30110217]="mx07"  
g_XieZi_Dw[30110218]="mx08"  
g_XieZi_Dw[30110219]="mx09"  
g_XieZi_Dw[30110220]="mx10"  
------------------------------
g_XieZi_Dw[30110221]="yj01"  --御劲
g_XieZi_Dw[30110222]="yj02"  
g_XieZi_Dw[30110223]="yj03"  
g_XieZi_Dw[30110224]="yj04"  
g_XieZi_Dw[30110225]="yj05"  
g_XieZi_Dw[30110226]="yj06"  
g_XieZi_Dw[30110227]="yj07"  
g_XieZi_Dw[30110228]="yj08"  
g_XieZi_Dw[30110229]="yj09"  
g_XieZi_Dw[30110230]="yj10"  
------------------------------
g_XieZi_Dw[30110231]="bn01"  --暴怒
g_XieZi_Dw[30110232]="bn02"  
g_XieZi_Dw[30110233]="bn03"  
g_XieZi_Dw[30110234]="bn04"  
g_XieZi_Dw[30110235]="bn05"  
g_XieZi_Dw[30110236]="bn06"  
g_XieZi_Dw[30110237]="bn07"  
g_XieZi_Dw[30110238]="bn08"  
g_XieZi_Dw[30110239]="bn09"  
g_XieZi_Dw[30110240]="bn10"  


function x809272_DoDiaowenAction( sceneId, selfId, dwtype,arg1,arg2,arg3 )
	
	if LuaFnGetPropertyBagSpace( sceneId, selfId ) <4 or LuaFnGetMaterialBagSpace( sceneId, selfId ) <4 then 
	x809272_NotifyTip( sceneId, selfId, "请预留道具栏和材料栏空位4枚" )	
		return
	end	
	
	local EquipType	= LuaFnGetBagEquipType( sceneId, selfId, arg1 )
	if dwtype==1 then
	if EquipType == 2 or EquipType == 8 or (LuaFnGetItemTableIndexByIndex( sceneId, selfId, arg1 ) >= 10124300 and LuaFnGetItemTableIndexByIndex( sceneId, selfId, arg1 ) <= 10141201)  then

		x809272_NotifyTip( sceneId, selfId, "暂不开放,坐骑,时装,百宝箱,百宝囊雕纹" )
		return	
		else
		x809272_DWShike( sceneId, selfId, arg1,arg2,arg3 )		
		end
	elseif dwtype==2 then		
		x809272_DWQianghua( sceneId, selfId, arg1,arg2 )
	elseif dwtype==4 then		
		x809272_DWQianghua1( sceneId, selfId, arg1,arg2 )	
	elseif dwtype==3 then
		x809272_DWChaichu( sceneId, selfId, arg1,arg2 )  --用
	elseif dwtype==5 then
		x809272_DWChaichu1( sceneId, selfId, arg1,arg2 )  --用	
	elseif dwtype==8 then		
	x809272_DWHecheng( sceneId, selfId, arg1)
	elseif dwtype==9 then		
	x809272_DWShike1( sceneId, selfId, arg1,arg2,arg3 )
	end	
end

   --g_DWsiachu1
function x809272_DWHecheng( sceneId, selfId, itemPos )  --合成onk
	local itemTableIndex = LuaFnGetItemTableIndexByIndex( sceneId, selfId, itemPos )
	if LuaFnGetAvailableItemCount(sceneId, selfId, 20310173) < 20 then
		x809272_NotifyTip( sceneId, selfId, "丹青少于20个，请检查。" )
		return
	end
	if LuaFnGetAvailableItemCount(sceneId, selfId, 20502009) < 20 then
		x809272_NotifyTip( sceneId, selfId, "黄纸少于20个，请检查。" )
		return
	end
	if CostMoney(sceneId, selfId, x809272_g_needMoeny) == -1 then
		x809272_NotifyTip( sceneId, selfId, "金钱不足。" )
		return
	end
	LuaFnDelAvailableItem(sceneId,selfId,20310173,20)
	LuaFnDelAvailableItem(sceneId,selfId,20502009,20)
	if g_DWhc[itemTableIndex] == nil then
		return
	end
	LuaFnEraseItem( sceneId, selfId, itemPos )
	
	local bagpos01 = TryRecieveItem( sceneId, selfId, g_DWhc[itemTableIndex], 1)
	LuaFnSendSpecificImpactToUnit(sceneId, selfId, selfId, selfId, 148, 0)
	x809272_NotifyTip( sceneId, selfId, "恭喜你，成功合成了一个"..GetItemName( sceneId,g_DWhc[itemTableIndex]) )
end

function x809272_DWChaichu( sceneId, selfId, arg1,arg2 )  --OK
	local index99,index999 ,str1,str2= x809272_DWShikeJC( sceneId, selfId, arg1 )
	local nItemId1 = LuaFnGetItemTableIndexByIndex( sceneId, selfId, arg1 )
	local nItemId2 = LuaFnGetItemTableIndexByIndex( sceneId, selfId, arg2 )
	local EquipType	= LuaFnGetBagEquipType( sceneId, selfId, arg1 )
		if EquipType == 17 then
			if nItemId1 < 10155011 and 10155020 >nItemId1 then 
			x809272_NotifyTip( sceneId, selfId, "该装备不属于雕纹装备" )
                   else	
			x809272_NotifyTip( sceneId, selfId, "暗器雕纹不允许摘除" )
             return 
			end
			if nItemId2 ~= 30121002 then
		    x809272_NotifyTip( sceneId, selfId, "需要熔金粉。" )
		    return
	        end	
			LuaFnDelAvailableItem(sceneId,selfId,30121002,1)
		    AddMoney( sceneId, selfId, 0-50000 );
			TryRecieveItem( sceneId, selfId, 30110000+(nItemId1-10155010), 1)	
			LuaFnEraseItem( sceneId, selfId, arg1 )
	                local pos1 =  TryRecieveItem( sceneId, selfId, 10155002, 1)
	                CallScriptFunction( 895111, "SHANG_BAOS", sceneId, selfId ,arg1,pos1)
			
		x809272_NotifyTip( sceneId, selfId, "雕纹拆除成功")
		else
		
      if index99 <=0 then 
		x809272_NotifyTip( sceneId, selfId, "该装备并没有蚀刻雕纹" )
		return
	  end 
	
		local needMoney=5*index99
		local needMoney1=50000*index99
		if GetMoney(sceneId,selfId)<needMoney1 then
		x809272_NotifyTip( sceneId, selfId, "金钱不足。需要金币"..needMoney )
		return
	   end
	if nItemId2 ~= 30121002 then
		x809272_NotifyTip( sceneId, selfId, "需要熔金粉。" )
		return
	end
	if nItemId1<10100000 or nItemId1>15600000 then
		x809272_NotifyTip( sceneId, selfId, "请放入正确装备。" )
		return
	end
	if str1 ==nil  or str1=="00" then 
	x809272_NotifyTip( sceneId, selfId, "该装备并没有蚀刻雕纹" )	
	return
	end	

	if str2 ~=nil  and str2~="00" then 
	x809272_NotifyTip( sceneId, selfId, "请先摘除第二个雕纹" )	
	return
	end

	
	
	if  g_DWsiachu1[str1] ~= nil then 
		TryRecieveItem( sceneId, selfId, g_DWsiachu1[str1]+index99, 1)

	end	
		LuaFnRefreshItemInfo( sceneId, selfId, arg1 )
		LuaFnDelAvailableItem(sceneId,selfId,30121002,1)
		AddMoney( sceneId, selfId, 0-needMoney1 );

	LuaFnSendSpecificImpactToUnit(sceneId, selfId, selfId, selfId, 149, 0)   

	local _, name = LuaFnGetItemCreator(sceneId, selfId, arg1);
	if name == nil then
		name=""
	end
	
	name11=gsub(name,"(&DW)%w%w%w%w(%w%w%w%w)","%1".."0000".."%2")
		LuaFnSetItemCreator( sceneId, selfId, arg1, name11 )
		LuaFnRefreshItemInfo( sceneId, selfId, arg1 )
		x809272_NotifyTip( sceneId, selfId, "雕纹拆除成功")		
	end	
end

function x809272_DWChaichu1( sceneId, selfId, arg1,arg2 )  --OK
	local index99,index999 ,str1,str2= x809272_DWShikeJC( sceneId, selfId, arg1 )
	local nItemId1 = LuaFnGetItemTableIndexByIndex( sceneId, selfId, arg1 )
	local nItemId2 = LuaFnGetItemTableIndexByIndex( sceneId, selfId, arg2 )
	local EquipType	= LuaFnGetBagEquipType( sceneId, selfId, arg1 )
		if EquipType == 17 then
			if nItemId1 < 10155011 and 10155020 >nItemId1 then 
			x809272_NotifyTip( sceneId, selfId, "该装备不属于雕纹装备" )
                   else
			x809272_NotifyTip( sceneId, selfId, "暗器尚不支持双极雕文，何来摘除？" )
             return 
			end
			if nItemId2 ~= 30121002 then
		    x809272_NotifyTip( sceneId, selfId, "需要熔金粉。" )
		    return
	        end	
			LuaFnDelAvailableItem(sceneId,selfId,30121002,1)
		    AddMoney( sceneId, selfId, 0-50000 );
			TryRecieveItem( sceneId, selfId, 30110000+(nItemId1-10155010), 1)

			LuaFnEraseItem( sceneId, selfId, arg1 )
	                local pos1 =  TryRecieveItem( sceneId, selfId, 10155002, 1)
	                CallScriptFunction( 895111, "SHANG_BAOS", sceneId, selfId ,arg1,pos1)

			
		x809272_NotifyTip( sceneId, selfId, "雕纹拆除成功")
		else
		
      if index999 <=0 then 
		x809272_NotifyTip( sceneId, selfId, "该装备并没有蚀刻第二个雕纹" )
		return
	  end 
	
		local needMoney=5*index999
		local needMoney1=50000*index999
		if GetMoney(sceneId,selfId)<needMoney1 then
		x809272_NotifyTip( sceneId, selfId, "金钱不足。需要金币"..needMoney )
		return
	   end
	if nItemId2 ~= 30121002 then
		x809272_NotifyTip( sceneId, selfId, "需要熔金粉。" )
		return
	end
	if nItemId1<10100000 or nItemId1>15600000 then
		x809272_NotifyTip( sceneId, selfId, "请放入正确装备。" )
		return
	end
	if str2 ==nil  or str2=="00" then 
	x809272_NotifyTip( sceneId, selfId, "该装备并没有蚀刻第二个雕纹" )	
	return
	end	
	
	
	if  g_DWsiachu1[str2] ~= nil then 
		TryRecieveItem( sceneId, selfId, g_DWsiachu1[str2]+index999, 1)

	end	
		LuaFnRefreshItemInfo( sceneId, selfId, arg1 )
		LuaFnDelAvailableItem(sceneId,selfId,30121002,1)
		AddMoney( sceneId, selfId, 0-needMoney1 );

	LuaFnSendSpecificImpactToUnit(sceneId, selfId, selfId, selfId, 149, 0)   


	local _, name = LuaFnGetItemCreator(sceneId, selfId, arg1);
	if name == nil then
		name=""
	end
	name11=gsub(name,"(&DW%w%w%w%w)%w%w%w%w","%1".."0000")
		LuaFnSetItemCreator( sceneId, selfId, arg1, name11 )
		LuaFnRefreshItemInfo( sceneId, selfId, arg1 )
		x809272_NotifyTip( sceneId, selfId, "双级雕纹拆除成功")
		
    end		
end

function x809272_DWQianghua( sceneId, selfId, arg1,arg2 ) --ok
	local needCailiao={2,9,50,87,165,284,811,2988,3570}
	local index99,index999 ,str1= x809272_DWShikeJC( sceneId, selfId, arg1 )
	local nItemId1 = LuaFnGetItemTableIndexByIndex( sceneId, selfId, arg1 )
	local EquipType	= LuaFnGetBagEquipType( sceneId, selfId, arg1 )
		if EquipType == 17 then
			if nItemId1 < 10155011  then 
			x809272_NotifyTip( sceneId, selfId, "该暗器没有雕纹信息" )	
             return 
			end
			if nItemId1 >=10155020  then 
			x809272_NotifyTip( sceneId, selfId, "强化等级已满" )		
				return
			end
			local c0 = LuaFnGetAvailableItemCount(sceneId, selfId, 20310167)
	        local c1 = LuaFnGetAvailableItemCount(sceneId, selfId, 20310168)	
		if c0+c1 < needCailiao[nItemId1-10155010] then
		x809272_NotifyTip( sceneId, selfId, "金蚕丝不足，请检查需要的材料数为："..needCailiao[nItemId1-10155010] )
		return
	     end
	if c1 >= needCailiao[nItemId1-10155010] then
	LuaFnDelAvailableItem(sceneId,selfId,20310168,needCailiao[nItemId1-10155010])
	else
	LuaFnDelAvailableItem(sceneId,selfId,20310168,c1)
	LuaFnDelAvailableItem(sceneId,selfId,20310167,needCailiao[nItemId1-10155010]-c1)
	end
	local pos1 =  TryRecieveItem( sceneId, selfId, (nItemId1+1), 1)
	CallScriptFunction( 895111, "SHANG_BAOS", sceneId, selfId ,arg1,pos1)
	LuaFnEraseItem( sceneId, selfId, arg1 )
		LuaFnSendSpecificImpactToUnit(sceneId, selfId, selfId, selfId, 149, 0)
	x809272_NotifyTip( sceneId, selfId, "恭喜你，强化成功！" )
		else
	if index99<=0 then
		x809272_NotifyTip( sceneId, selfId, "此装备未雕纹信息。" )
		return
	end
	if nItemId1<10100000 or nItemId1>15600000 then
		x809272_NotifyTip( sceneId, selfId, "请放入正确装备。" )
		return
	end
	if index99>=10 then
		x809272_NotifyTip( sceneId, selfId, "此装备已强化满了。" )
		return
	end
	local c0 = LuaFnGetAvailableItemCount(sceneId, selfId, 20310167)
	local c1 = LuaFnGetAvailableItemCount(sceneId, selfId, 20310168)
	if c0+c1 < needCailiao[index99] then
		x809272_NotifyTip( sceneId, selfId, "金蚕丝不足，请检查需要的材料数为："..needCailiao[index99] )
		return
	end
	if c1 >= needCailiao[index99] then
    LuaFnDelAvailableItem(sceneId,selfId,20310168,needCailiao[index99])
	else
	LuaFnDelAvailableItem(sceneId,selfId,20310168,c1)
	LuaFnDelAvailableItem(sceneId,selfId,20310167,needCailiao[index99]-c1)
	end
	LuaFnSendSpecificImpactToUnit(sceneId, selfId, selfId, selfId, 149, 0)
	x809272_NotifyTip( sceneId, selfId, "恭喜你，强化成功！" )
	local _, name = LuaFnGetItemCreator(sceneId, selfId, arg1);
	
	if tonumber(index99) <9 then 
	 index99 ="0"..tostring(index99)
	name11=gsub(name,"(&DW%w%w)"..index99,"%1".."0"..tonumber(index99)+1)
	else
	name11=gsub(name,"(&DW%w%w)0"..tostring(index99),"%1"..tostring( tonumber(index99)+1))
	end
		LuaFnSetItemCreator( sceneId, selfId, arg1, name11 )
		LuaFnRefreshItemInfo( sceneId, selfId, arg1 )
	end	
end

function x809272_DWQianghua1( sceneId, selfId, arg1,arg2 ) --ok
	local needCailiao={2,9,50,87,165,284,811,2988,3570}
	local index99,index999 ,str1= x809272_DWShikeJC( sceneId, selfId, arg1 )
	local nItemId1 = LuaFnGetItemTableIndexByIndex( sceneId, selfId, arg1 )
	local EquipType	= LuaFnGetBagEquipType( sceneId, selfId, arg1 )
		if EquipType == 17 then
			if nItemId1 < 10155011  then 
			x809272_NotifyTip( sceneId, selfId, "该装备尚未蚀刻第二个雕纹" )	
             return 
			end
			if nItemId1 >=10155020  then 
			x809272_NotifyTip( sceneId, selfId, "强化等级已满" )		
				return
			end
			local c0 = LuaFnGetAvailableItemCount(sceneId, selfId, 20310167)
	        local c1 = LuaFnGetAvailableItemCount(sceneId, selfId, 20310168)	
		if c0+c1 < needCailiao[nItemId1-10155010] then
		x809272_NotifyTip( sceneId, selfId, "金蚕丝不足，请检查需要的材料数为："..needCailiao[nItemId1-10155010] )
		return
	     end
	if c1 >= needCailiao[nItemId1-10155010] then
	LuaFnDelAvailableItem(sceneId,selfId,20310168,needCailiao[nItemId1-10155010])
	else
	LuaFnDelAvailableItem(sceneId,selfId,20310168,c1)
	LuaFnDelAvailableItem(sceneId,selfId,20310167,needCailiao[nItemId1-10155010]-c1)
	end
	
	 local pos1 =  TryRecieveItem( sceneId, selfId, (nItemId1+1), 1)
	 CallScriptFunction( 895111, "SHANG_BAOS", sceneId, selfId ,arg1,pos1)
	LuaFnEraseItem( sceneId, selfId, arg1 )
		LuaFnSendSpecificImpactToUnit(sceneId, selfId, selfId, selfId, 149, 0)
	x809272_NotifyTip( sceneId, selfId, "恭喜你，双级雕纹强化成功！" )
		else

	if index999<=0 then
		x809272_NotifyTip( sceneId, selfId, "此装备尚未蚀刻第二个雕纹。" )
		return
	end
	if nItemId1<10100000 or nItemId1>15600000 then
		x809272_NotifyTip( sceneId, selfId, "请放入正确装备。" )
		return
	end
	if index999>=10 then
		x809272_NotifyTip( sceneId, selfId, "此装备已强化满了。" )
		return
	end
	
	
	local c0 = LuaFnGetAvailableItemCount(sceneId, selfId, 20310167)
	local c1 = LuaFnGetAvailableItemCount(sceneId, selfId, 20310168)
	if c0+c1 < needCailiao[index999] then
		x809272_NotifyTip( sceneId, selfId, "金蚕丝不足，请检查需要的材料数为："..needCailiao[index999] )
		return
	end
	if c1 >= needCailiao[index999] then
	LuaFnDelAvailableItem(sceneId,selfId,20310168,needCailiao[index999])
	else
	LuaFnDelAvailableItem(sceneId,selfId,20310168,c1)
	LuaFnDelAvailableItem(sceneId,selfId,20310167,needCailiao[index999]-c1)
	end
	LuaFnSendSpecificImpactToUnit(sceneId, selfId, selfId, selfId, 149, 0)
	x809272_NotifyTip( sceneId, selfId, "恭喜你，双级雕纹强化成功！" )
	local _, name = LuaFnGetItemCreator(sceneId, selfId, arg1);
	if tonumber(index999) <9 then 
	index999 ="0"..tostring(index999)
	name11=gsub(name,"(&DW%w%w%w%w%w%w)"..index999,"%1".."0"..tonumber(index999)+1)
	else
	name11=gsub(name,"(&DW%w%w%w%w%w%w)0"..tostring(index999),"%1"..tostring( tonumber(index999)+1))
	end
	LuaFnSetItemCreator( sceneId, selfId, arg1, name11 )
	LuaFnRefreshItemInfo( sceneId, selfId, arg1 )
	end	
end

function x809272_DWShike( sceneId, selfId, arg1,arg2,arg3 )  --雕纹OK 
	
    if arg1 == nil  then
	return
	end
		local EquipType	= LuaFnGetBagEquipType( sceneId, selfId, arg1 )
	local cailiao1 = LuaFnGetItemTableIndexByIndex( sceneId, selfId, arg2 )
	local cailiao2 = LuaFnGetItemTableIndexByIndex( sceneId, selfId, arg3 )
	local cllevel=mod(cailiao2,10);
	local index1=0
	local index2=0
	local index=0
	
	local index99,index999 = x809272_DWShikeJC( sceneId, selfId, arg1 )--x809272_xuhuandiaowen(sceneId, selfId, arg1)
	local nItemId1 = LuaFnGetItemTableIndexByIndex( sceneId, selfId, arg1 )
	if EquipType ==17 then 
		if  nItemId1 ==10155002 and (cailiao2>=30110001 and cailiao2<=30110010) then
				 if cailiao1~=30121001 then
		         x809272_NotifyTip( sceneId, selfId, "请放入雕纹蚀刻溶剂。")
		         return
	             end
				local un =mod(cailiao2,10) 
				if mod(cailiao2,10) ==0 then 
					un = 10
				end
		    local pos1=    TryRecieveItem( sceneId, selfId, (10155010+un), 1)
			CallScriptFunction( 895111, "SHANG_BAOS", sceneId, selfId ,arg1,pos1)
	     	LuaFnCostMoney( sceneId, selfId,50000 )
			LuaFnEraseItem( sceneId, selfId, arg3 )
			LuaFnEraseItem( sceneId, selfId, arg1 )
	        LuaFnDelAvailableItem(sceneId,selfId,30121001,1)	
			LuaFnSendSpecificImpactToUnit(sceneId, selfId, selfId, selfId, 149, 0)
	        x809272_NotifyTip( sceneId, selfId, "恭喜你，蚀刻成功！" )
			else
		x809272_NotifyTip( sceneId, selfId, "只支持【冰魄神针】体力雕纹或者该装备已雕纹过了")	
		return
		end
    end

	if nItemId1<10100000 or nItemId1>15600000 then
		x809272_NotifyTip( sceneId, selfId, "请放入正确装备。" )
		return
	end

	if cailiao2<30110001 and cailiao2>30110200 then
		x809272_NotifyTip( sceneId, selfId, "雕纹材料不对。")
		return
	end
	if index99<=0 then
	 if (EquipType==1 or EquipType==3 or EquipType==4 or EquipType==5 or EquipType==15 or EquipType==16 or EquipType==7) and (cailiao2 <=30110040 or (cailiao2 >=30110161 and cailiao2 <=30110200 )) then
	 index=1
	elseif (EquipType==14 or EquipType==7 or EquipType==0 or EquipType==18 or EquipType==10 or EquipType==9 or EquipType==7 ) and ((cailiao2 >=30110041 and cailiao2 <=30110080 ) or(cailiao2 >=30110121 and cailiao2 <=30110160 ) ) then
	 index=1
	elseif (EquipType==6 or EquipType==11 or EquipType==12 or EquipType==13 or EquipType==7 ) and ((cailiao2 >=30110111 and cailiao2 <=30110120)  or (cailiao2 >=30110121 and cailiao2 <=30110160 ))then
	 index=1
        elseif EquipType==7 and (cailiao2 >=30110201 and cailiao2 <=30110240) then
	 index=1
	else 
	x809272_NotifyTip( sceneId, selfId, "装备类型和雕纹符不匹配")
	return
	end
	
	if index ==0 then 
	x809272_NotifyTip( sceneId, selfId, "装备类型和雕纹符不匹配或该装备暂时不支持")	
		return
	end	
	if cailiao1~=30121001 then
		x809272_NotifyTip( sceneId, selfId, "请放入雕纹蚀刻溶剂。")
		return
	end
	cllevel=cllevel+index2*10;
	local _, name = LuaFnGetItemCreator(sceneId, selfId, arg1);
	if name == nil then
		name=""
	end
		local sree1 = strfind( name,"&DW")
		if sree1 == nil then
			sree1 = 0  
		end
		if sree1 == 0 then
			name11=name.."&DW"..g_XieZi_Dw[cailiao2]..strrep("0",4)
		else  --单雕纹不写多雕纹的事情
			name11= gsub(name,"&DW0000","&DW"..g_XieZi_Dw[cailiao2],1)   
		end
	LuaFnSetItemCreator( sceneId, selfId, arg1, name11 )
	LuaFnRefreshItemInfo( sceneId, selfId, arg1 )
	LuaFnEraseItem( sceneId, selfId, arg3 )
	LuaFnDelAvailableItem(sceneId,selfId,30121001,1)
	LuaFnSendSpecificImpactToUnit(sceneId, selfId, selfId, selfId, 149, 0)
	x809272_NotifyTip( sceneId, selfId, "恭喜你，蚀刻成功！" )
	
	elseif index999<=0 then
	--------------
	x809272_NotifyTip( sceneId, selfId, "这里只支持第一个雕纹，第二个雕纹请进行雕纹融合" )
	return
  end

end 




function x809272_MsgBox( sceneId, selfId, msg )
	BeginEvent( sceneId )
		AddText( sceneId, msg )
	EndEvent( sceneId )
	DispatchEventList( sceneId, selfId, -1 )
end

function x809272_DWShikeJC( sceneId, selfId, arg1 )
local _, myname = LuaFnGetItemCreator(sceneId, selfId, arg1);
--x809272_NotifyTip( sceneId, selfId, "信息是"..myname )
if myname == nil then
return 0,0,""
end
local sree1,sree2,str1,level1,str2,level2 = strfind( myname,"&DW(%w%w)(%d%d)(%w%w)(%d%d)")
if sree1 == nil or sree2 ==nil then 
return 0,0,""	
end	
if level1 == nil then
level1 = 0
end
if level2 == nil then
level2 = 0
end
--x809272_NotifyTip(sceneId,selfId,"第一个雕纹是"..str1.."等级是"..level1.."第二个雕纹是"..str2.."等级是"..level2)
return tonumber(level1),tonumber(level2),str1,str2
end	
--**********************************
--醒目提示
--**********************************
function x809272_NotifyTip( sceneId, selfId, Msg )
	BeginEvent( sceneId )
		AddText( sceneId, Msg )
	EndEvent( sceneId )
	DispatchMissionTips( sceneId, selfId )
end
--**********************************
--关闭对话框
--**********************************
function x809272_CloseMe(sceneId, selfId)
	BeginUICommand(sceneId)
	EndUICommand(sceneId)
	DispatchUICommand(sceneId,selfId, 1000)
end

function x809272_DWShike1( sceneId, selfId, arg1,arg2,arg3 )  --雕纹OK 
	
    if arg1 == nil  then
	return
	end
		local EquipType	= LuaFnGetBagEquipType( sceneId, selfId, arg1 )
	local cailiao1 = LuaFnGetItemTableIndexByIndex( sceneId, selfId, arg2 )
	local cailiao2 = LuaFnGetItemTableIndexByIndex( sceneId, selfId, arg3 )
	local cllevel=mod(cailiao2,10);
	local index1=0
	local index2=0
	local index=0
	
	local index99,index999 = x809272_DWShikeJC( sceneId, selfId, arg1 )--x809272_xuhuandiaowen(sceneId, selfId, arg1)
	local nItemId1 = LuaFnGetItemTableIndexByIndex( sceneId, selfId, arg1 )

	if nItemId1<10100000 or nItemId1>15600000 then
		x809272_NotifyTip( sceneId, selfId, "请放入正确装备。" )
		return
	end

	if cailiao2<30110001 and cailiao2>30110200 then
		x809272_NotifyTip( sceneId, selfId, "雕纹材料不对。")
		return
	end
	if index99<=0 then
	x809272_NotifyTip( sceneId, selfId, "该装备没有进行第一个雕纹！" )	
	elseif index999<=0 then
	--------------
	if (EquipType==1 or EquipType==3 or EquipType==4 or EquipType==5 or EquipType==15 or EquipType==16 or EquipType==7) and (cailiao2 <=30110040 or (cailiao2 >=30110161 and cailiao2 <=30110200 )) then
	 index=1
	elseif (EquipType==14 or EquipType==7 or EquipType==0 or EquipType==18 or EquipType==10 or EquipType==9 or EquipType==7 ) and ((cailiao2 >=30110041 and cailiao2 <=30110080 ) or(cailiao2 >=30110121 and cailiao2 <=30110160 ) ) then
	 index=1
	elseif (EquipType==6 or EquipType==11 or EquipType==12 or EquipType==13 or EquipType==7 ) and ((cailiao2 >=30110111 and cailiao2 <=30110120)  or (cailiao2 >=30110121 and cailiao2 <=30110160 )) then
	index=1
        elseif EquipType==7 and (cailiao2 >=30110201 and cailiao2 <=30110240) then
	 index=1
	else 
	x809272_NotifyTip( sceneId, selfId, "装备类型和雕纹符不匹配")
	return
	end
	
	if index ==0 then 
	x809272_NotifyTip( sceneId, selfId, "装备类型和雕纹符不匹配或该装备暂时不支持")	
		return
	end	
	if cailiao1~=38000991 then
		x809272_NotifyTip( sceneId, selfId, "请放入雕纹融合符。")
		return
	end
	cllevel=cllevel+index2*10;
	local _, name = LuaFnGetItemCreator(sceneId, selfId, arg1);
	if name == nil then
		name=""
	end
		local sree1 = strfind( name,"&DW")
		if sree1 == nil then
		return
		end

                if strsub(name,sree1+3,sree1+4) == strsub(g_XieZi_Dw[cailiao2],1,2) then
		   x809272_NotifyTip( sceneId, selfId, "雕纹重复，你的装备已经蚀刻过这个雕文了。")
		   return
	        end

                local DW1biaoji,DW2biaoji = 0,0
                if strsub(name,sree1+3,sree1+4) == "bg" or strsub(name,sree1+3,sree1+4) == "hg" or strsub(name,sree1+3,sree1+4) == "xg" or strsub(name,sree1+3,sree1+4) == "dg" then
                   DW1biaoji = 1
                elseif strsub(name,sree1+3,sree1+4) == "bj" or strsub(name,sree1+3,sree1+4) == "hj" or strsub(name,sree1+3,sree1+4) == "xj" or strsub(name,sree1+3,sree1+4) == "dj" then
                   DW1biaoji = 2
                elseif strsub(name,sree1+3,sree1+4) == "bk" or strsub(name,sree1+3,sree1+4) == "hk" or strsub(name,sree1+3,sree1+4) == "xk" or strsub(name,sree1+3,sree1+4) == "dk" then
                   DW1biaoji = 3
                elseif strsub(name,sree1+3,sree1+4) == "ww" or strsub(name,sree1+3,sree1+4) == "mx" or strsub(name,sree1+3,sree1+4) == "yj" or strsub(name,sree1+3,sree1+4) == "bn" then
                   DW1biaoji = 4
                end
                if strsub(g_XieZi_Dw[cailiao2],1,2) == "bg" or strsub(g_XieZi_Dw[cailiao2],1,2) == "hg" or strsub(g_XieZi_Dw[cailiao2],1,2) == "xg" or strsub(g_XieZi_Dw[cailiao2],1,2) == "dg" then
                   DW2biaoji = 1
                elseif strsub(g_XieZi_Dw[cailiao2],1,2) == "bj" or strsub(g_XieZi_Dw[cailiao2],1,2) == "hj" or strsub(g_XieZi_Dw[cailiao2],1,2) == "xj" or strsub(g_XieZi_Dw[cailiao2],1,2) == "dj" then
                   DW2biaoji = 2
                elseif strsub(g_XieZi_Dw[cailiao2],1,2) == "bk" or strsub(g_XieZi_Dw[cailiao2],1,2) == "hk" or strsub(g_XieZi_Dw[cailiao2],1,2) == "xk" or strsub(g_XieZi_Dw[cailiao2],1,2) == "dk" then
                   DW2biaoji = 3
                elseif strsub(g_XieZi_Dw[cailiao2],1,2) == "ww" or strsub(g_XieZi_Dw[cailiao2],1,2) == "mx" or strsub(g_XieZi_Dw[cailiao2],1,2) == "yj" or strsub(g_XieZi_Dw[cailiao2],1,2) == "bn" then
                   DW2biaoji = 4
                end
                if DW1biaoji ~= 0 and DW2biaoji ~= 0 and DW1biaoji == DW2biaoji then
		   x809272_NotifyTip( sceneId, selfId, "雕纹类型重复，每件装备只能蚀刻一个此类型雕纹。")
		   return
	        end

	name11= gsub(name,"(&DW%w%w%d%d)"..strrep("0",4),"%1"..g_XieZi_Dw[cailiao2],1)   
	LuaFnSetItemCreator( sceneId, selfId, arg1, name11 )
	LuaFnRefreshItemInfo( sceneId, selfId, arg1 )
	LuaFnEraseItem( sceneId, selfId, arg3 )
	LuaFnDelAvailableItem(sceneId,selfId,38000991,1)
	LuaFnSendSpecificImpactToUnit(sceneId, selfId, selfId, selfId, 149, 0)
	x809272_NotifyTip( sceneId, selfId, "恭喜你，双级雕纹融合成功！")
	
	else
	x809272_NotifyTip( sceneId, selfId, "只支持双极雕纹" )
	return
  end

end 


